# Case Management GraphQL Schema
# Story 2.6: Case Management Data Model and API

# ============================================================================
# Types
# ============================================================================

"""
User type represents a lawyer or staff member at the firm
"""
type User {
  id: UUID!
  firmId: UUID
  email: String!
  firstName: String!
  lastName: String!
  role: UserRole!
  createdAt: DateTime!
}

"""
Client entity - represents the firm's client relationships
"""
type Client {
  id: UUID!
  firmId: UUID!
  name: String!
  contactInfo: JSON
  address: String
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Case entity - represents legal cases managed by the firm
"""
type Case {
  id: UUID!
  firmId: UUID!
  caseNumber: String!
  title: String!
  client: Client!
  status: CaseStatus!
  type: CaseType!
  description: String!
  openedDate: DateTime!
  closedDate: DateTime
  value: Float
  metadata: JSON
  teamMembers: [User!]!
  actors: [CaseActor!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Case team assignment - represents user assignments to cases
"""
type CaseTeam {
  id: UUID!
  caseId: UUID!
  userId: UUID!
  user: User!
  role: String!
  assignedAt: DateTime!
  assignedBy: UUID
}

"""
Case actor - represents external parties involved in a case
These are people/entities external to the firm (clients, opposing parties, witnesses, etc.)
"""
type CaseActor {
  id: UUID!
  caseId: UUID!
  role: CaseActorRole!
  name: String!
  organization: String
  email: String
  phone: String
  address: String
  notes: String
  createdAt: DateTime!
  updatedAt: DateTime!
  createdBy: UUID!
}

# ============================================================================
# Input Types
# ============================================================================

"""
Input for creating a new case
"""
input CreateCaseInput {
  """Title of the case (3-500 characters)"""
  title: String!

  """Client ID - must reference an existing client"""
  clientId: UUID!

  """Type of case"""
  type: CaseType!

  """Detailed description of the case (minimum 10 characters)"""
  description: String!

  """Monetary value of the case (optional)"""
  value: Float

  """Additional metadata as JSON (optional)"""
  metadata: JSON
}

"""
Input for updating an existing case
All fields are optional - only provided fields will be updated
"""
input UpdateCaseInput {
  """Updated title (3-500 characters if provided)"""
  title: String

  """Updated status"""
  status: CaseStatus

  """Updated case type"""
  type: CaseType

  """Updated description"""
  description: String

  """Case closure date"""
  closedDate: DateTime

  """Updated monetary value"""
  value: Float

  """Updated metadata"""
  metadata: JSON
}

"""
Input for assigning a user to a case team
"""
input AssignTeamInput {
  """Case ID"""
  caseId: UUID!

  """User ID to assign"""
  userId: UUID!

  """Role of the user on the case team (e.g., Lead, Support, Observer)"""
  role: String!
}

"""
Input for adding an external actor to a case
"""
input AddCaseActorInput {
  """Case ID"""
  caseId: UUID!

  """Role of the actor in the case"""
  role: CaseActorRole!

  """Name of the actor (2-200 characters)"""
  name: String!

  """Organization/company name (optional)"""
  organization: String

  """Email address (optional)"""
  email: String

  """Phone number (optional)"""
  phone: String

  """Physical address (optional)"""
  address: String

  """Additional notes about this actor (optional)"""
  notes: String
}

"""
Input for updating a case actor
All fields are optional - only provided fields will be updated
"""
input UpdateCaseActorInput {
  """Updated name (2-200 characters if provided)"""
  name: String

  """Updated organization"""
  organization: String

  """Updated email"""
  email: String

  """Updated phone"""
  phone: String

  """Updated address"""
  address: String

  """Updated notes"""
  notes: String
}

# ============================================================================
# Queries
# ============================================================================

type Query {
  """
  Get multiple cases with optional filters
  Authorization: Partners see all cases, Associates/Paralegals see only assigned cases
  """
  cases(
    """Filter by case status"""
    status: CaseStatus

    """Filter by client ID"""
    clientId: UUID

    """Filter to cases assigned to the current user"""
    assignedToMe: Boolean
  ): [Case!]!

  """
  Get a single case by ID
  Returns null if case not found or user is not authorized to view it
  Authorization: User must be assigned to case OR be a Partner
  """
  case(id: UUID!): Case

  """
  Full-text search across case title, description, and client name
  Returns results ordered by relevance
  Authorization: Respects case access rules (Partners see all, others see assigned only)
  """
  searchCases(
    """Search query (minimum 3 characters)"""
    query: String!

    """Maximum number of results (default 50, max 100)"""
    limit: Int
  ): [Case!]!

  """
  Get all actors for a specific case
  Authorization: User must be assigned to case OR be a Partner
  """
  caseActors(caseId: UUID!): [CaseActor!]!

  """
  Get actors for a case filtered by role
  Authorization: User must be assigned to case OR be a Partner
  """
  caseActorsByRole(
    caseId: UUID!
    role: CaseActorRole!
  ): [CaseActor!]!
}

# ============================================================================
# Mutations
# ============================================================================

type Mutation {
  """
  Create a new case
  Side effects: Assigns creator to case team as "Lead", creates audit log entry
  Authorization: Authenticated users can create cases
  """
  createCase(input: CreateCaseInput!): Case!

  """
  Update an existing case
  Side effects: Creates audit log entry for each changed field
  Authorization: User must be on case team OR be a Partner
  """
  updateCase(id: UUID!, input: UpdateCaseInput!): Case!

  """
  Archive a case (sets status to ARCHIVED)
  Side effects: Sets closedDate to current date, creates audit log entry
  Authorization: Partner role required
  """
  archiveCase(id: UUID!): Case!

  """
  Assign a user to a case team
  Side effects: Creates case team record, creates audit log entry
  Authorization: User must be on case team OR be a Partner
  """
  assignTeam(input: AssignTeamInput!): CaseTeam!

  """
  Remove a user from a case team
  Side effects: Deletes case team record, creates audit log entry
  Authorization: User must be on case team OR be a Partner
  """
  removeTeamMember(caseId: UUID!, userId: UUID!): Boolean!

  """
  Add an external actor to a case
  Side effects: Creates case actor record, creates audit log entry
  Authorization: User must be on case team OR be a Partner
  """
  addCaseActor(input: AddCaseActorInput!): CaseActor!

  """
  Update an existing case actor
  Side effects: Updates case actor record, creates audit log for changed fields
  Authorization: User must be on case team OR be a Partner
  """
  updateCaseActor(id: UUID!, input: UpdateCaseActorInput!): CaseActor!

  """
  Remove an actor from a case
  Side effects: Deletes case actor record, creates audit log entry
  Authorization: User must be on case team OR be a Partner
  """
  removeCaseActor(id: UUID!): Boolean!
}
