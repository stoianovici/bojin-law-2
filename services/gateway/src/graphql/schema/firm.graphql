# Firm Settings GraphQL Schema
# Story 2.8.1: Billing & Rate Management

# ============================================================================
# Types
# ============================================================================

"""
Default billing rates for the firm (Story 2.8.1)
All rates are in USD cents (e.g., 50000 = $500.00/hour) for precision
"""
type DefaultRates {
  """Partner hourly rate in USD cents"""
  partnerRate: Float!

  """Associate hourly rate in USD cents"""
  associateRate: Float!

  """Paralegal hourly rate in USD cents"""
  paralegalRate: Float!
}

"""
Firm entity - represents a law firm
"""
type Firm {
  """Unique identifier for the firm"""
  id: UUID!

  """Firm name"""
  name: String!

  """Default billing rates for the firm (null if not set) - Partners only"""
  defaultRates: DefaultRates @requiresFinancialAccess

  """Timestamp when the firm was created"""
  createdAt: DateTime!

  """Timestamp when the firm was last updated"""
  updatedAt: DateTime!

  """URL of the firm's master document template in SharePoint"""
  documentTemplateUrl: String

  """SharePoint drive item ID of the master template"""
  documentTemplateDriveItemId: String
}

"""
Firm document template configuration
"""
type FirmDocumentTemplate {
  """SharePoint URL of the template"""
  url: String!

  """SharePoint drive item ID"""
  driveItemId: String!

  """Template file name"""
  fileName: String!

  """Last updated timestamp"""
  updatedAt: DateTime
}

# ============================================================================
# Input Types
# ============================================================================

"""
Input for updating default billing rates
All rates are in USD cents (e.g., 50000 = $500.00/hour)
"""
input DefaultRatesInput {
  """Partner hourly rate in USD cents (must be positive)"""
  partnerRate: Float!

  """Associate hourly rate in USD cents (must be positive)"""
  associateRate: Float!

  """Paralegal hourly rate in USD cents (must be positive)"""
  paralegalRate: Float!
}

"""
Input for updating the firm's document template
"""
input UpdateDocumentTemplateInput {
  """SharePoint URL of the template file"""
  url: String!

  """SharePoint drive item ID"""
  driveItemId: String!

  """Template file name"""
  fileName: String!
}

"""
Input for uploading a firm document template file
"""
input UploadFirmDocumentTemplateInput {
  """Template file name (e.g., 'template.dotx')"""
  fileName: String!

  """MIME type of the file"""
  fileType: String!

  """Base64-encoded file content"""
  fileContent: String!
}

# ============================================================================
# Queries
# ============================================================================

"""
Basic user info for selection dropdowns
"""
type FirmUserInfo {
  """User ID"""
  id: UUID!

  """User's first name"""
  firstName: String!

  """User's last name"""
  lastName: String!

  """User's email"""
  email: String!

  """User's role (Partner, Associate, Paralegal)"""
  role: String!
}

extend type Query {
  """
  Get the current firm's default billing rates
  Returns null if rates haven't been set yet
  Authorization: Partner role required (financial data)
  """
  defaultRates: DefaultRates

  """
  Get the current firm information
  Authorization: Authenticated users can view their firm
  """
  firm: Firm

  """
  Get all users in the current firm
  Returns a list of users for selection in team assignment
  Authorization: Authenticated users can view firm members
  """
  firmUsers: [FirmUserInfo!]!

  """
  Get the firm's document template configuration
  Authorization: Admin role required
  """
  firmDocumentTemplate: FirmDocumentTemplate
}

# ============================================================================
# Mutations
# ============================================================================

extend type Mutation {
  """
  Update the firm's default billing rates
  Side effects: Updates firm settings, creates audit log entry
  Authorization: Partner role required
  Validation: All rates must be positive numbers
  """
  updateDefaultRates(input: DefaultRatesInput!): DefaultRates!

  """
  Update the firm's master document template
  Authorization: Admin role required
  """
  updateFirmDocumentTemplate(input: UpdateDocumentTemplateInput!): FirmDocumentTemplate!

  """
  Upload a firm document template file to SharePoint
  Uploads the file to the firm's Templates folder and updates the template reference
  Authorization: Admin role required
  """
  uploadFirmDocumentTemplate(input: UploadFirmDocumentTemplateInput!): FirmDocumentTemplate!
}
