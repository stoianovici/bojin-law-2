# Document Folder Management GraphQL Schema
# OPS-089: /documents Section with Case Navigation and Folder Structure

# ============================================================================
# Types
# ============================================================================

"""
DocumentFolder entity - hierarchical folder structure for organizing documents
Folders can be nested without depth limit and belong to either a case or a client (not both)
"""
type DocumentFolder {
  """Unique identifier for the folder"""
  id: UUID!

  """Folder name"""
  name: String!

  """Case this folder belongs to (null for client-level folders)"""
  caseId: UUID

  """Case object (null for client-level folders)"""
  case: Case

  """Client this folder belongs to (null for case-level folders)"""
  clientId: UUID

  """Client object (null for case-level folders)"""
  client: Client

  """Parent folder ID (null for root-level folders)"""
  parentId: UUID

  """Parent folder object"""
  parent: DocumentFolder

  """Child folders"""
  children: [DocumentFolder!]!

  """Documents in this folder"""
  documents: [CaseDocumentWithContext!]!

  """Number of documents directly in this folder"""
  documentCount: Int!

  """Sort order within parent"""
  order: Int!

  """When the folder was created"""
  createdAt: DateTime!

  """When the folder was last updated"""
  updatedAt: DateTime!
}

"""
Folder tree with nested children
Used for sidebar display
"""
type FolderTree {
  """Root-level folders for the case"""
  folders: [DocumentFolder!]!

  """Total document count across all folders (including root)"""
  totalDocuments: Int!

  """Documents not in any folder (root level)"""
  rootDocuments: [CaseDocumentWithContext!]!

  """Count of documents at root level"""
  rootDocumentCount: Int!
}

# ============================================================================
# Input Types
# ============================================================================

"""
Input for creating a new folder
Must provide either caseId OR clientId, not both
"""
input CreateFolderInput {
  """Folder name"""
  name: String!

  """Case ID where folder will be created (optional - provide caseId OR clientId)"""
  caseId: UUID

  """Client ID where folder will be created (optional - provide caseId OR clientId)"""
  clientId: UUID

  """Parent folder ID (null for root-level folder)"""
  parentId: UUID
}

"""
Input for updating folder properties
"""
input UpdateFolderInput {
  """New folder name"""
  name: String

  """New parent folder ID (null to move to root)"""
  parentId: UUID

  """New sort order"""
  order: Int
}

"""
Input for moving a document to a folder
"""
input MoveDocumentToFolderInput {
  """Document ID (CaseDocument join table ID)"""
  caseDocumentId: UUID!

  """Target folder ID (null to move to root)"""
  folderId: UUID
}

"""
Input for bulk moving documents
"""
input BulkMoveDocumentsInput {
  """Document IDs to move"""
  caseDocumentIds: [UUID!]!

  """Target folder ID (null to move to root)"""
  folderId: UUID
}

"""
Input for reordering folders
"""
input ReorderFoldersInput {
  """Folder ID to reorder"""
  folderId: UUID!

  """New order value"""
  newOrder: Int!
}

# ============================================================================
# Queries
# ============================================================================

extend type Query {
  """
  Get folder tree for a case
  Returns all folders with nested structure and root documents

  Authorization: User must be assigned to case OR be a Partner
  """
  caseFolderTree(
    """Case ID"""
    caseId: UUID!
  ): FolderTree!

  """
  Get all folders for a case (flat list)
  Useful for folder selection dropdowns

  Authorization: User must be assigned to case OR be a Partner
  """
  caseFolders(
    """Case ID"""
    caseId: UUID!
  ): [DocumentFolder!]!

  """
  Get folder tree for a client (client-level folders, not case-specific)
  Returns all client-level folders with nested structure

  Authorization: User must have access to the client
  """
  clientFolderTree(
    """Client ID"""
    clientId: UUID!
  ): FolderTree!

  """
  Get all folders for a client (flat list, client-level only)
  Useful for folder selection dropdowns

  Authorization: User must have access to the client
  """
  clientFolders(
    """Client ID"""
    clientId: UUID!
  ): [DocumentFolder!]!

  """
  Get folder contents (documents and subfolders)

  Authorization: User must have access to the folder's case or client
  """
  folderContents(
    """Folder ID"""
    folderId: UUID!
  ): DocumentFolder!

  """
  Get folder by ID

  Authorization: User must have access to the folder's case or client
  """
  folder(
    """Folder ID"""
    id: UUID!
  ): DocumentFolder
}

# ============================================================================
# Mutations
# ============================================================================

extend type Mutation {
  """
  Create a new folder in a case

  Authorization: User must be assigned to case OR be a Partner
  """
  createFolder(input: CreateFolderInput!): DocumentFolder!

  """
  Update folder properties (name, parent, order)

  Authorization: User must have access to the folder's case
  """
  updateFolder(
    """Folder ID"""
    id: UUID!

    """Updated properties"""
    input: UpdateFolderInput!
  ): DocumentFolder!

  """
  Delete a folder
  Documents in the folder will be moved to the parent folder (or root)

  Authorization: User must have access to the folder's case
  """
  deleteFolder(
    """Folder ID"""
    id: UUID!

    """If true, also delete all documents in folder. If false (default), move to parent."""
    deleteDocuments: Boolean
  ): Boolean!

  """
  Move a document to a folder (or root)

  Authorization: User must have access to the document's case
  """
  moveDocumentToFolder(input: MoveDocumentToFolderInput!): CaseDocumentWithContext!

  """
  Bulk move multiple documents to a folder

  Authorization: User must have access to the documents' case
  """
  bulkMoveDocumentsToFolder(input: BulkMoveDocumentsInput!): [CaseDocumentWithContext!]!

  """
  Reorder folders within their parent

  Authorization: User must have access to the folder's case
  """
  reorderFolders(
    """List of folder reorderings"""
    input: [ReorderFoldersInput!]!
  ): [DocumentFolder!]!
}
