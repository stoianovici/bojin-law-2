# Client GraphQL Schema
# OPS-226: Client Query + Resolver for Client Portfolio View
# Role-Based Access: ClientTeam for assignment-based roles

# ============================================================================
# Types
# ============================================================================

"""
A user assigned to a client's team (for assignment-based access)
"""
type ClientTeamMember {
  """Unique identifier for this assignment"""
  id: UUID!

  """Role on this client (e.g., "Lead", "Support")"""
  role: String!

  """When the user was assigned"""
  assignedAt: DateTime!

  """The assigned user"""
  user: ClientTeamUser!

  """The user who made the assignment"""
  assigner: ClientTeamAssigner
}

"""
User info for client team member
"""
type ClientTeamUser {
  id: UUID!
  firstName: String!
  lastName: String!
  email: String!
  role: String!
}

"""
Assigner info for client team member
"""
type ClientTeamAssigner {
  id: UUID!
  firstName: String!
  lastName: String!
}

"""
Summary of a case for client portfolio view (OPS-226)
Lightweight case representation without sensitive financial data
"""
type CaseSummaryForClient {
  """Unique identifier for the case"""
  id: UUID!

  """Case number for tracking"""
  caseNumber: String!

  """Title of the case"""
  title: String!

  """Current status"""
  status: CaseStatus!

  """Type of legal case"""
  type: String!

  """Date when the case was opened"""
  openedDate: DateTime!

  """Reference numbers for email classification - court file numbers, contract refs"""
  referenceNumbers: [String!]!

  """Keywords for email classification"""
  keywords: [String!]!

  """Email subject patterns for classification"""
  subjectPatterns: [String!]!

  """Free text guidance for AI email classifier"""
  classificationNotes: String

  """Email exclusion patterns - senders/domains to never match to this case"""
  excludePatterns: [String!]!

  """Email whitelist domains - only accept from these when strict mode is enabled"""
  allowedDomains: [String!]!

  """When true, only accept emails from allowedDomains"""
  strictMode: Boolean!

  """Billing type for the case"""
  billingType: BillingType!

  """Fixed amount for fixed-price cases (in EUR)"""
  fixedAmount: Float
}

"""
Administrator or contact person for a client
"""
type ClientPerson {
  """Unique identifier"""
  id: String!

  """Full name"""
  name: String!

  """Role or position"""
  role: String!

  """Email address"""
  email: String

  """Phone number"""
  phone: String
}

"""
Client with their case portfolio (OPS-226)
Extended client type that includes all cases for the client
"""
type ClientWithCases {
  """Unique identifier for the client"""
  id: UUID!

  """Client's full name or organization name"""
  name: String!

  """Contact email address (extracted from contactInfo)"""
  email: String

  """Contact phone number (extracted from contactInfo)"""
  phone: String

  """Physical address of the client"""
  address: String

  """Client type: individual or company"""
  clientType: String

  """Company type: SRL, SA, PFA, II, IF, Other"""
  companyType: String

  """CUI / Cod Fiscal (tax ID)"""
  cui: String

  """Registration number (Nr. Registru Comerț)"""
  registrationNumber: String

  """List of administrators"""
  administrators: [ClientPerson!]!

  """List of contact persons"""
  contacts: [ClientPerson!]!

  """All cases for this client"""
  cases: [CaseSummaryForClient!]!

  """Total number of cases"""
  caseCount: Int!

  """Number of active cases"""
  activeCaseCount: Int!

  """Team members assigned to this client (for role-based access)"""
  teamMembers: [ClientTeamMember!]!

  """Timestamp when the client record was created"""
  createdAt: DateTime!

  """Timestamp when the client record was last updated"""
  updatedAt: DateTime!
}

# ============================================================================
# Input Types
# ============================================================================

"""
Input for a client person (administrator or contact)
"""
input ClientPersonInput {
  """Unique identifier (optional for new entries)"""
  id: String

  """Full name (required)"""
  name: String!

  """Role or position (required)"""
  role: String!

  """Email address"""
  email: String

  """Phone number"""
  phone: String
}

"""
Input for creating a new client
"""
input CreateClientInput {
  """Client's full name or organization name (required)"""
  name: String!

  """Contact email address"""
  email: String

  """Contact phone number"""
  phone: String

  """Physical address of the client"""
  address: String

  """Client type: individual or company"""
  clientType: String

  """Company type: SRL, SA, PFA, II, IF, Other"""
  companyType: String

  """CUI / Cod Fiscal (tax ID)"""
  cui: String

  """Registration number (Nr. Registru Comerț)"""
  registrationNumber: String

  """List of administrators"""
  administrators: [ClientPersonInput!]

  """List of contact persons"""
  contacts: [ClientPersonInput!]
}

"""
Input for updating an existing client
"""
input UpdateClientInput {
  """Client's full name or organization name"""
  name: String

  """Contact email address"""
  email: String

  """Contact phone number"""
  phone: String

  """Physical address of the client"""
  address: String

  """Client type: individual or company"""
  clientType: String

  """Company type: SRL, SA, PFA, II, IF, Other"""
  companyType: String

  """CUI / Cod Fiscal (tax ID)"""
  cui: String

  """Registration number (Nr. Registru Comerț)"""
  registrationNumber: String

  """List of administrators"""
  administrators: [ClientPersonInput!]

  """List of contact persons"""
  contacts: [ClientPersonInput!]
}

# ============================================================================
# Queries
# ============================================================================

extend type Query {
  """
  Get a client by ID with their case portfolio (OPS-226)
  Returns null if client not found or not in user's firm
  Authorization: Authenticated users in the same firm
  """
  client(id: UUID!): ClientWithCases

  """
  Get all clients for the firm
  Returns list of clients with case counts for list view
  Authorization: Authenticated users in the same firm
  """
  clients: [ClientWithCases!]!
}

# ============================================================================
# Mutations
# ============================================================================

extend type Mutation {
  """
  Create a new client
  Authorization: Authenticated users in the same firm (Partner/Associate only)
  """
  createClient(input: CreateClientInput!): ClientWithCases!

  """
  Update an existing client
  Authorization: Authenticated users in the same firm (Partner/Associate only)
  """
  updateClient(id: UUID!, input: UpdateClientInput!): ClientWithCases

  """
  Permanently delete a client and all associated data
  WARNING: This is a destructive operation that cannot be undone.
  - All cases belonging to this client will be deleted
  - All emails linked to this client will be unlinked (remain in system)
  - All tasks in client inbox will be deleted
  - All client-level documents will be deleted
  Authorization: Partners only
  """
  deleteClient(id: UUID!): ClientWithCases

  """
  Sync attachments for all emails in the client's inbox
  Queues background jobs to download attachments from Graph API and upload to SharePoint.
  Use this for clients that were created before attachment sync was implemented,
  or to retry failed attachment syncs.
  Returns the number of emails queued for sync.
  Authorization: Authenticated users in the same firm
  """
  syncClientAttachments(clientId: UUID!): Int!

  """
  Assign a user to a client's team.
  Required for AssociateJr/Paralegal roles to access client data.
  Authorization: Full-access roles only (Partner, Associate, BusinessOwner)
  """
  assignClientTeam(clientId: UUID!, userId: UUID!, role: String!): ClientTeamMember!

  """
  Remove a user from a client's team.
  Authorization: Full-access roles only (Partner, Associate, BusinessOwner)
  """
  removeClientTeam(clientId: UUID!, userId: UUID!): Boolean!
}
