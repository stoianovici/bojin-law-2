# Document Drafting Schema
# Story 3.3: Intelligent Document Drafting
# GraphQL types for AI-powered document generation

"""
Input for AI document generation
"""
input AIDocumentGenerationInput {
  """Case ID to generate document for"""
  caseId: UUID!
  """Natural language prompt describing the document to generate"""
  prompt: String!
  """Type of document to generate"""
  documentType: DocumentType!
  """Optional template ID to base the document on"""
  templateId: UUID
  """Whether to include case context in generation (default: true)"""
  includeContext: Boolean = true
}

"""
AI-generated document output
"""
type AIGeneratedDocument {
  """Unique identifier for the generated document"""
  id: UUID!
  """Title of the document"""
  title: String!
  """Full content of the generated document"""
  content: String!
  """AI-suggested title for the document"""
  suggestedTitle: String!
  """Template used as base (if any)"""
  templateUsed: DocumentTemplate
  """Precedent documents referenced during generation"""
  precedentsReferenced: [PrecedentDocument!]!
  """Total tokens used for generation"""
  tokensUsed: Int!
  """Time taken for generation in milliseconds"""
  generationTimeMs: Int!
}

"""
A document template from the firm library
"""
type DocumentTemplate {
  """Unique identifier"""
  id: UUID!
  """Template name"""
  name: String!
  """Category of documents this template applies to"""
  category: String!
  """Template structure with sections"""
  structure: JSON
  """Number of times this template has been used"""
  usageCount: Int!
  """Quality score (0-1)"""
  qualityScore: Float
}

"""
A precedent document found through similarity search
"""
type PrecedentDocument {
  """Document ID in the training library"""
  documentId: UUID!
  """Document title/filename"""
  title: String!
  """Similarity score (0-1)"""
  similarity: Float!
  """Relevant sections from this document"""
  relevantSections: [String!]!
  """Category of the document"""
  category: String
}

"""
A clause suggestion for the editor
"""
type ClauseSuggestion {
  """Unique identifier for this suggestion"""
  id: UUID!
  """Suggested text content"""
  text: String!
  """Source of the suggestion"""
  source: ClauseSource!
  """Confidence score (0-1)"""
  confidence: Float!
  """Category of the clause"""
  category: String!
}

"""
Source of a clause suggestion
"""
enum ClauseSource {
  """From firm's established patterns"""
  FIRM_PATTERN
  """From a document template"""
  TEMPLATE
  """Generated by AI"""
  AI_GENERATED
}

"""
Explanation of language choice in a document
"""
type LanguageExplanation {
  """The text that was selected for explanation"""
  selection: String!
  """Explanation of what the language means"""
  explanation: String!
  """Legal basis for the language choice"""
  legalBasis: String
  """Alternative phrasings that could be used"""
  alternatives: [String!]
}

"""
Metrics for a generated document draft
"""
type DocumentDraftMetrics {
  """Unique identifier"""
  id: UUID!
  """Document this metrics record is for"""
  documentId: UUID!
  """Word count of initial AI draft"""
  initialWordCount: Int!
  """Word count after user edits"""
  finalWordCount: Int
  """Characters added by user"""
  charactersAdded: Int!
  """Characters removed by user"""
  charactersRemoved: Int!
  """Percentage of document edited (target: < 30%)"""
  editPercentage: Float!
  """Minutes from generation to finalization"""
  timeToFinalizeMinutes: Int
  """Optional user rating (1-5)"""
  userRating: Int
  """When the metrics were recorded"""
  createdAt: DateTime!
}

"""
Summary of document quality metrics
"""
type QualityMetricsSummary {
  """Average edit percentage across all documents"""
  averageEditPercentage: Float!
  """Average time to finalize documents"""
  averageTimeToFinalize: Float!
  """Average user rating"""
  averageUserRating: Float!
  """Total number of documents in summary"""
  totalDocuments: Int!
  """Breakdown by document type"""
  byDocumentType: [DocumentTypeMetrics!]!
}

"""
Quality metrics for a specific document type
"""
type DocumentTypeMetrics {
  """Document type"""
  documentType: DocumentType!
  """Average edit percentage for this type"""
  averageEditPercentage: Float!
  """Number of documents of this type"""
  documentCount: Int!
}

# Extend existing types

extend type Mutation {
  """
  Generate a document using AI based on prompt and case context
  Requires Associate or Partner role
  """
  generateDocumentWithAI(input: AIDocumentGenerationInput!): AIGeneratedDocument!

  """
  Get explanation for selected language in a document
  """
  explainLanguageChoice(
    """Document containing the text"""
    documentId: UUID!
    """The selected text to explain"""
    selectedText: String!
  ): LanguageExplanation!

  """
  Record document draft metrics when a document is finalized
  """
  recordDraftMetrics(
    """Document ID"""
    documentId: UUID!
    """Initial content (AI generated)"""
    initialContent: String!
    """Final content (after user edits)"""
    finalContent: String!
    """Optional user rating (1-5)"""
    userRating: Int
  ): DocumentDraftMetrics!
}

extend type Query {
  """
  Find documents similar to the context of a case
  """
  findSimilarDocuments(
    """Case ID to find similar documents for"""
    caseId: UUID!
    """Type of document to search for"""
    documentType: DocumentType!
    """Maximum number of results"""
    limit: Int = 5
  ): [PrecedentDocument!]!

  """
  Get template suggestions for a case and document type
  """
  suggestTemplates(
    """Case ID for context"""
    caseId: UUID!
    """Type of document"""
    documentType: DocumentType!
  ): [DocumentTemplate!]!

  """
  Get a specific template by ID
  """
  getTemplate(id: UUID!): DocumentTemplate

  """
  Search templates by name or category
  """
  searchTemplates(
    """Search query"""
    query: String!
    """Maximum results"""
    limit: Int = 10
  ): [DocumentTemplate!]!

  """
  Get quality metrics summary for AI-generated documents
  """
  documentQualityMetrics(
    """Start date for metrics period"""
    startDate: DateTime!
    """End date for metrics period"""
    endDate: DateTime!
    """Optional filter by document type"""
    documentType: DocumentType
  ): QualityMetricsSummary!

  """
  Get clause suggestions for current text
  """
  clauseSuggestions(
    """Current text in the editor"""
    currentText: String!
    """Document type being edited"""
    documentType: DocumentType!
    """Cursor position in the text"""
    cursorPosition: Int!
  ): [ClauseSuggestion!]!
}

extend type Subscription {
  """
  Subscribe to real-time clause suggestions for a document
  """
  clauseSuggestions(
    """Document being edited"""
    documentId: UUID!
    """Current cursor position"""
    cursorPosition: Int!
  ): ClauseSuggestion
}
