# Document Management GraphQL Schema
# Story 2.8.4: Cross-Case Document Linking
# Story 2.9: Document Storage with OneDrive Integration

# ============================================================================
# Types
# ============================================================================

"""
Document entity - owned by Client (not Case) for cross-case sharing
Documents can be linked to multiple cases without file duplication
Story 2.9: Extended with OneDrive integration and versioning
"""
type Document {
  """Unique identifier for the document"""
  id: UUID!

  """Client that owns this document"""
  clientId: UUID!

  """Client object for this document"""
  client: Client!

  """Firm that owns this document (for isolation)"""
  firmId: UUID!

  """Original file name"""
  fileName: String!

  """File MIME type or extension"""
  fileType: String!

  """File size in bytes"""
  fileSize: Int!

  """Storage path in cloud storage"""
  storagePath: String!

  """User who originally uploaded this document"""
  uploadedBy: User!

  """Timestamp when document was uploaded"""
  uploadedAt: DateTime!

  """Additional metadata (tags, description, etc.)"""
  metadata: JSON

  """Cases where this document is linked"""
  linkedCases: [CaseDocumentLink!]!

  """Original case where document was first uploaded (null if uploaded to client directly)"""
  originalCase: Case

  """Timestamp when the document was created"""
  createdAt: DateTime!

  """Timestamp when the document was last updated"""
  updatedAt: DateTime!

  # Story 2.9: OneDrive integration fields

  """OneDrive item ID (null if not synced to OneDrive)"""
  oneDriveId: String

  """Full OneDrive path"""
  oneDrivePath: String

  # OPS-107: SharePoint migration fields

  """Storage type - where the file is physically stored (computed from IDs)"""
  storageType: DocumentStorageType!

  """SharePoint item ID (null if not stored in SharePoint)"""
  sharePointItemId: String

  """Full SharePoint path"""
  sharePointPath: String

  # OPS-107: Thumbnail fields for grid view

  """Small thumbnail URL (48x48) - for list views"""
  thumbnailSmall: String

  """Medium thumbnail URL (176x176) - for compact grid"""
  thumbnailMedium: String

  """Large thumbnail URL (800x800) - for expanded grid view"""
  thumbnailLarge: String

  """Thumbnail generation status (OPS-114)"""
  thumbnailStatus: ThumbnailStatus

  """Document status (DRAFT, FINAL, ARCHIVED)"""
  status: DocumentStatus!

  """Temporary download URL (computed field, expires in ~1 hour)"""
  downloadUrl: String

  """Thumbnail URL (computed field, for preview)"""
  thumbnailUrl: String

  """Version history for the document"""
  versions: [DocumentVersion!]!

  """Number of versions (computed, for UI display)"""
  versionCount: Int!

  # OPS-171: Document source type and review fields

  """Source type indicating origin of document (UPLOAD, EMAIL_ATTACHMENT, AI_GENERATED, TEMPLATE)"""
  sourceType: DocumentSourceType!

  """User assigned to review this document (null if not assigned for review)"""
  reviewer: User

  """When the document was submitted for review (null if not submitted)"""
  submittedAt: DateTime
}

"""
Document version for tracking changes from OneDrive sync
Story 2.9: Version tracking for bidirectional sync
"""
type DocumentVersion {
  """Unique identifier"""
  id: UUID!

  """Parent document ID"""
  documentId: UUID!

  """Version number (1, 2, 3, etc.)"""
  versionNumber: Int!

  """OneDrive version ID (if synced from OneDrive)"""
  oneDriveVersionId: String

  """Summary of changes in this version"""
  changesSummary: String

  """User who created this version"""
  createdBy: User!

  """Timestamp when version was created"""
  createdAt: DateTime!

  """File size of this version in bytes"""
  fileSize: Int
}

"""
Document status enum
Story 2.9: Document lifecycle status
OPS-172: Extended with review workflow states
"""
enum DocumentStatus {
  """Work in progress"""
  DRAFT

  """Submitted for supervisor review"""
  IN_REVIEW

  """Supervisor requested modifications"""
  CHANGES_REQUESTED

  """Legacy - awaiting processing"""
  PENDING

  """Approved, locked"""
  FINAL

  """Historical, not active"""
  ARCHIVED
}

"""
OPS-114: Thumbnail generation status
"""
enum ThumbnailStatus {
  """Thumbnail not yet generated"""
  PENDING

  """Thumbnail currently being generated"""
  PROCESSING

  """Thumbnail successfully generated and stored"""
  COMPLETED

  """Thumbnail generation failed"""
  FAILED

  """File type doesn't support thumbnails"""
  NOT_SUPPORTED
}

"""
Case-Document link information
Shows details about how a document is linked to a specific case
"""
type CaseDocumentLink {
  """Case ID this document is linked to"""
  caseId: UUID!

  """Case object"""
  case: Case!

  """User who linked this document to the case"""
  linkedBy: User!

  """When the document was linked to this case"""
  linkedAt: DateTime!

  """True if document was originally uploaded to this case, false if imported"""
  isOriginal: Boolean!

  # OPS-171: Promotion tracking

  """True if this was promoted from an email attachment"""
  promotedFromAttachment: Boolean!
}

"""
Document in case context
Includes document details plus case-specific linking information
"""
type CaseDocumentWithContext {
  """ID of the CaseDocument record (for folder operations)"""
  id: UUID!

  """The document"""
  document: Document!

  """User who linked this document to the case"""
  linkedBy: User!

  """When the document was linked to this case"""
  linkedAt: DateTime!

  """True if document was uploaded to this case, false if imported from another case"""
  isOriginal: Boolean!

  """Source case if document was imported (null if original upload)"""
  sourceCase: Case

  # OPS-171: Promotion tracking

  """True if this was promoted from an email attachment"""
  promotedFromAttachment: Boolean!

  """ID of the original email attachment if promoted"""
  originalAttachmentId: UUID

  """Original received date - from email if promoted from attachment, otherwise linkedAt"""
  receivedAt: DateTime!
}

"""
Documents grouped by source case
Used in document browser modal
"""
type DocumentsByCase {
  """The case these documents came from"""
  case: Case!

  """Documents from this case"""
  documents: [Document!]!

  """Number of documents in this case"""
  documentCount: Int!
}

# OPS-107: Grid view types for document display

"""
Paginated connection for document grid view
"""
type DocumentGridConnection {
  """List of document edges"""
  edges: [DocumentGridEdge!]!

  """Pagination info"""
  pageInfo: PageInfo!

  """Total number of documents matching filters"""
  totalCount: Int!
}

"""
Edge type for document grid pagination
"""
type DocumentGridEdge {
  """The document with context"""
  node: CaseDocumentWithContext!

  """Cursor for pagination"""
  cursor: String!
}

"""
Pagination info for connections
"""
type PageInfo {
  """Whether there are more items after this page"""
  hasNextPage: Boolean!

  """Whether there are items before this page"""
  hasPreviousPage: Boolean!

  """Cursor of the first item"""
  startCursor: String

  """Cursor of the last item"""
  endCursor: String
}

"""
Document audit log entry
Tracks all document operations for compliance
"""
type DocumentAuditLog {
  """Unique identifier"""
  id: UUID!

  """Document ID (null if permanently deleted)"""
  documentId: UUID

  """User who performed the action"""
  user: User!

  """Action performed"""
  action: DocumentAuditAction!

  """Related case (for link/unlink operations)"""
  caseId: UUID

  """Additional details about the action"""
  details: JSON

  """When the action occurred"""
  timestamp: DateTime!
}

# ============================================================================
# Enums
# ============================================================================

"""
Document storage type - indicates where the file is physically stored
OPS-107: Added for SharePoint migration
"""
enum DocumentStorageType {
  """Legacy - personal OneDrive (before SharePoint migration)"""
  ONEDRIVE

  """New - firm SharePoint site (default for new uploads)"""
  SHAREPOINT

  """Fallback - Cloudflare R2 storage"""
  R2
}

"""
Sort fields for document grid (OPS-107)
"""
enum DocumentSortField {
  """Sort by when document was linked to case"""
  LINKED_AT

  """Sort by when document was uploaded"""
  UPLOADED_AT

  """Sort by file name"""
  FILE_NAME

  """Sort by file size"""
  FILE_SIZE

  """Sort by file type"""
  FILE_TYPE
}

"""
Sort direction
"""
enum SortDirection {
  """Ascending order"""
  ASC

  """Descending order"""
  DESC
}

"""
Document audit action types
"""
enum DocumentAuditAction {
  """Document was uploaded"""
  UPLOADED

  """Document was linked to a case"""
  LINKED_TO_CASE

  """Document was unlinked from a case"""
  UNLINKED_FROM_CASE

  """Document was permanently deleted (Partners only)"""
  PERMANENTLY_DELETED

  """Document metadata was updated"""
  METADATA_UPDATED
}

# ============================================================================
# Input Types
# ============================================================================

"""
Input for uploading a new document
Story 2.9: Extended with OneDrive integration fields
"""
input UploadDocumentInput {
  """Case ID where document is being uploaded (required for initial upload)"""
  caseId: UUID!

  """Original file name"""
  fileName: String!

  """File MIME type"""
  fileType: String!

  """File size in bytes"""
  fileSize: Int!

  """Storage path after file upload (optional if uploading to OneDrive)"""
  storagePath: String

  """Optional metadata (tags, description)"""
  metadata: JSON

  """Optional title for the document"""
  title: String

  """Optional description"""
  description: String

  """Upload to OneDrive (default: true)"""
  uploadToOneDrive: Boolean
}

"""
Input for uploading a document with file data (Story 2.9)
Used when uploading directly via GraphQL with base64 file content
"""
input UploadDocumentWithFileInput {
  """Case ID where document is being uploaded"""
  caseId: UUID!

  """Original file name"""
  fileName: String!

  """File MIME type"""
  fileType: String!

  """Base64 encoded file content"""
  fileContent: String!

  """Optional title for the document"""
  title: String

  """Optional description"""
  description: String
}

"""
Input for updating document status
Story 2.9: Allow changing document status
"""
input UpdateDocumentStatusInput {
  """New document status"""
  status: DocumentStatus!
}

"""
Input for linking existing documents to a case
"""
input LinkDocumentsInput {
  """Target case ID"""
  caseId: UUID!

  """Document IDs to link (can link multiple at once)"""
  documentIds: [UUID!]!
}

"""
Input for updating document metadata
"""
input UpdateDocumentMetadataInput {
  """Optional new tags"""
  tags: [String!]

  """Optional description"""
  description: String

  """Any additional metadata"""
  custom: JSON
}

# ============================================================================
# Queries
# ============================================================================

extend type Query {
  """
  Get all documents for a client
  Used in document browser modal to show available documents for import

  Authorization: User must have access to at least one of the client's cases
  """
  clientDocuments(
    """Client ID to get documents for"""
    clientId: UUID!

    """Optional: Exclude documents already linked to this case"""
    excludeCaseId: UUID

    """Optional: Search filter (filename, description)"""
    search: String

    """Optional: Filter by file types"""
    fileTypes: [String!]
  ): [Document!]!

  """
  Get documents for a client grouped by source case
  Organized view for document browser modal

  Authorization: User must have access to at least one of the client's cases
  """
  clientDocumentsGroupedByCase(
    """Client ID to get documents for"""
    clientId: UUID!

    """Optional: Exclude documents from this case"""
    excludeCaseId: UUID

    """Optional: Search filter"""
    search: String
  ): [DocumentsByCase!]!

  """
  Get all documents linked to a specific case

  Authorization: User must be assigned to case OR be a Partner
  """
  caseDocuments(
    """Case ID"""
    caseId: UUID!
  ): [CaseDocumentWithContext!]!

  """
  Get a single document by ID

  Authorization: User must have access to at least one case the document is linked to
  """
  document(id: UUID!): Document

  """
  Get audit history for a document

  Authorization: User must have access to the document
  """
  documentAuditHistory(
    """Document ID"""
    documentId: UUID!

    """Maximum number of entries to return"""
    limit: Int
  ): [DocumentAuditLog!]!

  """
  Get version history for a document (OPS-176)
  Returns all versions ordered by version number (newest first)

  Authorization: User must have access to the document
  """
  documentVersions(
    """Document ID"""
    documentId: UUID!
  ): [DocumentVersion!]!

  """
  Get document thumbnail (Story 2.9 AC5)
  Returns thumbnail URL for document preview

  Authorization: User must have access to the document
  """
  getDocumentThumbnail(
    """Document ID"""
    documentId: UUID!
  ): ThumbnailResponse

  """
  Get preview URL for a document (OPS-087)
  Returns URL for embedding document preview in iframe:
  - PDFs: Direct OneDrive URL (browser renders natively)
  - Office docs: Office Online embed URL
  - Images: Direct OneDrive URL

  Authorization: User must have access to the document
  """
  documentPreviewUrl(
    """Document ID"""
    documentId: UUID!
  ): PreviewUrlResponse

  """
  Get text content for a text file document (OPS-109)
  Fetches and returns the actual content for text files (txt, csv, json, etc.)
  This proxies through the backend to avoid CORS issues with SharePoint

  Authorization: User must have access to the document
  """
  documentTextContent(
    """Document ID"""
    documentId: UUID!
  ): TextContentResponse

  # OPS-107: Grid view queries

  """
  Get case documents with thumbnails for grid view display
  Returns paginated documents with pre-fetched thumbnail URLs

  Authorization: User must be assigned to case OR be a Partner
  """
  caseDocumentsGrid(
    """Case ID"""
    caseId: UUID!

    """Number of documents to return (default: 20)"""
    first: Int

    """Cursor for pagination"""
    after: String

    """Filter by file types (e.g., ['application/pdf', 'image/*'])"""
    fileTypes: [String!]

    """OPS-173: Filter by document source types (e.g., [UPLOAD, AI_GENERATED])"""
    sourceTypes: [DocumentSourceType!]

    """OPS-173: Include promoted attachments in working documents tab"""
    includePromotedAttachments: Boolean

    """Sort field (default: linkedAt)"""
    sortBy: DocumentSortField

    """Sort direction (default: DESC)"""
    sortDirection: SortDirection
  ): DocumentGridConnection!

  # OPS-174: Supervisor Review Queue

  """
  Get documents pending review by the current user (OPS-174)
  Returns all documents where:
  - Current user is assigned as reviewer (reviewerId = current user)
  - Document status is IN_REVIEW

  Only accessible by supervisors (PARTNER, SENIOR_ASSOCIATE roles).
  Documents are grouped by case for better organization.

  Authorization: PARTNER or SENIOR_ASSOCIATE role required
  """
  documentsForReview: [DocumentForReview!]!

  """
  Get count of documents pending review by the current user (OPS-174)
  Used to display badge on the review tab.

  Authorization: PARTNER or SENIOR_ASSOCIATE role required
  """
  documentsForReviewCount: Int!

  """
  Get list of supervisors for the review workflow picker (OPS-177)
  Returns users with PARTNER or SENIOR_ASSOCIATE roles in the firm.

  Authorization: User must be authenticated
  """
  supervisors: [Supervisor!]!
}

# ============================================================================
# OPS-174: Supervisor Review Queue Types
# ============================================================================

"""
Document pending review with case context (OPS-174)
"""
type DocumentForReview {
  """Unique identifier (same as document ID for simplicity)"""
  id: ID!

  """The document pending review"""
  document: Document!

  """The case this document belongs to"""
  case: Case!

  """User who submitted the document for review"""
  submittedBy: User!

  """When the document was submitted for review"""
  submittedAt: DateTime!
}

# ============================================================================
# Mutations
# ============================================================================

extend type Mutation {
  """
  Upload a new document to a case
  Creates document owned by case's client and links it to the case

  Authorization: User must be assigned to case OR be a Partner
  """
  uploadDocument(input: UploadDocumentInput!): Document!

  """
  Link existing documents to a case (import from other cases)

  Authorization: User must be assigned to target case OR be a Partner
  All documents must belong to the same client as the case
  """
  linkDocumentsToCase(input: LinkDocumentsInput!): [Document!]!

  """
  Unlink a document from a case (soft delete)
  Document remains in storage and other cases

  Authorization: User must be assigned to case OR be a Partner
  """
  unlinkDocumentFromCase(
    """Case ID to unlink from"""
    caseId: UUID!

    """Document ID to unlink"""
    documentId: UUID!
  ): Boolean!

  """
  Permanently delete a document (Partners only)
  Removes from all cases and deletes from storage

  Authorization: Partner role required
  """
  permanentlyDeleteDocument(
    """Document ID to delete"""
    documentId: UUID!
  ): Boolean!

  """
  Bulk delete all documents linked to a case (Admin cleanup)
  Removes CaseDocument links, clears EmailAttachment references, deletes Document records

  Authorization: Partner role required
  """
  bulkDeleteCaseDocuments(
    """Case ID to delete all documents from"""
    caseId: UUID!
  ): BulkDeleteResult!

  """
  Update document metadata

  Authorization: User must have access to the document
  """
  updateDocumentMetadata(
    """Document ID"""
    documentId: UUID!

    """Updated metadata"""
    input: UpdateDocumentMetadataInput!
  ): Document!

  """
  Rename a document (OPS-162)
  Updates the fileName in database. Does NOT rename in SharePoint/OneDrive storage.

  Authorization: User must have access to the document
  """
  renameDocument(
    """Document ID"""
    documentId: UUID!

    """New file name (including extension)"""
    newFileName: String!
  ): Document!

  # Story 2.9: OneDrive integration mutations

  """
  Upload document with file content to OneDrive
  Creates document in OneDrive, syncs metadata to database

  Authorization: User must be assigned to case OR be a Partner
  """
  uploadDocumentToOneDrive(input: UploadDocumentWithFileInput!): Document!

  """
  Get temporary download URL for a document
  Returns a pre-signed URL that expires in 1 hour

  Authorization: User must have access to the document
  """
  getDocumentDownloadUrl(
    """Document ID"""
    documentId: UUID!
  ): DownloadUrlResponse!

  """
  Sync document from OneDrive
  Fetches latest metadata and creates new version if changed

  Authorization: User must have access to the document
  """
  syncDocumentFromOneDrive(
    """Document ID"""
    documentId: UUID!
  ): SyncResult!

  """
  Update document status

  Authorization: User must have access to the document
  """
  updateDocumentStatus(
    """Document ID"""
    documentId: UUID!

    """New status"""
    input: UpdateDocumentStatusInput!
  ): Document!

  """
  Share a document with the organization (OPS-104)
  Creates an organization-scoped sharing link so all firm members can access the file
  This is required for documents uploaded before organization sharing was enabled

  Authorization: User must have access to the document
  """
  shareDocumentWithOrganization(
    """Document ID"""
    documentId: UUID!
  ): ShareDocumentResult!

  """
  Batch share all documents for a case with the organization (OPS-104)
  Useful for backfilling existing documents that were uploaded before org sharing

  Authorization: Partner role required
  """
  batchShareCaseDocuments(
    """Case ID to share all documents for"""
    caseId: UUID!
  ): BatchShareResult!

  # OPS-108: SharePoint upload mutation

  """
  Upload document to SharePoint firm storage (OPS-108)
  Creates document in firm's SharePoint site under Cases/{CaseNumber}/Documents/
  All firm members can access documents stored in SharePoint

  Authorization: User must be assigned to case OR be a Partner
  """
  uploadDocumentToSharePoint(input: UploadDocumentWithFileInput!): Document!

  """
  Promote an email attachment to a working document (OPS-175)
  Creates an editable copy of an email attachment in the working documents folder,
  enabling version tracking and editing workflow.

  The original attachment remains in the correspondence tab for reference.
  A link is maintained between the promoted document and original attachment.

  Authorization: User must be assigned to case OR be a Partner
  Roles: Partner, Associate, Paralegal
  """
  promoteAttachmentToDocument(input: PromoteAttachmentInput!): PromoteAttachmentResult!

  # ==========================================================================
  # OPS-177: Review Workflow Mutations
  # ==========================================================================

  """
  Submit a document for supervisor review (OPS-177)
  Sets document status to IN_REVIEW and assigns the specified reviewer.

  Conditions:
  - Document must be in DRAFT or CHANGES_REQUESTED status
  - Reviewer must have PARTNER or SENIOR_ASSOCIATE role

  Authorization: User must have access to the document
  """
  submitForReview(input: SubmitForReviewInput!): ReviewResult!

  """
  Make a review decision on a document (OPS-177)
  Approves the document (status → FINAL) or requests changes (status → CHANGES_REQUESTED).

  Conditions:
  - Document must be in IN_REVIEW status
  - Current user must be the assigned reviewer
  - Comment is required when requesting changes

  Authorization: Current user must be the assigned reviewer
  """
  reviewDocument(input: ReviewDecisionInput!): ReviewResult!

  """
  Withdraw a document from review (OPS-177)
  Sets document status back to DRAFT and clears reviewer assignment.

  Conditions:
  - Document must be in IN_REVIEW status
  - Only the original submitter can withdraw

  Authorization: User who submitted the document for review
  """
  withdrawFromReview(documentId: ID!): ReviewResult!
}

# ============================================================================
# Response Types (Story 2.9)
# ============================================================================

"""
Result of bulk delete operation
"""
type BulkDeleteResult {
  """Number of CaseDocument links deleted"""
  caseDocumentsDeleted: Int!

  """Number of EmailAttachment references cleared"""
  attachmentReferencesCleared: Int!

  """Number of Document records deleted"""
  documentsDeleted: Int!

  """Number of files deleted from OneDrive"""
  oneDriveFilesDeleted: Int!

  """Whether the operation was successful"""
  success: Boolean!
}

"""
Response for download URL request
"""
type DownloadUrlResponse {
  """Pre-signed download URL"""
  url: String!

  """Expiration time for the URL"""
  expirationDateTime: DateTime!
}

"""
Result of document sync operation
"""
type SyncResult {
  """Whether the document was updated"""
  updated: Boolean!

  """New version number if updated"""
  newVersionNumber: Int

  """The synced document"""
  document: Document!
}

"""
Thumbnail response for document preview (Story 2.9 AC5)
"""
type ThumbnailResponse {
  """Thumbnail URL (either base64 data URI or OneDrive URL)"""
  url: String!

  """Source of the thumbnail (local, onedrive, or cache)"""
  source: String!
}

"""
Preview URL response for document preview (OPS-087)
OPS-183: Added syncResult for auto-sync integration
"""
type PreviewUrlResponse {
  """Preview URL for embedding in iframe"""
  url: String!

  """Source of the preview (pdf, office365, image)"""
  source: String!

  """Expiration time for the URL"""
  expiresAt: DateTime!

  """OPS-183: Sync result if document was synced from SharePoint before preview"""
  syncResult: PreviewSyncResult
}

"""
OPS-183: Sync result included in preview URL response
Indicates if a new version was synced from SharePoint during preview access
"""
type PreviewSyncResult {
  """Whether a new version was synced from SharePoint"""
  synced: Boolean!

  """New version number if sync occurred"""
  newVersionNumber: Int
}

"""
Text content response for text file preview (OPS-109)
"""
type TextContentResponse {
  """The text content of the file"""
  content: String!

  """File MIME type"""
  mimeType: String!

  """File size in bytes"""
  size: Int!
}

"""
Result of sharing a document with the organization (OPS-104)
"""
type ShareDocumentResult {
  """Whether the sharing was successful"""
  success: Boolean!

  """The document that was shared"""
  document: Document!

  """Web URL for the sharing link (if created)"""
  sharingLinkUrl: String
}

"""
Result of batch sharing documents (OPS-104)
"""
type BatchShareResult {
  """Total number of documents processed"""
  total: Int!

  """Number successfully shared"""
  shared: Int!

  """Number that failed to share"""
  failed: Int!

  """Number already shared (skipped)"""
  skipped: Int!

  """Whether the operation was successful"""
  success: Boolean!
}

# ============================================================================
# OPS-175: Promote Attachment to Working Document
# ============================================================================

"""
Input for promoting an email attachment to a working document
"""
input PromoteAttachmentInput {
  """ID of the CaseDocument record linking the attachment to the case"""
  caseDocumentId: UUID!

  """Optional folder ID in the working documents section to place the new document"""
  targetFolderId: UUID
}

"""
Result of promoting an attachment to a working document
"""
type PromoteAttachmentResult {
  """Whether the promotion was successful"""
  success: Boolean!

  """The newly created working document (null if failed)"""
  document: Document

  """The new CaseDocument link for the working document (null if failed)"""
  caseDocument: CaseDocumentWithContext

  """Error message if the promotion failed"""
  error: String
}

# ============================================================================
# OPS-177: Review Workflow Types
# ============================================================================

"""
Input for submitting a document for supervisor review
"""
input SubmitForReviewInput {
  """ID of the document to submit for review"""
  documentId: ID!

  """ID of the supervisor to assign as reviewer"""
  reviewerId: ID!

  """Optional message to include for the reviewer"""
  message: String
}

"""
Decision options for document review
"""
enum ReviewDecision {
  """Approve the document - sets status to FINAL"""
  APPROVE

  """Request modifications - sets status to CHANGES_REQUESTED"""
  REQUEST_CHANGES
}

"""
Input for a supervisor's review decision
"""
input ReviewDecisionInput {
  """ID of the document being reviewed"""
  documentId: ID!

  """The review decision"""
  decision: ReviewDecision!

  """Comment explaining the decision (required for REQUEST_CHANGES)"""
  comment: String

  """Optional: Assign to a different user when requesting changes (instead of original submitter)"""
  assignToUserId: ID
}

"""
Result of a review workflow operation
"""
type ReviewResult {
  """Whether the operation was successful"""
  success: Boolean!

  """The updated document (null if failed)"""
  document: Document

  """Error message if the operation failed"""
  error: String
}

"""
Supervisor user info for the reviewer picker
"""
type Supervisor {
  """User ID"""
  id: ID!

  """Full display name"""
  name: String!

  """Email address"""
  email: String!

  """Role (PARTNER or SENIOR_ASSOCIATE)"""
  role: String!

  """Initials for avatar fallback"""
  initials: String!
}

# ============================================================================
# OPS-177: Review Feedback Email
# ============================================================================

"""
Input for sending a review feedback email
"""
input SendReviewFeedbackEmailInput {
  """ID of the document that was reviewed"""
  documentId: ID!

  """Email address of the recipient"""
  recipientEmail: String!

  """Name of the recipient"""
  recipientName: String!

  """Feedback message from the reviewer"""
  feedback: String!
}

"""
Preview of the review feedback email before sending
"""
type ReviewFeedbackEmailPreview {
  """Email subject line"""
  subject: String!

  """Plain text email body for preview"""
  body: String!

  """Recipient email address"""
  to: String!

  """Recipient name"""
  toName: String!
}

"""
Result of sending a review feedback email
"""
type SendReviewFeedbackEmailResult {
  """Whether the email was sent successfully"""
  success: Boolean!

  """Error message if sending failed"""
  error: String
}

extend type Query {
  """
  Preview the review feedback email before sending (OPS-177)
  Generates a preview of the email that will be sent to the document author.

  Authorization: User must have access to the document
  """
  previewReviewFeedbackEmail(input: SendReviewFeedbackEmailInput!): ReviewFeedbackEmailPreview!
}

extend type Mutation {
  """
  Send a review feedback email to the document author (OPS-177)
  Sends an email notification when a reviewer requests changes.

  Authorization: User must be the assigned reviewer for the document
  """
  sendReviewFeedbackEmail(input: SendReviewFeedbackEmailInput!): SendReviewFeedbackEmailResult!
}
