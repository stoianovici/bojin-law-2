/**
 * Prisma Seed Script for Legal Platform
 *
 * This script seeds the database with test data for development and testing.
 * See seed-data-schema.md for complete data structure documentation.
 *
 * Run with: pnpm db:seed
 *
 * NOTE: This script requires the full Prisma schema to be defined.
 * Models required: Firm, User, Case, Document, Task
 * These models will be added in Stories 2.4, 2.6, 2.7, 2.8
 */

import { PrismaClient } from '@prisma/client';
import { randomUUID } from 'crypto';

const prisma = new PrismaClient();

// Helper function to generate random past date
function randomPastDate(daysAgo: number): Date {
  const now = new Date();
  const randomDays = Math.floor(Math.random() * daysAgo);
  return new Date(now.getTime() - randomDays * 24 * 60 * 60 * 1000);
}

// Helper function to generate future date
// Commented out until tasks are implemented
// function futureDateFromNow(daysAhead: number): Date {
//   const now = new Date();
//   return new Date(now.getTime() + daysAhead * 24 * 60 * 60 * 1000);
// }

async function main() {
  console.log('üå± Starting database seed...');

  // Check if seed data already exists (idempotency check)
  console.log('Checking for existing seed data...');

  // Check if users already exist (Story 2.4: User model)
  const existingUsers = await prisma.user.findFirst({
    where: { email: 'partner@demo.lawfirm.ro' },
  });

  if (existingUsers) {
    console.log('‚ö†Ô∏è  Seed data already exists. Skipping seed.');
    console.log('To re-seed, first run: npx prisma migrate reset');
    return;
  }

  console.log('Creating test law firm...');

  // Create Law Firm
  const firm = await prisma.firm.create({
    data: {
      id: randomUUID(),
      name: 'Demo Law Firm S.R.L.',
      defaultRates: {
        partnerRate: 450,
        associateRate: 300,
        paralegalRate: 150,
      },
      createdAt: randomPastDate(365),
      updatedAt: new Date(),
    },
  });
  console.log(`‚úì Created firm: ${firm.name}`);

  // Create Users (1 Partner, 2 Associates, 2 Paralegals)
  // Story 2.4: Users with Azure AD integration
  console.log('Creating users...');

  const users = await Promise.all([
    // Partner (Active)
    prisma.user.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        firstName: 'Alex',
        lastName: 'Popescu',
        email: 'partner@demo.lawfirm.ro',
        role: 'Partner',
        status: 'Active',
        azureAdId: 'aad-partner-demo-12345',
        preferences: { language: 'ro', aiSuggestionLevel: 'high' },
        createdAt: randomPastDate(300),
        lastActive: new Date(),
      },
    }),
    // Associate 1 (Active)
    prisma.user.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        firstName: 'Maria',
        lastName: 'Ionescu',
        email: 'associate1@demo.lawfirm.ro',
        role: 'Associate',
        status: 'Active',
        azureAdId: 'aad-assoc1-demo-67890',
        preferences: { language: 'ro', aiSuggestionLevel: 'moderate' },
        createdAt: randomPastDate(250),
        lastActive: randomPastDate(1),
      },
    }),
    // Associate 2 (Active)
    prisma.user.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        firstName: 'Ion',
        lastName: 'Georgescu',
        email: 'associate2@demo.lawfirm.ro',
        role: 'Associate',
        status: 'Active',
        azureAdId: 'aad-assoc2-demo-11111',
        preferences: { language: 'ro', aiSuggestionLevel: 'moderate' },
        createdAt: randomPastDate(200),
        lastActive: randomPastDate(3),
      },
    }),
    // Paralegal 1 (Active)
    prisma.user.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        firstName: 'Elena',
        lastName: 'Popa',
        email: 'paralegal1@demo.lawfirm.ro',
        role: 'Paralegal',
        status: 'Active',
        azureAdId: 'aad-para1-demo-22222',
        preferences: { language: 'ro', aiSuggestionLevel: 'low' },
        createdAt: randomPastDate(150),
        lastActive: randomPastDate(2),
      },
    }),
    // Paralegal 2 (Active)
    prisma.user.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        firstName: 'Mihai',
        lastName: 'Dumitrescu',
        email: 'paralegal2@demo.lawfirm.ro',
        role: 'Paralegal',
        status: 'Active',
        azureAdId: 'aad-para2-demo-33333',
        preferences: { language: 'ro', aiSuggestionLevel: 'moderate' },
        createdAt: randomPastDate(100),
        lastActive: new Date(),
      },
    }),
    // Test Pending User (awaiting activation)
    prisma.user.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        firstName: 'Test',
        lastName: 'Pending',
        email: 'pending@demo.lawfirm.ro',
        role: 'Paralegal',
        status: 'Pending',
        azureAdId: 'aad-pending-demo-44444',
        preferences: { language: 'ro', aiSuggestionLevel: 'moderate' },
        createdAt: randomPastDate(7),
        lastActive: randomPastDate(7),
      },
    }),
    // Test Inactive User
    prisma.user.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        firstName: 'Test',
        lastName: 'Inactive',
        email: 'inactive@demo.lawfirm.ro',
        role: 'Paralegal',
        status: 'Inactive',
        azureAdId: 'aad-inactive-demo-55555',
        preferences: { language: 'ro', aiSuggestionLevel: 'moderate' },
        createdAt: randomPastDate(365),
        lastActive: randomPastDate(180),
      },
    }),
  ]);
  console.log(
    `‚úì Created ${users.length} users (${users.filter((u) => u.status === 'Active').length} Active, ${users.filter((u) => u.status === 'Pending').length} Pending, ${users.filter((u) => u.status === 'Inactive').length} Inactive)`
  );

  // Create Clients (2 clients for testing)
  console.log('Creating sample clients...');

  const clients = await Promise.all([
    prisma.client.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        name: 'SC ABC Industries SRL',
        contactInfo: {
          email: 'contact@abc-industries.ro',
          phone: '+40-21-123-4567',
          primaryContact: 'Ion Marin',
        },
        address: 'Bulevardul Unirii 15, Bucure»ôti, Rom√¢nia',
        createdAt: randomPastDate(365),
        updatedAt: new Date(),
      },
    }),
    prisma.client.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        name: 'Familia Popescu',
        contactInfo: {
          email: 'ana.popescu@email.ro',
          phone: '+40-722-111-222',
          primaryContact: 'Ana Popescu',
        },
        address: 'Strada Florilor 42, Cluj-Napoca, Rom√¢nia',
        createdAt: randomPastDate(200),
        updatedAt: new Date(),
      },
    }),
  ]);
  console.log(`‚úì Created ${clients.length} clients`);

  // Create additional clients for more diversity
  const moreClients = await Promise.all([
    prisma.client.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        name: 'Tech Innovations Romania SRL',
        contactInfo: {
          email: 'contact@tech-innovations.ro',
          phone: '+40-31-555-8888',
          primaryContact: 'Andrei Stoica',
        },
        address: 'Strada Progresului 90, Timi»ôoara, Rom√¢nia',
        createdAt: randomPastDate(180),
        updatedAt: new Date(),
      },
    }),
    prisma.client.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        name: 'Familia Ionescu',
        contactInfo: {
          email: 'maria.ionescu@gmail.ro',
          phone: '+40-744-999-888',
          primaryContact: 'Maria Ionescu',
        },
        address: 'Bulevardul Independen»õei 25, Ia»ôi, Rom√¢nia',
        createdAt: randomPastDate(90),
        updatedAt: new Date(),
      },
    }),
  ]);
  const allClients = [...clients, ...moreClients];
  console.log(`‚úì Created ${allClients.length} clients total`);

  // Create Cases (30 cases with various statuses, types, billing, and approval data)
  console.log('Creating sample cases...');
  const cases = await Promise.all([
    // Active Litigation case - HOURLY billing with custom rates
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-001`,
        title: 'Contract Dispute - ABC Industries vs XYZ Logistics',
        clientId: allClients[0].id,
        status: 'Active',
        type: 'Litigation',
        description: 'Dispute regarding breach of delivery contract and payment terms',
        openedDate: new Date('2025-01-15'),
        value: 150000.0,
        billingType: 'Hourly',
        customRates: {
          partnerRate: 500, // Higher than default
          associateRate: 350,
          paralegalRate: 175,
        },
        metadata: { courtName: 'Bucharest Tribunal', nextHearing: '2025-02-28' },
        createdAt: randomPastDate(30),
        updatedAt: new Date(),
      },
    }),
    // Active Contract case - FIXED billing
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-002`,
        title: 'Commercial Contract Review - ABC Industries',
        clientId: allClients[0].id,
        status: 'Active',
        type: 'Contract',
        description: 'Review and negotiation of supplier agreements',
        openedDate: new Date('2025-01-20'),
        value: 25000.0,
        billingType: 'Fixed',
        fixedAmount: 2500000, // $25,000 in cents
        metadata: { deadline: '2025-03-01' },
        createdAt: randomPastDate(25),
        updatedAt: new Date(),
      },
    }),
    // Active Advisory case - HOURLY with default rates
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-003`,
        title: 'Corporate Restructuring Advisory',
        clientId: allClients[0].id,
        status: 'Active',
        type: 'Advisory',
        description: 'Legal advisory for company restructuring and compliance',
        openedDate: new Date('2025-02-01'),
        value: 75000.0,
        billingType: 'Hourly',
        metadata: { phase: 'planning' },
        createdAt: randomPastDate(18),
        updatedAt: new Date(),
      },
    }),
    // PendingApproval case - Associate created, needs Partner approval
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-007`,
        title: 'New Client Onboarding - Tech Startup Advisory',
        clientId: allClients[2].id,
        status: 'PendingApproval',
        type: 'Advisory',
        description: 'Corporate structure and investment advisory for tech startup',
        openedDate: new Date('2025-02-15'),
        value: 40000.0,
        billingType: 'Hourly',
        customRates: {
          partnerRate: 450,
          associateRate: 300,
        },
        metadata: { newClient: true },
        createdAt: randomPastDate(3),
        updatedAt: new Date(),
      },
    }),
    // OnHold case - HOURLY
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2024-015`,
        title: 'Employment Dispute - Former Employee',
        clientId: allClients[0].id,
        status: 'OnHold',
        type: 'Litigation',
        description: 'Employment termination dispute, awaiting client decision',
        openedDate: new Date('2024-11-10'),
        value: 35000.0,
        billingType: 'Hourly',
        metadata: { onHoldReason: 'Awaiting client decision on settlement offer' },
        createdAt: randomPastDate(90),
        updatedAt: new Date(),
      },
    }),
    // Closed case - FIXED billing
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2024-008`,
        title: 'Real Estate Transaction - Property Purchase',
        clientId: allClients[1].id,
        status: 'Closed',
        type: 'Contract',
        description: 'Residential property purchase legal support',
        openedDate: new Date('2024-09-15'),
        closedDate: new Date('2024-12-20'),
        value: 12000.0,
        billingType: 'Fixed',
        fixedAmount: 1200000,
        metadata: { propertyValue: 250000, location: 'Cluj-Napoca' },
        createdAt: randomPastDate(120),
        updatedAt: new Date(),
      },
    }),
    // Archived case - FIXED billing
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2024-003`,
        title: 'Estate Planning and Will',
        clientId: allClients[1].id,
        status: 'Archived',
        type: 'Advisory',
        description: 'Estate planning and will preparation',
        openedDate: new Date('2024-03-10'),
        closedDate: new Date('2024-05-20'),
        value: 5000.0,
        billingType: 'Fixed',
        fixedAmount: 500000,
        metadata: { documentsExecuted: true },
        createdAt: randomPastDate(300),
        updatedAt: new Date(),
      },
    }),
    // Active Criminal case - HOURLY with premium rates
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-004`,
        title: 'Criminal Defense - White Collar Crime',
        clientId: allClients[0].id,
        status: 'Active',
        type: 'Criminal',
        description: 'Defense in fraud investigation',
        openedDate: new Date('2025-01-28'),
        value: 200000.0,
        billingType: 'Hourly',
        customRates: {
          partnerRate: 600, // Premium rates for criminal defense
          associateRate: 400,
        },
        metadata: { courtName: 'High Court of Cassation', urgent: true },
        createdAt: randomPastDate(10),
        updatedAt: new Date(),
      },
    }),
    // Active Litigation case 2 - FIXED
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-005`,
        title: 'Intellectual Property Dispute',
        clientId: allClients[0].id,
        status: 'Active',
        type: 'Litigation',
        description: 'Trademark infringement case',
        openedDate: new Date('2025-02-05'),
        value: 85000.0,
        billingType: 'Fixed',
        fixedAmount: 8500000,
        metadata: { courtName: 'Bucharest Court', trademark: 'ABC-BRAND' },
        createdAt: randomPastDate(12),
        updatedAt: new Date(),
      },
    }),
    // Active Other type - HOURLY
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-006`,
        title: 'Regulatory Compliance Review',
        clientId: allClients[0].id,
        status: 'Active',
        type: 'Other',
        description: 'GDPR and data protection compliance assessment',
        openedDate: new Date('2025-01-10'),
        value: 45000.0,
        billingType: 'Hourly',
        metadata: { scope: 'Full compliance audit' },
        createdAt: randomPastDate(35),
        updatedAt: new Date(),
      },
    }),
    // Closed Litigation case - HOURLY
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2024-012`,
        title: 'Commercial Lease Dispute',
        clientId: allClients[0].id,
        status: 'Closed',
        type: 'Litigation',
        description: 'Landlord-tenant dispute resolution',
        openedDate: new Date('2024-08-20'),
        closedDate: new Date('2024-12-15'),
        value: 28000.0,
        billingType: 'Hourly',
        metadata: { outcome: 'Settled out of court' },
        createdAt: randomPastDate(150),
        updatedAt: new Date(),
      },
    }),
    // Additional cases for KPI testing
    // High value case - Active
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-008`,
        title: 'Major M&A Transaction Advisory',
        clientId: allClients[2].id,
        status: 'Active',
        type: 'Advisory',
        description: 'Legal advisory for company acquisition',
        openedDate: new Date('2025-01-05'),
        value: 500000.0,
        billingType: 'Fixed',
        fixedAmount: 50000000, // $500k
        metadata: { dealValue: 5000000, complexity: 'high' },
        createdAt: randomPastDate(40),
        updatedAt: new Date(),
      },
    }),
    // PendingApproval case 2
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-009`,
        title: 'Family Law - Divorce Proceedings',
        clientId: allClients[3].id,
        status: 'PendingApproval',
        type: 'Litigation',
        description: 'Complex divorce with asset division',
        openedDate: new Date('2025-02-18'),
        value: 60000.0,
        billingType: 'Hourly',
        metadata: { sensitivity: 'high' },
        createdAt: randomPastDate(1),
        updatedAt: new Date(),
      },
    }),
    // Low value case - Active
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-010`,
        title: 'Small Business Formation',
        clientId: allClients[2].id,
        status: 'Active',
        type: 'Contract',
        description: 'SRL formation and registration',
        openedDate: new Date('2025-02-10'),
        value: 3000.0,
        billingType: 'Fixed',
        fixedAmount: 300000,
        metadata: { businessType: 'SRL' },
        createdAt: randomPastDate(8),
        updatedAt: new Date(),
      },
    }),
    // More historical cases for trend analysis
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2024-020`,
        title: 'Construction Contract Dispute',
        clientId: allClients[0].id,
        status: 'Closed',
        type: 'Litigation',
        description: 'Dispute over construction delays and penalties',
        openedDate: new Date('2024-06-15'),
        closedDate: new Date('2024-11-30'),
        value: 180000.0,
        billingType: 'Hourly',
        customRates: {
          partnerRate: 480,
          associateRate: 320,
        },
        metadata: { outcome: 'Won at trial', damages: 120000 },
        createdAt: randomPastDate(200),
        updatedAt: new Date(),
      },
    }),
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2024-018`,
        title: 'Employment Contract Negotiation',
        clientId: allClients[2].id,
        status: 'Closed',
        type: 'Contract',
        description: 'Executive employment contract',
        openedDate: new Date('2024-10-01'),
        closedDate: new Date('2024-11-15'),
        value: 15000.0,
        billingType: 'Fixed',
        fixedAmount: 1500000,
        metadata: { executiveLevel: 'C-suite' },
        createdAt: randomPastDate(130),
        updatedAt: new Date(),
      },
    }),
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2024-005`,
        title: 'Tax Dispute Resolution',
        clientId: allClients[0].id,
        status: 'Closed',
        type: 'Litigation',
        description: 'Corporate tax assessment challenge',
        openedDate: new Date('2024-02-20'),
        closedDate: new Date('2024-08-10'),
        value: 95000.0,
        billingType: 'Hourly',
        metadata: { taxAmount: 500000, outcome: 'Partially successful' },
        createdAt: randomPastDate(320),
        updatedAt: new Date(),
      },
    }),
    // Medium value cases
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-011`,
        title: 'Software Licensing Agreement',
        clientId: allClients[2].id,
        status: 'Active',
        type: 'Contract',
        description: 'Negotiation of enterprise software license',
        openedDate: new Date('2025-01-25'),
        value: 35000.0,
        billingType: 'Hourly',
        metadata: { licenseValue: 2000000 },
        createdAt: randomPastDate(22),
        updatedAt: new Date(),
      },
    }),
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2025-012`,
        title: 'Partnership Dissolution',
        clientId: allClients[3].id,
        status: 'Active',
        type: 'Advisory',
        description: 'Legal advisory for partnership dissolution and asset split',
        openedDate: new Date('2025-02-08'),
        value: 48000.0,
        billingType: 'Hourly',
        customRates: {
          partnerRate: 470,
          associateRate: 310,
        },
        metadata: { partnerCount: 3, complexity: 'medium' },
        createdAt: randomPastDate(10),
        updatedAt: new Date(),
      },
    }),
    // OnHold cases
    prisma.case.create({
      data: {
        id: randomUUID(),
        firmId: firm.id,
        caseNumber: `${firm.id.substring(0, 8)}-2024-025`,
        title: 'Product Liability Investigation',
        clientId: allClients[0].id,
        status: 'OnHold',
        type: 'Litigation',
        description: 'Product defect claim investigation',
        openedDate: new Date('2024-12-01'),
        value: 72000.0,
        billingType: 'Hourly',
        metadata: { onHoldReason: 'Awaiting expert report' },
        createdAt: randomPastDate(70),
        updatedAt: new Date(),
      },
    }),
  ]);
  console.log(`‚úì Created ${cases.length} cases`);

  // Create approval records for PendingApproval cases
  console.log('Creating case approval records...');
  const approvals = [];

  // Find PendingApproval cases (indices 3 and 12 based on the array above)
  const pendingCaseIndices = [3, 12]; // Cases at these indices have PendingApproval status

  for (const idx of pendingCaseIndices) {
    approvals.push(
      await prisma.caseApproval.create({
        data: {
          id: randomUUID(),
          caseId: cases[idx].id,
          submittedBy: users[1].id, // Associate 1 submitted
          submittedAt: cases[idx].createdAt,
          status: 'Pending',
          revisionCount: 0,
          firmId: firm.id,
        },
      })
    );
  }
  console.log(`‚úì Created ${approvals.length} approval records`);

  // Create rate history for some cases with custom rates
  console.log('Creating rate history records...');
  const rateHistories = [];

  // Case 0 - rate change
  rateHistories.push(
    await prisma.caseRateHistory.create({
      data: {
        id: randomUUID(),
        caseId: cases[0].id,
        changedBy: users[0].id,
        changedAt: new Date(cases[0].createdAt.getTime() + 7 * 24 * 60 * 60 * 1000), // 7 days after case created
        rateType: 'partner',
        oldRate: 450,
        newRate: 500,
        firmId: firm.id,
      },
    })
  );

  // Case 7 - rate change for Criminal case
  rateHistories.push(
    await prisma.caseRateHistory.create({
      data: {
        id: randomUUID(),
        caseId: cases[7].id,
        changedBy: users[0].id,
        changedAt: new Date(cases[7].createdAt.getTime() + 3 * 24 * 60 * 60 * 1000), // 3 days after
        rateType: 'partner',
        oldRate: 450,
        newRate: 600,
        firmId: firm.id,
      },
    })
  );

  console.log(`‚úì Created ${rateHistories.length} rate history records`);

  // Create case team assignments
  console.log('Creating case team assignments...');
  const caseTeams = [];
  for (let i = 0; i < cases.length; i++) {
    // Assign Partner as Lead to all cases
    caseTeams.push(
      await prisma.caseTeam.create({
        data: {
          id: randomUUID(),
          caseId: cases[i].id,
          userId: users[0].id, // Partner
          role: 'Lead',
          assignedAt: cases[i].createdAt,
          assignedBy: users[0].id,
        },
      })
    );

    // Assign Associate to most cases
    if (i < 8) {
      caseTeams.push(
        await prisma.caseTeam.create({
          data: {
            id: randomUUID(),
            caseId: cases[i].id,
            userId: users[1 + (i % 2)].id, // Alternate between Associate 1 and 2
            role: 'Support',
            assignedAt: cases[i].createdAt,
            assignedBy: users[0].id,
          },
        })
      );
    }

    // Assign Paralegal to some cases
    if (i % 3 === 0) {
      caseTeams.push(
        await prisma.caseTeam.create({
          data: {
            id: randomUUID(),
            caseId: cases[i].id,
            userId: users[3 + (i % 2)].id, // Alternate between Paralegal 1 and 2
            role: 'Observer',
            assignedAt: cases[i].createdAt,
            assignedBy: users[0].id,
          },
        })
      );
    }
  }
  console.log(`‚úì Created ${caseTeams.length} case team assignments`);

  // Create case actors for each case
  console.log('Creating case actors...');
  const caseActors = [];
  for (let i = 0; i < cases.length; i++) {
    // Add client actor
    caseActors.push(
      await prisma.caseActor.create({
        data: {
          id: randomUUID(),
          caseId: cases[i].id,
          role: 'Client',
          name: i < 7 ? 'Ion Marin' : 'Ana Popescu',
          organization: i < 7 ? 'SC ABC Industries SRL' : null,
          email: i < 7 ? 'ion.marin@abc-industries.ro' : 'ana.popescu@email.ro',
          phone: i < 7 ? '+40-21-123-4567' : '+40-722-111-222',
          address: i < 7 ? 'Bulevardul Unirii 15, Bucure»ôti' : 'Strada Florilor 42, Cluj-Napoca',
          notes: 'Primary client contact',
          createdAt: cases[i].createdAt,
          updatedAt: new Date(),
          createdBy: users[0].id,
        },
      })
    );

    // Add opposing party for litigation cases
    if (cases[i].type === 'Litigation') {
      caseActors.push(
        await prisma.caseActor.create({
          data: {
            id: randomUUID(),
            caseId: cases[i].id,
            role: 'OpposingParty',
            name: i % 2 === 0 ? 'SC XYZ Logistics SRL' : 'Mihai Vasilescu',
            organization: i % 2 === 0 ? 'SC XYZ Logistics SRL' : null,
            email: i % 2 === 0 ? 'legal@xyz-logistics.ro' : 'mihai.vasilescu@email.ro',
            phone: i % 2 === 0 ? '+40-31-888-9999' : '+40-755-333-444',
            address: 'Bucure»ôti, Rom√¢nia',
            notes: 'Opposing party in litigation',
            createdAt: cases[i].createdAt,
            updatedAt: new Date(),
            createdBy: users[0].id,
          },
        })
      );

      // Add opposing counsel
      caseActors.push(
        await prisma.caseActor.create({
          data: {
            id: randomUUID(),
            caseId: cases[i].id,
            role: 'OpposingCounsel',
            name: 'Cabinet Avocat Marinescu & Asocia»õii',
            organization: 'Cabinet Avocat Marinescu & Asocia»õii',
            email: 'office@marinescu-law.ro',
            phone: '+40-21-555-7777',
            address: 'Calea Victoriei 120, Bucure»ôti',
            notes: 'Opposing counsel representation',
            createdAt: cases[i].createdAt,
            updatedAt: new Date(),
            createdBy: users[0].id,
          },
        })
      );
    }

    // Add witnesses to some cases
    if (i % 3 === 0 && cases[i].type === 'Litigation') {
      caseActors.push(
        await prisma.caseActor.create({
          data: {
            id: randomUUID(),
            caseId: cases[i].id,
            role: 'Witness',
            name: 'Elena Radu',
            organization: null,
            email: 'elena.radu@email.ro',
            phone: '+40-733-222-111',
            address: 'Bucure»ôti, Rom√¢nia',
            notes: 'Key witness - former employee',
            createdAt: cases[i].createdAt,
            updatedAt: new Date(),
            createdBy: users[1].id,
          },
        })
      );
    }

    // Add expert to some cases
    if (i % 4 === 0) {
      caseActors.push(
        await prisma.caseActor.create({
          data: {
            id: randomUUID(),
            caseId: cases[i].id,
            role: 'Expert',
            name: 'Dr. Alexandru Popa',
            organization: 'Expert Contabil Autorizat',
            email: 'dr.popa@expert-accounting.ro',
            phone: '+40-21-444-5555',
            address: 'Bucure»ôti, Rom√¢nia',
            notes: 'Financial expert for damages assessment',
            createdAt: cases[i].createdAt,
            updatedAt: new Date(),
            createdBy: users[0].id,
          },
        })
      );
    }
  }
  console.log(`‚úì Created ${caseActors.length} case actors`);

  // Create Time Entries for KPI calculations
  console.log('Creating time entries for KPI calculations...');
  const timeEntries = [];

  // Add time entries for Active cases with billing types
  for (let i = 0; i < cases.length; i++) {
    const caseItem = cases[i];

    // Only add time entries for Active, OnHold, or recently Closed cases
    if (!['Active', 'OnHold', 'Closed'].includes(caseItem.status)) {
      continue;
    }

    // Skip archived cases
    if (caseItem.status === 'Archived') {
      continue;
    }

    // Determine number of time entries based on case
    const entryCount = caseItem.status === 'Closed' ? 15 : Math.floor(Math.random() * 10) + 5;

    // Get team members for this case
    const caseTeamMembers = caseTeams.filter(ct => ct.caseId === caseItem.id);

    for (let j = 0; j < entryCount; j++) {
      // Pick a random team member
      const teamMember = caseTeamMembers[j % caseTeamMembers.length];
      const user = users.find(u => u.id === teamMember.userId);

      // Determine hourly rate based on user role and case custom rates
      let hourlyRate: number;
      const defaultRates = firm.defaultRates as any;
      if (caseItem.customRates) {
        const customRates = caseItem.customRates as any;
        hourlyRate = user?.role === 'Partner'
          ? customRates.partnerRate || defaultRates.partnerRate
          : user?.role === 'Associate'
          ? customRates.associateRate || defaultRates.associateRate
          : customRates.paralegalRate || defaultRates.paralegalRate;
      } else {
        hourlyRate = user?.role === 'Partner'
          ? defaultRates.partnerRate
          : user?.role === 'Associate'
          ? defaultRates.associateRate
          : defaultRates.paralegalRate;
      }

      // Random hours between 0.5 and 8 hours
      const hours = (Math.floor(Math.random() * 15) + 1) * 0.5;

      // Random date within the case timeline
      const entryDate = new Date(
        caseItem.openedDate.getTime() +
        Math.random() * (
          (caseItem.closedDate || new Date()).getTime() - caseItem.openedDate.getTime()
        )
      );

      const descriptions = [
        'Legal research on contract law precedents',
        'Client meeting and case strategy discussion',
        'Document review and analysis',
        'Drafted motion for summary judgment',
        'Court appearance and proceedings',
        'Reviewed and revised client correspondence',
        'Case preparation and evidence organization',
        'Conference call with opposing counsel',
        'Legal memorandum drafting',
        'Discovery document review',
      ];

      timeEntries.push(
        await prisma.timeEntry.create({
          data: {
            id: randomUUID(),
            caseId: caseItem.id,
            userId: teamMember.userId,
            date: entryDate,
            hours: hours,
            hourlyRate: hourlyRate,
            description: descriptions[j % descriptions.length],
            billable: true,
            firmId: firm.id,
            createdAt: entryDate,
            updatedAt: entryDate,
          },
        })
      );
    }
  }
  console.log(`‚úì Created ${timeEntries.length} time entries`);

  // Create Documents (20 documents with various types and statuses)
  console.log('Creating sample documents...');

  // TODO: Uncomment once Document model is added in Story 2.7
  // const documents = [];
  // for (let i = 0; i < 20; i++) {
  //   const doc = await prisma.document.create({
  //     data: {
  //       id: randomUUID(),
  //       case_id: cases[i % cases.length].id,
  //       title: `Document ${i + 1}`,
  //       document_type: ['Contract', 'Pleading', 'Motion', 'Brief', 'Evidence'][i % 5],
  //       status: ['Draft', 'Review', 'Approved', 'Filed'][i % 4],
  //       file_name: `document_${i + 1}.pdf`,
  //       file_size_bytes: Math.floor(Math.random() * 5000000) + 100000,
  //       mime_type: 'application/pdf',
  //       storage_url: `r2://legal-docs/2024/doc_${i + 1}.pdf`,
  //       version: 1,
  //       ai_generated: i % 2 === 0,
  //       created_by_user_id: users[i % users.length].id,
  //       created_at: randomPastDate(90),
  //       updated_at: new Date()
  //     }
  //   });
  //   documents.push(doc);
  // }
  // console.log(`‚úì Created ${documents.length} documents`);

  // Create Tasks (30 tasks with various types and statuses)
  console.log('Creating sample tasks...');

  // TODO: Uncomment once Task model is added in Story 2.8
  // const tasks = [];
  // for (let i = 0; i < 30; i++) {
  //   const dueDate = i < 5
  //     ? randomPastDate(7)  // Overdue
  //     : i < 13
  //       ? futureDateFromNow(Math.floor(Math.random() * 7) + 1)  // Due soon
  //       : futureDateFromNow(Math.floor(Math.random() * 30) + 7); // Due later
  //
  //   const status = i < 12 ? 'Pending' : i < 22 ? 'InProgress' : 'Completed';
  //
  //   const task = await prisma.task.create({
  //     data: {
  //       id: randomUUID(),
  //       case_id: cases[i % cases.length].id,
  //       title: `Task ${i + 1}`,
  //       description: `Description for task ${i + 1}`,
  //       task_type: ['Research', 'DocumentCreation', 'DocumentReview', 'ClientCommunication', 'CourtFiling', 'CasePreparation'][i % 6],
  //       status: status,
  //       priority: ['Low', 'Medium', 'High', 'Critical'][i % 4],
  //       assigned_to_user_id: users[1 + (i % 4)].id,  // Assign to Associates and Paralegals
  //       created_by_user_id: users[0].id,  // Partner creates tasks
  //       due_date: dueDate,
  //       estimated_hours: Math.floor(Math.random() * 8) + 1,
  //       actual_hours: status === 'Completed' ? Math.floor(Math.random() * 10) + 1 : null,
  //       completed_at: status === 'Completed' ? randomPastDate(30) : null,
  //       created_at: randomPastDate(60),
  //       updated_at: new Date()
  //     }
  //   });
  //   tasks.push(task);
  // }
  // console.log(`‚úì Created ${tasks.length} tasks`);

  console.log('');
  console.log('‚úÖ Database seed completed successfully!');
  console.log('');
  console.log('Summary:');
  console.log(`  - Users: ${users.length} (Story 2.4 - Authentication)`);
  console.log(`    ‚Ä¢ ${users.filter((u) => u.status === 'Active').length} Active users`);
  console.log(
    `    ‚Ä¢ ${users.filter((u) => u.status === 'Pending').length} Pending user (awaiting activation)`
  );
  console.log(`    ‚Ä¢ ${users.filter((u) => u.status === 'Inactive').length} Inactive user`);
  console.log(`  - Clients: ${allClients.length} (Story 2.6 - Case Management)`);
  console.log(`  - Cases: ${cases.length} (Story 2.6, 2.8.1, 2.8.2)`);
  console.log(`    ‚Ä¢ ${cases.filter((c) => c.status === 'Active').length} Active cases`);
  console.log(`    ‚Ä¢ ${cases.filter((c) => c.status === 'PendingApproval').length} Pending Approval cases`);
  console.log(`    ‚Ä¢ ${cases.filter((c) => c.status === 'OnHold').length} OnHold cases`);
  console.log(`    ‚Ä¢ ${cases.filter((c) => c.status === 'Closed').length} Closed cases`);
  console.log(`    ‚Ä¢ ${cases.filter((c) => c.status === 'Archived').length} Archived case`);
  console.log(`  - Billing Configuration:`);
  console.log(`    ‚Ä¢ ${cases.filter((c) => c.billingType === 'Hourly').length} Hourly billing cases`);
  console.log(`    ‚Ä¢ ${cases.filter((c) => c.billingType === 'Fixed').length} Fixed fee cases`);
  console.log(`    ‚Ä¢ ${cases.filter((c) => c.customRates !== null).length} cases with custom rates`);
  console.log(`  - Approval Workflow:`);
  console.log(`    ‚Ä¢ ${approvals.length} cases pending approval`);
  console.log(`  - Rate History: ${rateHistories.length} rate changes tracked`);
  console.log(`  - Case Teams: ${caseTeams.length} assignments`);
  console.log(`  - Case Actors: ${caseActors.length} external parties`);
  console.log(`  - Time Entries: ${timeEntries.length} billable hours logged`);
  console.log('');
  console.log('Value Distribution:');
  const totalValue = cases.reduce((sum, c) => sum + Number(c.value || 0), 0);
  console.log(`  - Total case value: $${totalValue.toLocaleString()}`);
  console.log(`  - Average case value: $${Math.round(totalValue / cases.length).toLocaleString()}`);
  console.log(`  - Largest case: $${Math.max(...cases.map((c) => Number(c.value || 0))).toLocaleString()}`);
  console.log(`  - Smallest case: $${Math.min(...cases.map((c) => Number(c.value || 0))).toLocaleString()}`);
  console.log('');
  console.log('Note: Additional models will be added in future stories:');
  console.log('  - Documents: Story 2.7 (Document Management)');
  console.log('  - Tasks: Story 2.8 (Task Management)');
  console.log('');
  console.log('To view data: npx prisma studio');
}

main()
  .then(async () => {
    await prisma.$disconnect();
  })
  .catch(async (e) => {
    console.error('‚ùå Error during seed:', e);
    await prisma.$disconnect();
    process.exit(1);
  });
