# Render.com Infrastructure Configuration
# Legal Platform - Web Frontend Only (for now)
#
# Backend services, database, and Redis will be added when implemented

services:
  ##############################################################################
  # Web Service - Next.js Frontend
  ##############################################################################
  - type: web
    name: legal-platform-web
    runtime: docker
    repo: https://github.com/stoianovici/bojin-law-2.git
    branch: main # Production deploys from main
    dockerfilePath: ./infrastructure/docker/Dockerfile.web
    dockerContext: .
    plan: starter # 512MB RAM - for testing (upgrade to 'standard' for production)
    numInstances: 1 # Single instance for testing (increase to 2+ for production HA)
    region: oregon # US West
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_APP_URL
        value: https://legal-platform-web.onrender.com # Will update with custom domain later
      - key: NEXT_PUBLIC_API_URL
        sync: false # Set in Render dashboard when backend is ready
      - key: DATABASE_URL
        fromDatabase:
          name: legal-platform-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: redis
          name: legal-platform-redis
          property: connectionString
    healthCheckPath: /api/health
    autoDeployTrigger: commit # Auto-deploy on each commit to main

  ##############################################################################
  # Cache - Redis for Session Management
  ##############################################################################
  - type: redis
    name: legal-platform-redis
    plan: pro # 1GB Redis
    region: oregon # US West
    maxmemoryPolicy: allkeys-lru # LRU eviction when memory limit reached
    ipAllowList: [] # Empty = allow all Render services

##############################################################################
# Database - PostgreSQL with pgvector
##############################################################################
databases:
  - name: legal-platform-db
    databaseName: legal_platform_prod
    user: legal_platform_user
    plan: standard # 25GB storage, daily backups with 7-day retention
    region: oregon # US West
    ipAllowList: [] # Empty = allow all Render services (recommended)

##############################################################################
# Future Services (uncomment when implemented)
##############################################################################
# - Gateway Service (GraphQL API)
# - Document Service (File Processing & Storage)
# - AI Service (Claude + Grok with Semantic Search)
# - Task Service (Background Job Processing)
# - Integration Service (Third-Party APIs)
# - Notification Service (Email, SMS, Push)
#
# See infrastructure/ARCHITECTURE.md for full system design
##############################################################################
