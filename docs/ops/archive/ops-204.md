# OPS-204: Restructure NECLAR Action Bar

**Status:** Resolved | **Priority:** P1-High | **Type:** Feature | **Created:** 2025-12-24

## Overview

NECLAR action bar shows "Personal" + "IgnorÄƒ" instead of "RÄƒspunde" (Outlook) + "Privat" (block sender).

## Dependencies

- **Depends on:** OPS-200 (SplitAssignmentButton fix), OPS-202 (blockSenderFromSync mutation)
- **Blocks:** None
- **Parallel with:** OPS-203

## Context

Part of Communications Action Bar Redesign epic. NECLAR (uncertain) emails need quick triage options with the ability to reply via Outlook while keeping the sender blocking capability.

## Requirements

### 1. Current vs Target Layout

**Current:**

```
[SplitAssignmentButton]  [Personal]  [IgnorÄƒ]
```

**Target:**

```
[SplitAssignmentButton (80/20)]  [RÄƒspunde]  [Privat]
```

### 2. Keep SplitAssignmentButton

After OPS-200 fix, the button should render correctly with:

- Primary case (80% width) - cyan/yellow/magenta based on confidence
- Secondary case (20% width) - dropdown trigger
- All suggestions in dropdown

### 3. Add "RÄƒspunde" Button

Small button that opens Outlook (for NECLAR, we use Outlook since email isn't assigned to a case yet):

```tsx
<button
  onClick={() => {
    const lastMessage = thread?.messages[thread.messages.length - 1];
    if (lastMessage) {
      openOutlookReply(lastMessage.senderEmail, thread.subject);
    }
  }}
  className="flex items-center gap-1.5 px-3 py-2 border border-gray-300 text-gray-700 rounded-full hover:bg-white transition-colors text-sm"
>
  <Reply className="h-4 w-4" />
  RÄƒspunde
</button>
```

### 4. Replace "Personal" with "Privat"

Use the new `blockSenderFromSync` mutation:

```tsx
const [blockSender, { loading: blocking }] = useMutation(BLOCK_SENDER_FROM_SYNC);

const handleBlockSender = async () => {
  if (!neclarData) return;

  try {
    await blockSender({ variables: { emailId: neclarData.id } });
    addNotification({
      type: 'success',
      title: 'Expeditor blocat',
      message: 'Emailurile de la acest expeditor nu vor mai fi sincronizate',
    });
    onNeclarAssigned?.(); // Remove from view
  } catch (error) {
    addNotification({
      type: 'error',
      title: 'Eroare',
      message: 'Nu s-a putut bloca expeditorul',
    });
  }
};

<button
  onClick={handleBlockSender}
  disabled={blocking}
  className="flex items-center gap-1.5 px-3 py-2 border border-gray-300 text-gray-700 rounded-full hover:bg-white transition-colors text-sm"
>
  {blocking ? <Loader2 className="h-4 w-4 animate-spin" /> : <Ban className="h-4 w-4" />}
  Privat
</button>;
```

### 5. Remove "IgnorÄƒ" Button

Delete the ignore button and its handler (`handleNeclarIgnore`).

## Acceptance Criteria

- [x] SplitAssignmentButton visible with case suggestions (after OPS-200)
- [x] "RÄƒspunde" opens Outlook with reply context
- [x] "Privat" calls blockSenderFromSync mutation (via markSenderAsPersonal)
- [x] "Privat" removes email from view after blocking
- [x] "IgnorÄƒ" button removed
- [x] "Personal" button removed

## Files to Modify

- `apps/web/src/components/communication/ConversationView.tsx`

## Estimated Scope

Medium - Action bar restructure with new mutation integration.

---

## Session Log

### Session 1 - 2025-12-24

**Completed:**

1. Added `Ban` and `ExternalLink` icons to imports
2. Added `openOutlookReply` import from outlook utils
3. Created `handleNeclarReply` handler that opens Outlook reply for NECLAR emails
4. Updated NECLAR action bar layout:
   - Keep SplitAssignmentButton (80/20 split for case assignment)
   - Added "RÄƒspunde" button with Reply icon + ExternalLink (opens Outlook reply)
   - Replaced "Personal" button â†’ "Privat" with Ban icon (blocks sender via markSenderAsPersonal)
   - Removed "IgnorÄƒ" button and its handler

**Final NECLAR Action Bar Layout:**

```
[SplitAssignmentButton (80/20)]  [RÄƒspunde ðŸ”—]  [Privat ðŸš«]
```

**Notes:**

- Used existing `markSenderAsPersonal` mutation (from OPS-190) for "Privat" button
- This mutation already adds sender to PersonalContact and ignores the email
- The outlook utils `openOutlookReply` function handles reply with proper subject prefix

**Status:** Resolved
