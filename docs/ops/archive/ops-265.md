# OPS-265: CreateTaskModal Component

**Type**: Feature | **Priority**: P2-Medium | **Status**: Completed

## Problem

Main modal component needed that combines case picker, form fields, and subtask builder into a polished, minimal interface. Current `TaskDetailModal` is 800+ lines handling both create and edit modes with unnecessary complexity for task creation.

## Approach

Create `CreateTaskModal` with clean layout:

- Radix Dialog base (match existing modal patterns)
- ~480px max-width, no scroll needed
- Layout:
  1. Case picker (required, uses `CaseCombobox`)
  2. Title input (required)
  3. Row: Due Date + Estimated Time (both required)
  4. Collapsible description (hidden by default)
  5. Subtask section (uses `SubtaskBuilder`)
  6. Footer: Cancel + Create buttons
- Validation: case, title, dueDate, estimatedHours required
- On submit: call `createTask` mutation, then batch create subtasks
- Defaults: priority=Medium, status=Pending, assignedTo=currentUser

## Done When

- [x] Modal opens/closes correctly
- [x] All required fields validate before submit
- [x] Case selection works via CaseCombobox
- [x] Estimated time accepts hours (number input with "ore" suffix)
- [x] Description expands on click
- [x] Subtasks collected via SubtaskBuilder
- [x] Submit creates task then subtasks in sequence
- [x] Modal closes on success
- [x] Loading states shown during save

## Files

- `apps/web/src/components/task/CreateTaskModal.tsx` (new)
- `apps/web/src/hooks/useCreateTaskWithSubtasks.ts` (new)

## Reference

- Modal pattern: `apps/web/src/components/task/TaskDetailModal.tsx`
- Subtask creation: `apps/web/src/hooks/useSubtasks.ts`

## Technical Notes

### Form Layout (ASCII)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SarcinÄƒ NouÄƒ                                  [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                   â”‚
â”‚ Dosar *                                           â”‚
â”‚ [ðŸ” CautÄƒ dosar...                            â–¼]  â”‚
â”‚                                                   â”‚
â”‚ Titlu *                                           â”‚
â”‚ [                                               ] â”‚
â”‚                                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Termen *             â”‚ â”‚ Timp estimat *       â”‚ â”‚
â”‚ â”‚ [ðŸ“… 26 dec 2025   ]  â”‚ â”‚ [â±ï¸ 2 ore       ]    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                   â”‚
â”‚ [+ AdaugÄƒ descriere]                              â”‚
â”‚                                                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                   â”‚
â”‚ Sub-sarcini                                       â”‚
â”‚ â—‹ Cercetare jurisprudenÈ›Äƒ                    [Ã—]  â”‚
â”‚ â—‹ Redactare draft                            [Ã—]  â”‚
â”‚ [+ AdaugÄƒ sub-sarcinÄƒ...]                         â”‚
â”‚                                                   â”‚
â”‚                       [AnuleazÄƒ] [CreeazÄƒ â†’]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Hook Interface

```tsx
function useCreateTaskWithSubtasks() {
  return {
    createTaskWithSubtasks: async (taskInput: CreateTaskInput, subtasks: SubtaskDraft[]) =>
      Promise<Task>,
    loading: boolean,
    error: ApolloError | null,
  };
}
```

### Validation Rules

- `caseId`: required
- `title`: required, min 1 char
- `dueDate`: required
- `estimatedHours`: required, > 0

### Defaults

- `type`: 'Research' (or omit if backend has default)
- `priority`: 'Medium'
- `status`: 'Pending'
- `assignedTo`: current user ID

## Session Log

### 2025-12-26: Completed

**Created Files**:

1. `apps/web/src/hooks/useCreateTaskWithSubtasks.ts` - Hook for two-step task creation:
   - Creates parent task via `createTask` mutation
   - Batch creates subtasks with the new task ID
   - Handles loading/error states
   - Refetches task queries on success

2. `apps/web/src/components/task/CreateTaskModal.tsx` - Minimal creation modal:
   - Radix Dialog base with ~400px max-width
   - CaseCombobox for required case selection
   - Title input (required)
   - Grid row: Due date + Estimated hours (both required with icons)
   - Collapsible description (hidden by default)
   - SubtaskBuilder for local subtask collection
   - Form validation with error messages
   - Loading state during save
   - Assigns to current user, defaults to 'Research' type, 'Medium' priority

**Design Decisions**:

- Used controlled form state with `useState` (simpler than form library for this scope)
- Kept validation inline rather than schema-based (4 simple required fields)
- Modal resets on open to ensure clean state
- Submit button disabled during loading with spinner

**TypeScript**: Compiles successfully (1 pre-existing error in unrelated file)
