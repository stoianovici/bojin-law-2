# OPS-270: AttachmentPreviewPanel Time Grouping

**Status**: Completed
**Type**: Feature
**Priority**: P2-Medium
**Complexity**: S
**Blocked by**: OPS-267, OPS-268

## Problem

The "Atasamente in conversatie" list at bottom of preview panel shows all attachments in a flat list. Long email threads with many attachments become hard to navigate.

## Approach

Group attachment list by `messageDate`:

- Use `useTimePeriodGroups` with `messageDate` as date field
- Wrap each period's attachments in compact `TimePeriodSection`
- Keep navigation arrows working across all attachments
- Current attachment indicator works within grouped structure

### Implementation Notes

The attachment list at the bottom of `AttachmentPreviewPanel` (lines 806-833) currently renders a flat list:

```tsx
// Current
<div className="space-y-1">
  {threadAttachments.map((att) => (
    <button ... />
  ))}
</div>

// After
const periods = useTimePeriodGroups(threadAttachments, (att) => att.messageDate);

{periods.map((period) => (
  <TimePeriodSection
    key={period.key}
    periodKey={period.key}
    label={period.label}
    count={period.items.length}
    defaultOpen={period.defaultOpen}
    storageKey="attachments-time"
  >
    <div className="space-y-1">
      {period.items.map((att) => (
        <button ... />
      ))}
    </div>
  </TimePeriodSection>
))}
```

Navigation arrows and counter need to work across all flattened attachments (not change).

## Done When

- [x] Attachment list grouped by time period
- [x] Sections collapsible with persisted state
- [x] Arrow navigation still works across all attachments
- [x] Current attachment highlighted correctly
- [x] Counter shows total across all periods

## Files

- `apps/web/src/components/communication/AttachmentPreviewPanel.tsx` (modified)

## Session Log

### 2024-12-26 - Implementation Complete

**Changes made:**

1. Added imports for `useTimePeriodGroups` hook and `TimePeriodSection` component
2. Added `attachmentPeriods` computed from `threadAttachments` using `messageDate` field
3. Replaced flat attachment list with grouped `TimePeriodSection` components
4. Increased max-height from 48 to 56 to accommodate section headers

**Key design decisions:**

- Navigation arrows and counter continue to use flat `threadAttachments` array (lines 471-484)
- Only the visual display is grouped - navigation across all attachments works unchanged
- Storage key set to `attachment-preview-time` for localStorage persistence
- Current attachment highlighting preserved within grouped view

**TypeScript compilation:** Verified no errors in AttachmentPreviewPanel
