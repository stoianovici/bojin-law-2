# OPS-142: AI Prompts Romanian Localization

| Field        | Value            |
| ------------ | ---------------- |
| **Status**   | Root Cause Found |
| **Type**     | Feature          |
| **Priority** | P2-Medium        |
| **Created**  | 2025-12-24       |

## Symptom

AI-generated content displays in English instead of Romanian. Example from Communications page:

- Email body shows: "This appears to be a newsletter from Lege5 listing official Romanian legislative publications..."
- Should show Romanian text for Romanian law firm users

## Root Cause

**16+ AI service files have English-only prompts.** The AI responds in the language of the prompt, causing English output for Romanian users.

### Primary Culprit (Screenshot Issue)

**File**: `services/gateway/src/services/email-cleaner.service.ts`

- `EXTRACTION_PROMPT` is in English
- When AI can't extract clean content from newsletters, it returns English explanatory text
- Some Romanian fallback phrases exist but main prompt is English

### Files Requiring Romanian Localization

#### HIGH PRIORITY (User-Facing Output)

| File                                                               | Prompt                         | Impact                               |
| ------------------------------------------------------------------ | ------------------------------ | ------------------------------------ |
| `services/gateway/src/services/email-cleaner.service.ts`           | `EXTRACTION_PROMPT`            | Cleaned email content shown to users |
| `services/ai-service/src/services/email-drafting.service.ts`       | `TONE_PROMPTS` (4 tones)       | Generated email drafts               |
| `services/ai-service/src/services/email-drafting.service.ts`       | `RECIPIENT_ADAPTATIONS`        | Email tone adaptation                |
| `services/ai-service/src/services/proactive-suggestion.service.ts` | `CONTEXTUAL_SUGGESTION_PROMPT` | User-visible suggestions             |
| `services/ai-service/src/services/response-suggestion.service.ts`  | Dynamic prompts                | Suggested responses                  |

#### MEDIUM PRIORITY (Affects Output Quality)

| File                                                                     | Prompt                                  | Impact                         |
| ------------------------------------------------------------------------ | --------------------------------------- | ------------------------------ |
| `services/ai-service/src/services/task-parser.service.ts`                | `TASK_PARSING_SYSTEM_PROMPT`            | Task creation from NL          |
| `services/ai-service/src/services/document-generation.service.ts`        | `DOCUMENT_TYPE_PROMPTS` (6 types)       | Document generation            |
| `services/ai-service/src/services/document-generation.service.ts`        | `BASE_SYSTEM_PROMPT`                    | Document generation            |
| `services/ai-service/src/services/communication-intelligence.service.ts` | `INTELLIGENCE_EXTRACTION_SYSTEM_PROMPT` | Deadline/commitment extraction |
| `services/ai-service/src/services/thread-analysis.service.ts`            | `THREAD_ANALYSIS_SYSTEM_PROMPT`         | Thread analysis                |
| `services/ai-service/src/services/email-classification.service.ts`       | `SEMANTIC_CLASSIFICATION_PROMPT`        | Email routing                  |
| `services/ai-service/src/services/email-categorization.service.ts`       | `EMAIL_CATEGORIZATION_SYSTEM_PROMPT`    | Email categorization           |
| `services/ai-service/src/services/risk-detection.service.ts`             | `RISK_DETECTION_SYSTEM_PROMPT`          | Risk detection                 |
| `services/ai-service/src/services/draft-refinement.service.ts`           | `REFINEMENT_SYSTEM_PROMPT`              | Draft refinement               |
| `services/ai-service/src/services/word-ai.service.ts`                    | `SUGGESTION_PROMPTS`                    | Word suggestions               |
| `services/ai-service/src/services/case-conversation-summary.service.ts`  | `CASE_SUMMARY_SYSTEM_PROMPT`            | Case summaries                 |
| `services/gateway/src/services/natural-language-command.service.ts`      | `INTENT_DETECTION_SYSTEM_PROMPT`        | NLC parsing                    |

#### ALREADY LOCALIZED (No Action Needed)

| File                                                       | Prompt                          | Status           |
| ---------------------------------------------------------- | ------------------------------- | ---------------- |
| `services/ai-service/src/services/ai-system-prompt.ts`     | `LEGAL_ASSISTANT_SYSTEM_PROMPT` | Already Romanian |
| `services/gateway/src/services/ai-orchestrator.service.ts` | `ERROR_MESSAGES`                | Already Romanian |

## Fix Strategy

### Option A: Add "Respond in Romanian" Instruction

Add to each prompt: `"IMPORTANT: Always respond in Romanian (limba română)."`

**Pros**: Simple, minimal changes
**Cons**: AI may still use English technical terms

### Option B: Full Romanian Prompts

Translate entire prompts to Romanian.

**Pros**: Most natural Romanian output
**Cons**: More work, needs legal terminology review

### Option C: Hybrid Approach (Recommended)

1. Keep prompts in English (easier to maintain)
2. Add strong Romanian output instruction
3. Provide Romanian examples in prompts
4. Use Romanian fallback phrases

Example fix for email-cleaner.service.ts:

```typescript
const EXTRACTION_PROMPT = `Extract only the new message content from this email...

IMPORTANT: Always respond in Romanian (limba română). Never use English in your response.

Examples of proper Romanian responses:
- For forwarded emails: "[Mesaj redirecționat fără conținut nou]"
- For attachments only: "[Doar atașament]"
- For newsletters: "[Newsletter informativ - fără conținut personal]"
`;
```

## Implementation Tasks

- [ ] **Phase 1**: Fix email-cleaner.service.ts (immediate fix for screenshot issue)
- [ ] **Phase 2**: Fix HIGH PRIORITY files (user-facing output)
- [ ] **Phase 3**: Fix MEDIUM PRIORITY files (quality improvement)
- [ ] **Phase 4**: Add integration tests for Romanian output

## Verification

After fix:

1. Trigger email categorization worker on a newsletter email
2. Verify `bodyContentClean` contains Romanian text
3. Check Communications page shows Romanian in conversation bubbles
4. Test AI suggestions show Romanian

## Related Issues

- OPS-015: Translate English UI sections to Romanian (Resolved)
- OPS-090: Email Content Cleaning for Readability (Closed)
