# OPS-020: Redesign AI Bar - Floating Pill Design

| Field           | Value      |
| --------------- | ---------- |
| **Status**      | Resolved   |
| **Type**        | Feature    |
| **Priority**    | P2-Medium  |
| **Created**     | 2025-12-14 |
| **Resolved**    | 2025-12-14 |
| **Sessions**    | 1          |
| **Last Active** | 2025-12-14 |

## Description

Redesign the QuickActionsBar (AI bar) with a modern floating pill design that is:

1. Collapsible and collapsed by default
2. Pill-shaped (rounded capsule)
3. Suggestions moved inside/below the input
4. Fixed width, centered on screen
5. Expand animation on interaction

## Resolution

Implemented a modern floating pill design with the following features:

### Collapsed State

- Gradient purple pill button with lightning bolt icon and "Asistent AI" text
- Centered at bottom of screen (`bottom-6`)
- Smooth hover scale effect and shadow transitions
- Click to expand

### Expanded State

- Glass-morphism design with `backdrop-blur-xl` and semi-transparent white background
- Fixed width (`max-w-xl`, ~576px), centered
- Rounded corners (`rounded-2xl`)
- Input field with purple accent
- Quick action chips with icons below input (SarcinÄƒ, Document, Termen, Email, Timp)
- Smooth `slide-in-from-bottom-4` animation on expand
- Footer hint showing Esc key to close

### Interactions

- Click outside to collapse
- Press Esc to collapse
- Auto-collapse after successful command (3s delay)
- Auto-focus input on expand

### Default State

- Changed default from `quickActionsVisible: true` to `false` (collapsed by default)

## Files Changed

### Session 1 - Floating Pill Design

- `apps/web/src/components/case/QuickActionsBar.tsx` - Complete redesign
- `apps/web/src/stores/case-workspace.store.ts` - Default to collapsed
- `apps/web/src/components/case/QuickActionsBar.test.tsx` - Updated tests
- `apps/web/src/components/case/QuickActionsBar.stories.tsx` - Updated stories

### Session 2 - Global Context-Aware

- `apps/web/src/contexts/AIAssistantContext.tsx` - NEW: Context provider for section tracking
- `apps/web/src/components/layout/MainLayout.tsx` - Added AIAssistantProvider and QuickActionsBar
- `apps/web/src/hooks/useNaturalLanguageCommand.ts` - Added section param and new intents
- `apps/web/src/app/cases/[caseId]/page.tsx` - Removed local QuickActionsBar, added useSetAIContext
- `apps/web/src/app/page.tsx` - Added useSetAIContext('dashboard')
- `apps/web/src/app/communications/page.tsx` - Added useSetAIContext('communications')
- `apps/web/src/app/tasks/page.tsx` - Added useSetAIContext('tasks')
- `apps/web/src/app/documents/page.tsx` - Added useSetAIContext('documents')

## Session Log

- [2025-12-14] Session 1: Implemented floating pill redesign
  - Redesigned component with collapsed/expanded states
  - Added glass-morphism styling and animations
  - Added click-outside and Esc key handlers
  - Added icon-enhanced quick action chips
  - Updated store default
  - Updated tests (12 passing)
  - Updated Storybook stories

- [2025-12-14] Session 2: Made AI bar global and context-aware
  - Created `AIAssistantContext` provider for section tracking
  - Made QuickActionsBar context-aware with per-section suggestions
  - Moved bar from case page to MainLayout (global for authenticated areas)
  - Added context setters to key pages (dashboard, communications, tasks, documents, case)
  - Updated useNaturalLanguageCommand hook to accept optional caseId and section
  - Added new intents: SEARCH, GENERATE_DOCUMENT, SUMMARIZE, FILTER, CREATE_REMINDER
  - Updated tests (13 passing)
