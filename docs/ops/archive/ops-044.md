# [OPS-044] Manual email thread reassignment UI

| Field           | Value      |
| --------------- | ---------- |
| **Status**      | Resolved   |
| **Type**        | Feature    |
| **Priority**    | P2-Medium  |
| **Created**     | 2025-12-19 |
| **Sessions**    | 2          |
| **Last Active** | 2025-12-19 |

## Description

Add UI to manually reassign/move email threads between cases. Users should be able to select emails in a case folder and move them to a different case. This is useful when:

- Emails were incorrectly auto-classified
- Case organization changes
- User wants to consolidate communications

**User Story:**

- User viewing "TT Solaria c. UAT" case in /communications
- Some emails actually belong to "TT Solaria c. ABC Development"
- User should be able to select thread(s) and move to ABC Development case

## Existing Infrastructure

Backend mutations already exist:

- `assignThreadToCase(conversationId, caseId)` - in email.resolvers.ts line 877
- `moveEmailToCase()` - in classification-review.resolvers.ts line 379 (with full audit trail)

Frontend patterns exist:

- `MessageView.tsx` has `ASSIGN_THREAD_TO_CASE` mutation (line 52-64)
- `ClassificationModal.tsx` has case search/selection UI
- `useMyCases()` hook for available cases

**Gap:** No UI to trigger reassignment from a case folder context (only from unassigned/NECLAR views).

## Proposed Solution

Add "Move to case" action to email threads in the case view:

1. **Option A: Context menu on thread**
   - Right-click or kebab menu on thread item in CaseSidebar
   - Opens case selection modal
   - Uses existing `assignThreadToCase` mutation

2. **Option B: Batch selection mode**
   - Checkbox selection on threads
   - "Move selected" button appears
   - Bulk move using `bulkAssignEmails` mutation

**Recommended:** Start with Option A (simpler), add Option B later if needed.

## Environment Strategy

| Mode                   | Command                        | Use When                |
| ---------------------- | ------------------------------ | ----------------------- |
| Local dev (default)    | `pnpm dev`                     | Feature development     |
| Production data        | `source .env.prod && pnpm dev` | Testing with real cases |
| Production-like Docker | `pnpm preview`                 | Pre-deploy verification |

**Recommended for this issue**: Local dev

## Local Verification Status

| Step           | Status     | Date | Notes |
| -------------- | ---------- | ---- | ----- |
| Prod data test | ⬜ Pending |      |       |
| Preflight      | ⬜ Pending |      |       |
| Docker test    | ⬜ Pending |      |       |

**Verified**: No

> Issue cannot be closed until all three steps pass

## Conventions to Follow

- Use `'use client'` directive for React components
- Use `clsx` for conditional classes
- UI text in Romanian ("Mută în alt dosar", "Selectează dosarul")
- Use existing modal patterns from ClassificationModal
- Use `useNotificationStore` for success/error messages

## Files Involved

**Frontend (apps/web):**

- `src/components/communication/CaseSidebar.tsx` - Add kebab menu to thread items
- `src/components/communication/MoveThreadModal.tsx` - New modal component (based on ClassificationModal pattern)
- `src/hooks/useMyEmailsByCase.ts` - May need refetch after move

**Backend (services/gateway):**

- `src/graphql/resolvers/email.resolvers.ts` - `assignThreadToCase` (line 877) - already exists
- `src/graphql/resolvers/classification-review.resolvers.ts` - `moveEmailToCase` (line 379) - already exists

## Session Log

- [2025-12-19 09:40] Issue created. Initial triage: Backend infrastructure exists (`assignThreadToCase`, `moveEmailToCase`). Frontend has patterns in MessageView and ClassificationModal. Need to add UI trigger from case folder view in CaseSidebar.
- [2025-12-19] Session 2 started. Implemented full feature:
  - Created `MoveThreadModal.tsx` component based on ClassificationModal pattern
  - Added kebab menu (MoreVertical icon) to ThreadItem in CaseSidebar
  - Added `onMoveThread` callback through component chain
  - Integrated modal into /communications page
  - TypeScript passes. Ready for local testing.
