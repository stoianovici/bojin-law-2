# OPS-137: DocumentPreviewModal Action Toolbar Component

**Status**: Implemented
**Type**: Feature
**Priority**: P2-Medium
**Complexity**: M (Medium)
**Created**: 2024-12-24

## Context

Part of the Context-Aware Document Preview Actions epic. Core UI component that adds action toolbar to the preview modal.

## Problem

DocumentPreviewModal currently only has a header with close/download buttons. Users must close the modal to perform actions like "Add to Mapa". Need a configurable action toolbar that displays context-appropriate actions.

## Solution

Add a footer action toolbar to DocumentPreviewModal that:

- Displays primary actions as prominent buttons
- Displays secondary actions in compact format
- Receives actions via props (or uses defaults from context)
- Triggers callbacks when actions are clicked

## Implementation

### Updated Props Interface

```typescript
interface DocumentPreviewModalProps {
  // ... existing props
  isOpen: boolean;
  onClose: () => void;
  document: PreviewableDocument | null;

  // New props
  context?: PreviewContext;
  actions?: PreviewAction[]; // Override defaults
  onAction?: (actionId: string, document: PreviewableDocument) => void;
}
```

### Action Toolbar Component

```tsx
// Internal component within DocumentPreviewModal.tsx

interface ActionToolbarProps {
  actions: PreviewAction[];
  onAction: (actionId: string) => void;
  loading?: Record<string, boolean>; // Per-action loading states
}

function ActionToolbar({ actions, onAction, loading }: ActionToolbarProps) {
  const primaryActions = actions.filter((a) => a.group === 'primary');
  const secondaryActions = actions.filter((a) => a.group === 'secondary');

  return (
    <div className="flex items-center justify-between border-t bg-gray-50 px-4 py-3">
      {/* Primary actions - full buttons */}
      <div className="flex gap-2">
        {primaryActions.map((action) => (
          <Button
            key={action.id}
            variant={action.variant}
            onClick={() => onAction(action.id)}
            disabled={loading?.[action.id]}
          >
            <Icon name={action.icon} className="mr-2 h-4 w-4" />
            {action.label}
          </Button>
        ))}
      </div>

      {/* Secondary actions - icon buttons or dropdown */}
      <div className="flex gap-1">
        {secondaryActions.map((action) => (
          <IconButton
            key={action.id}
            icon={action.icon}
            title={action.label}
            variant={action.variant}
            onClick={() => onAction(action.id)}
            disabled={loading?.[action.id]}
          />
        ))}
      </div>
    </div>
  );
}
```

### Modal Layout Update

```tsx
// DocumentPreviewModal.tsx - updated structure

return (
  <Dialog open={isOpen} onOpenChange={onClose}>
    <DialogContent className="flex h-[90vh] max-w-6xl flex-col">
      {/* Header - existing */}
      <DialogHeader>...</DialogHeader>

      {/* Preview content - existing, flex-1 */}
      <div className="flex-1 overflow-hidden">{renderPreview()}</div>

      {/* NEW: Action toolbar footer */}
      {resolvedActions.length > 0 && (
        <ActionToolbar actions={resolvedActions} onAction={handleAction} loading={actionLoading} />
      )}
    </DialogContent>
  </Dialog>
);
```

### Action Resolution Logic

```typescript
// Inside DocumentPreviewModal

const resolvedActions = useMemo(() => {
  // If custom actions provided, use those
  if (actions) return actions;

  // If context provided, use defaults for that context
  if (context) return DEFAULT_PREVIEW_ACTIONS[context];

  // No actions
  return [];
}, [actions, context]);

const handleAction = useCallback(
  (actionId: string) => {
    if (document && onAction) {
      onAction(actionId, document);
    }
  },
  [document, onAction]
);
```

## Visual Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ Document Name.pdf                    [â†—] [â¬‡] [âœ•]   â”‚  Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚                                                         â”‚
â”‚                   Document Preview                      â”‚  Content
â”‚                                                         â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ“ MapÄƒ] [â¬‡ DescarcÄƒ]              [âœï¸] [ğŸ“‚] [ğŸ”—] [ğŸ—‘] â”‚  Action Toolbar
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     Primary actions                    Secondary actions
```

## Done When

- [x] New props added to DocumentPreviewModalProps interface
- [x] ActionToolbar component created
- [x] Footer section added to modal layout
- [x] Primary actions render as full buttons with icons + labels
- [x] Secondary actions render as icon buttons with tooltips
- [x] Action clicks trigger onAction callback
- [x] Falls back to default actions from context
- [x] Loading states supported per action
- [x] Danger variant actions styled appropriately (red)
- [x] Works with existing modal functionality (no regressions)
- [x] Responsive on mobile (actions stack or collapse)

## Files

- `apps/web/src/components/preview/DocumentPreviewModal.tsx`

## Dependencies

- **Blocks**: OPS-139, OPS-140, OPS-141
- **Blocked by**: OPS-134 (types)

## Epic

Context-Aware Document Preview Actions (Phase 2 - UI Components)
