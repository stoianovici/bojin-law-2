# OPS-266: CreateTaskModal Integration

**Type**: Feature | **Priority**: P2-Medium | **Status**: Completed

## Problem

New modal needs to be wired into the tasks page, replacing the current "new task" flow that uses `TaskDetailModal` in create mode.

## Approach

Update tasks page and store:

- Add `CreateTaskModal` to tasks page layout
- Add `isCreateModalOpen` state to task management store
- Update "Adaugă Sarcină" button to open new modal
- Keep `TaskDetailModal` for editing only
- Ensure calendar view also uses new modal for quick-add

## Done When

- [x] "Creează" button opens CreateTaskModal
- [x] Task created successfully appears in list
- [x] Subtasks created and visible when editing
- [x] Old TaskDetailModal still works for editing
- [x] Store actions typed correctly

## Files

- `apps/web/src/app/tasks/page.tsx`
- `apps/web/src/stores/taskManagementStore.ts`
- `apps/web/src/app/tasks/calendar/page.tsx` (if exists)

## Reference

- Current integration: `apps/web/src/app/tasks/page.tsx`
- Store: `apps/web/src/stores/taskManagementStore.ts`

## Technical Notes

### Store Updates

```tsx
interface TaskManagementStore {
  // Existing...

  // New
  isCreateModalOpen: boolean;
  openCreateModal: () => void;
  closeCreateModal: () => void;
}
```

### Page Integration

```tsx
// In tasks/page.tsx
<CreateTaskModal
  isOpen={isCreateModalOpen}
  onClose={closeCreateModal}
  onSuccess={(task) => {
    closeCreateModal();
    refetchTasks();
  }}
/>
```

### Button Update

Change "Adaugă Sarcină" from:

```tsx
onClick={() => openTaskDetailModal(null)}
```

To:

```tsx
onClick={() => openCreateModal()}
```

## Session Log

### 2025-12-26: Completed

**Store Updates** (`apps/web/src/stores/task-management.store.ts`):

1. Added `isCreateModalOpen: boolean` state
2. Added `openCreateModal()` action
3. Added `closeCreateModal()` action

**Tasks Page Updates** (`apps/web/src/app/tasks/page.tsx`):

1. Replaced `TaskCreationBar` import with `CreateTaskModal`
2. Connected store's `isCreateModalOpen`, `openCreateModal`, `closeCreateModal`
3. Updated "Creează" button to call `openCreateModal`
4. Added `CreateTaskModal` component with `onSuccess` callback that refetches tasks
5. Removed unused `TaskCreationBar` modal and its handler

**Design Decisions**:

- Removed the natural language `TaskCreationBar` in favor of the new structured modal
- `TaskDetailModal` remains for editing tasks (click on existing task opens it)
- Tasks refetch automatically on successful creation via Apollo's refetch
- Modal state managed in Zustand store for consistency

**TypeScript**: Compiles successfully (1 pre-existing error in unrelated file)
