# OPS-245: Batch Job History Page

**Type**: Feature
**Priority**: P2-Medium
**Status**: Completed
**Epic**: AI Batch Processing & Ops Dashboard

## Problem

No visibility into batch job execution history or failures. Can't diagnose why a processor failed.

## Solution

Create `/admin/ai-ops/history` page with job execution logs.

### Page Layout

```
┌─────────────────────────────────────────────────────────────┐
│  Istoric Joburi                     [Toate ▼] [Exportă]    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Job                  Start           Durată  Elem  Status  │
│  ─────────────────────────────────────────────────────────  │
│  Index Căutare        25 Dec 03:00    4m 23s   47    ✓     │
│  Briefing-uri         25 Dec 05:00    2m 11s    8    ✓     │
│  Scor Sănătate        25 Dec 03:15    1m 45s   34    ✓     │
│  Sumarizare Thread    25 Dec 03:30    0m 58s   12    ✓     │
│  ─────────────────────────────────────────────────────────  │
│  Index Căutare        24 Dec 03:00    5m 02s   52    ✓     │
│  Briefing-uri         24 Dec 05:00    2m 34s    8    ✓     │
│  ▼ Index Căutare      23 Dec 03:00    3m 45s   38    ⚠     │
│    └─ 2 documente eșuate:                                   │
│       - doc-123: Timeout la API                             │
│       - doc-456: Token limit exceeded                       │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  [← Anterior]                              [Următorul →]    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Status Indicators

| Status    | Icon | Color  | Meaning                          |
| --------- | ---- | ------ | -------------------------------- |
| completed | ✓    | Green  | All items processed successfully |
| partial   | ⚠   | Yellow | Some items failed                |
| failed    | ✗    | Red    | Job crashed                      |
| running   | ⟳    | Blue   | Currently executing              |

### Job Row Component

```tsx
function JobRow({ job }: { job: AIBatchJobRun }) {
  const [expanded, setExpanded] = useState(false);

  return (
    <>
      <tr
        className={clsx(
          'cursor-pointer hover:bg-gray-50',
          job.status === 'failed' && 'bg-red-50',
          job.status === 'partial' && 'bg-yellow-50'
        )}
        onClick={() => setExpanded(!expanded)}
      >
        <td>{job.featureName}</td>
        <td>{formatDateTime(job.startedAt)}</td>
        <td>{formatDuration(job.startedAt, job.completedAt)}</td>
        <td>{job.itemsProcessed}</td>
        <td>
          <StatusBadge status={job.status} />
        </td>
      </tr>

      {expanded && job.errorMessage && (
        <tr>
          <td colSpan={5} className="bg-gray-50 p-4">
            <pre className="text-sm text-red-600 whitespace-pre-wrap">{job.errorMessage}</pre>
          </td>
        </tr>
      )}
    </>
  );
}
```

### Filters

- **Processor type**: All, Search Index, Briefings, etc.
- **Status**: All, Success, Partial, Failed
- **Date range**: Last 7 days, 30 days, etc.

## Acceptance Criteria

- [x] Job history table with pagination
- [x] Status badges with colors (green/yellow/red/blue)
- [x] Expandable error details for failed jobs
- [x] Filter by processor type
- [x] Filter by status
- [x] Duration calculated from start/end times
- [x] Token and cost columns
- [x] Refresh button to update list
- [x] Export to CSV functionality

## Files to Modify

- `apps/web/src/app/admin/ai-ops/history/page.tsx` (new)
- `apps/web/src/components/admin/JobHistoryTable.tsx` (new)
- `apps/web/src/components/admin/StatusBadge.tsx` (new)

## Dependencies

- OPS-241 (GraphQL schema)
- OPS-242 (Admin layout)

## Parallel Work

Can be done in parallel with OPS-243, OPS-244, OPS-246.
