# OPS-273: Timesheet Mode UI

**Type**: Feature
**Priority**: P1-High
**Status**: Closed
**Blocked By**: ~~OPS-271~~ (Complete)

## Problem

Need structured table view for timesheet preparation before invoicing. Partners must see time entries in a format suitable for client billing.

## Solution

Table-based timesheet view with contract-aware columns (hours only for fixed-sum contracts, hours+cost for hourly contracts).

## Implementation

1. Create `TimesheetEditor.tsx` - main timesheet mode component:
   - Table structure with sortable columns
   - Contract type display in header
   - Requires case selection (show prompt if none)
2. Create `TimesheetRow.tsx` - individual row component:
   - Date column
   - Description column (task title + optional details)
   - Hours column
   - Cost column (hourly contracts only)
   - Team member name (optional, controlled by toggle)
3. Create `TimesheetHeader.tsx` - column headers:
   - Contract info display (e.g., "Contract: Orar · 350 RON/oră")
   - Column labels
4. Create `TimesheetTotals.tsx` - footer with totals:
   - Total hours
   - Total cost (hourly contracts only)
5. Create `useTimesheetData.ts` hook:
   - Query TimeEntry records for selected case/period
   - Include task details and user info
6. Detect case billing type from `Case.billingType` field:
   - HOURLY: show hours + cost columns
   - FIXED: show hours only, hide cost

## Done When

- [x] Timesheet mode requires case selection
- [x] Shows "Selectează un dosar" prompt when no case selected
- [x] Table displays time entries for selected case/period
- [x] Contract type shown in header
- [x] Hours column always visible
- [x] Cost column only visible for hourly contracts
- [x] Totals footer shows sums
- [ ] Rows sorted by date (newest first or oldest first, configurable)

## Files

- `apps/web/src/components/team-activity/TimesheetEditor.tsx` - main component
- `apps/web/src/components/team-activity/TimesheetRow.tsx` - row component
- `apps/web/src/components/team-activity/TimesheetHeader.tsx` - header
- `apps/web/src/components/team-activity/TimesheetTotals.tsx` - totals footer
- `apps/web/src/hooks/useTimesheetData.ts` - data fetching
- `services/gateway/src/graphql/schema/timesheet.graphql` - schema additions

## GraphQL Schema

```graphql
type Query {
  timesheetEntries(caseId: ID!, periodStart: DateTime!, periodEnd: DateTime!): TimesheetResult!
}

type TimesheetResult {
  entries: [TimesheetEntry!]!
  case: Case!
  totalHours: Float!
  totalCost: Float
}

type TimesheetEntry {
  id: ID!
  date: Date!
  description: String!
  hours: Float!
  hourlyRate: Float
  cost: Float
  billable: Boolean!
  user: User!
  task: Task
}
```

## Technical Notes

- Check if `Case.billingType` enum exists; if not, add to schema
- Possible values: HOURLY, FIXED, RETAINER, CONTINGENCY
- Default hourly rate from Case or from individual TimeEntry

## UI Text (Romanian)

- No case prompt: "Selectează un dosar pentru a vedea fișa de pontaj"
- Column headers: "Data", "Descriere", "Ore", "Cost"
- Contract types: "Orar", "Sumă fixă", "Abonament"
- Totals label: "TOTAL"
