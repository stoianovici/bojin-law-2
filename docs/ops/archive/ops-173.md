# OPS-173: Documents Tab Separation UI

**Type**: Feature
**Priority**: P1-High
**Status**: Verifying
**Epic**: Documents Separation & Review Workflow (OPS-171 to OPS-177)

## Problem

All documents are shown in a single view regardless of their origin. Users can't easily distinguish between:

- Working documents they're actively editing
- Email attachments received via communications

This creates cognitive overhead and makes it harder to focus on work-in-progress documents.

## Solution

Add tabs "Documente de lucru" | "CorespondenÈ›Äƒ" to DocumentsContentPanel, filtering documents by their source type.

## Implementation

### 1. Add tab state to document store

```typescript
// stores/documentFoldersStore.ts
interface DocumentFoldersState {
  // ... existing
  activeTab: 'working' | 'correspondence';
  setActiveTab: (tab: 'working' | 'correspondence') => void;
}
```

### 2. Add Tabs component to DocumentsContentPanel

```tsx
import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';

// In DocumentsContentPanel
<Tabs value={activeTab} onValueChange={setActiveTab}>
  <TabsList>
    <TabsTrigger value="working">
      <FileEdit className="h-4 w-4 mr-2" />
      Documente de lucru
    </TabsTrigger>
    <TabsTrigger value="correspondence">
      <Mail className="h-4 w-4 mr-2" />
      CorespondenÈ›Äƒ
    </TabsTrigger>
  </TabsList>
</Tabs>;
```

### 3. Update GraphQL query with sourceTypes filter

```graphql
input CaseDocumentsGridInput {
  # ... existing
  sourceTypes: [DocumentSourceType!]
}

query CaseDocumentsGrid($input: CaseDocumentsGridInput!) {
  caseDocumentsGrid(input: $input) {
    # ...
  }
}
```

### 4. Filter logic

**"Documente de lucru" tab:**

```typescript
sourceTypes: ['UPLOAD', 'AI_GENERATED', 'TEMPLATE'];
// OR promotedFromAttachment = true (handled in resolver)
```

**"CorespondenÈ›Äƒ" tab:**

```typescript
sourceTypes: ['EMAIL_ATTACHMENT'];
// AND promotedFromAttachment = false
```

### 5. Update resolver to handle filtering

```typescript
// document.resolvers.ts
if (input.sourceTypes) {
  where.document = {
    ...where.document,
    sourceType: { in: input.sourceTypes },
  };
}

// Special handling for promoted attachments
if (input.sourceTypes?.includes('UPLOAD')) {
  // Include promoted attachments in working docs
  where.OR = [
    { document: { sourceType: { in: input.sourceTypes } } },
    { promotedFromAttachment: true },
  ];
}
```

### 6. Persist tab in URL

```typescript
// Update URL when tab changes
const searchParams = new URLSearchParams(window.location.search);
searchParams.set('tab', activeTab);
router.push(`?${searchParams.toString()}`, { shallow: true });
```

## Files to Modify

- `apps/web/src/components/documents/DocumentsContentPanel.tsx` - add tabs UI
- `apps/web/src/stores/documentFoldersStore.ts` - add tab state
- `apps/web/src/hooks/useCaseDocuments.ts` - pass sourceTypes filter
- `services/gateway/src/graphql/schema/document.graphql` - add filter input
- `services/gateway/src/graphql/resolvers/document.resolvers.ts` - implement filter

## Dependencies

- OPS-171 (sourceType field must exist)
- OPS-172 (status enum for display)

## Acceptance Criteria

- [x] Two tabs visible: "Documente de lucru" and "CorespondenÈ›Äƒ"
- [ ] Tab selection persists in URL query param (deferred - using localStorage via store)
- [x] "Documente de lucru" shows UPLOAD, AI_GENERATED, TEMPLATE sources + promoted attachments
- [x] "CorespondenÈ›Äƒ" shows EMAIL_ATTACHMENT sources (not promoted)
- [x] Tab selection persists across page navigation (via localStorage)
- [ ] Document counts shown per tab (optional)
- [x] Folder navigation works within each tab

## UI Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cases Sidebar  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                 â”‚  â”‚ ğŸ“ Documente de lucruâ”‚ ğŸ“§ CorespondenÈ›Äƒ   â”‚â”‚
â”‚  â”œâ”€ Case 1      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”œâ”€ Case 2      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â””â”€ Case 3      â”‚  â”‚                                           â”‚â”‚
â”‚                 â”‚  â”‚     [Document Grid/List]                  â”‚â”‚
â”‚                 â”‚  â”‚                                           â”‚â”‚
â”‚                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Implementation Notes (2024-12-24)

### Completed

1. **Store** (`apps/web/src/stores/document-folders.store.ts`):
   - Added `DocumentTab` type: `'working' | 'correspondence'`
   - Added `activeTab` state with default `'working'`
   - Added `setActiveTab` action
   - Persisted `activeTab` in localStorage

2. **GraphQL Schema** (`services/gateway/src/graphql/schema/document.graphql`):
   - Added `sourceTypes: [DocumentSourceType!]` parameter to `caseDocumentsGrid` query
   - Added `includePromotedAttachments: Boolean` parameter

3. **Resolver** (`services/gateway/src/graphql/resolvers/document.resolvers.ts`):
   - Updated `caseDocumentsGrid` to accept `sourceTypes` and `includePromotedAttachments`
   - For working tab: includes specified source types OR promoted attachments
   - For correspondence tab: filters by source type AND excludes promoted attachments

4. **Hook** (`apps/web/src/hooks/useDocumentGrid.ts`):
   - Added `DocumentSourceType` type
   - Added `sourceTypes` and `includePromotedAttachments` to options
   - Added `sourceType` to GraphQL fragment and `DocumentGridData` interface
   - Passes filter parameters to query

5. **UI** (`apps/web/src/components/documents/DocumentsContentPanel.tsx`):
   - Added Tabs component with "Documente de lucru" and "CorespondenÈ›Äƒ" tabs
   - Computes `sourceTypesFilter` and `includePromotedAttachments` based on `activeTab`
   - Passes filters to `useDocumentGrid` hook

### Technical Decisions

- **State Management**: Used Zustand store with localStorage persistence instead of URL query params for simpler implementation. URL-based approach can be added later if needed.
- **Filter Logic**: Working docs tab uses OR logic (source types OR promoted), correspondence tab uses AND logic (source type AND not promoted).

## Notes

This creates the foundation for document organization. The supervisor "De revizuit" tab (OPS-174) builds on this.
