# OPS-267: useTimePeriodGroups Hook

**Status**: Ready
**Type**: Feature
**Priority**: P2-Medium
**Complexity**: S
**Blocked by**: None

## Problem

Documents and attachments are displayed in flat lists. To group them by time period, we need shared logic that categorizes items into periods (Astazi, Saptamana aceasta, Luna aceasta, Luna trecuta, Mai vechi).

## Approach

Create a generic hook that:

- Takes an array of items and a date accessor function
- Returns items grouped by time period with Romanian labels
- Includes default open/closed state per period
- Uses date-fns for date calculations

```typescript
interface TimePeriod<T> {
  key: string; // "today", "this-week", "this-month", "last-month", "older"
  label: string; // "Astazi", "Saptamana aceasta", etc.
  items: T[];
  defaultOpen: boolean;
}

function useTimePeriodGroups<T>(
  items: T[],
  getDate: (item: T) => Date,
  options?: { locale?: Locale }
): TimePeriod<T>[];
```

### Time Period Definitions

| Key          | Label             | Rule                    | Default Open |
| ------------ | ----------------- | ----------------------- | ------------ |
| `today`      | Astazi            | Same calendar day       | Yes          |
| `this-week`  | Saptamana aceasta | This calendar week      | Yes          |
| `this-month` | Luna aceasta      | This calendar month     | Yes          |
| `last-month` | Luna trecuta      | Previous calendar month | No           |
| `older`      | Mai vechi         | Everything before that  | No           |

## Done When

- [x] Hook returns correctly grouped items for all 5 periods
- [x] Empty periods are excluded from result
- [x] Recent periods (today, this week, this month) default to open
- [x] Older periods default to closed
- [x] Unit tests cover edge cases (empty array, all same period, spanning multiple periods)

## Files

- `apps/web/src/hooks/useTimePeriodGroups.ts` (new)
- `apps/web/src/hooks/useTimePeriodGroups.test.ts` (new)

## Session Log

### 2025-12-26 - Initial Implementation

**Completed:**

- Created `useTimePeriodGroups` hook with:
  - Generic type support for any item type
  - Flexible date accessor function (supports Date, string, null/undefined)
  - Romanian labels (Astăzi, Săptămâna aceasta, Luna aceasta, Luna trecută, Mai vechi)
  - Default open state (recent periods open, older closed)
  - `weekStartsOn` option (defaults to Monday for Romanian locale)
  - Memoized output for performance

- Added comprehensive unit tests (21 tests passing):
  - Empty input handling
  - Time period classification for all 5 periods
  - Group ordering (chronological)
  - Various date accessor formats (string, Date, null, invalid)
  - Edge cases (single item, same timestamp, midnight boundary)
  - Romanian label verification
  - Default open state verification
  - Memoization behavior

**Usage Example:**

```tsx
const periods = useTimePeriodGroups(documents, (doc) => new Date(doc.createdAt));

return periods.map((period) => (
  <TimePeriodSection key={period.key} {...period}>
    {period.items.map((doc) => (
      <DocumentCard document={doc} />
    ))}
  </TimePeriodSection>
));
```
