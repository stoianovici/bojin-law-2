# OPS-154: Reports GraphQL Schema & Resolvers

**Type**: Feature
**Priority**: P2-Medium
**Status**: Resolved
**Resolved**: 2025-12-24
**Created**: 2025-12-24
**Epic**: Predefined Reports with AI-Generated Insights (OPS-150 to OPS-155)

## Problem

No GraphQL API for fetching reports or AI insights.

## Solution

Create schema and resolvers exposing:

- `predefinedReports` - List available templates
- `reportData` - Fetch chart data
- `reportAIInsight` - Fetch AI insights

## Implementation

### Schema (`services/gateway/src/graphql/schema/reports.graphql`)

```graphql
type ReportAIInsight {
  summary: String!
  keyFindings: [String!]!
  recommendations: [String!]!
  generatedAt: DateTime!
  confidence: Float!
}

type PredefinedReport {
  id: ID!
  categoryId: ReportCategory!
  nameRo: String!
  description: String!
  chartType: ChartType!
  requiresDateRange: Boolean!
}

extend type Query {
  predefinedReports(categoryId: ReportCategory): [PredefinedReport!]!
  reportData(reportId: ID!, dateRange: DateRangeInput): ReportData
  reportAIInsight(reportId: ID!, dateRange: DateRangeInput): ReportAIInsight
}
```

### Resolvers

- Authorization checks
- Call backend services
- Romanian error messages

## Files

- `services/gateway/src/graphql/schema/reports.graphql` (new)
- `services/gateway/src/graphql/resolvers/reports.resolvers.ts` (new)
- `services/gateway/src/graphql/schema/index.ts`
- `services/gateway/src/graphql/resolvers/index.ts`

## Done When

- [x] Schema created and loaded
- [x] Resolvers implemented
- [x] Authorization in place
- [x] Works from GraphQL playground

## Blocked By

~~OPS-152, OPS-153~~ (completed)

## Blocks

OPS-155 (ready to proceed)

## Resolution

Implemented complete GraphQL API for reports:

**Schema** (`reports.graphql`):

- `ReportCategory`, `ChartType`, `ReportTrendDirection`, `DateRangePreset` enums
- `DateRangeInput` for filtering by date range
- `ChartDataPoint`, `ReportSummary`, `ReportData` types for chart data
- `ReportAIInsight` type for AI-generated insights
- `PredefinedReport` type for template metadata
- Queries: `predefinedReports`, `reportData`, `reportAIInsight`

**Resolvers** (`reports.resolvers.ts`):

- Role-based authorization filtering (e.g., Paralegal can't see financial reports)
- Integration with `ReportDataService` for data aggregation
- Integration with `ReportAIService` for AI insights
- Romanian error messages
- Default date range handling

**Tested queries**:

- `predefinedReports` - returns all templates filtered by role
- `predefinedReports(categoryId: cases)` - filters by category
- `reportData(reportId: "cases-status-overview")` - returns chart data
- Role-based filtering verified (Paralegal sees 2/3 case reports, 0 financial)
