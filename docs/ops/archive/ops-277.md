# OPS-277: Timesheet Row Merge

**Type**: Feature
**Priority**: P2-Medium
**Status**: Verifying
**Blocked By**: OPS-274

## Problem

Multiple small tasks should be combined into single invoice line items (e.g., 5 phone calls → "Comunicări telefonice"). Granular time tracking is good for internal use but clutters client invoices.

## Solution

Multi-select rows and merge into combined entry with summed hours and editable description. Merge is virtual (frontend only) for flexibility.

## Implementation

1. Add selection checkbox to each TimesheetRow:
   - Separate from billable checkbox (column 2)
   - Track selected row IDs in TimesheetEditor state
2. Show floating action bar when 2+ rows selected:
   - "Îmbină selectate" button
   - "Deselectează" button
   - Selected count badge
3. Create `MergeDialog.tsx` - modal for merge configuration:
   - Combined description input (pre-filled with first entry)
   - Preview of summed hours
   - Date: use earliest date from selection
   - Confirm/Cancel buttons
4. Create `useTimesheetMerge.ts` hook for merge state:
   - Store merged groups: `{ id: string, entryIds: string[], description: string }`
   - Calculate combined hours
   - Handle un-merge
5. Merged rows display:
   - Single row with combined data
   - Special styling (subtle background, merge icon)
   - "Desparte" button to undo merge
6. Store merge state in session (not DB):
   - Merge groups persisted in component state
   - Passed to export for inclusion

## Done When

- [x] Selection checkboxes on each row
- [x] Floating action bar appears when 2+ selected
- [x] "Îmbină selectate" opens merge dialog
- [x] Merge dialog allows editing combined description
- [x] Merged entries show as single row
- [x] Merged row shows combined hours
- [x] "Desparte" button un-merges back to original rows
- [x] Merge state preserved during session
- [ ] Merge state available for export (OPS-278)

## Files

- `apps/web/src/components/team-activity/TimesheetRow.tsx` - add selection checkbox
- `apps/web/src/components/team-activity/TimesheetEditor.tsx` - selection state, action bar
- `apps/web/src/components/team-activity/MergeDialog.tsx` - merge confirmation modal
- `apps/web/src/components/team-activity/MergeActionBar.tsx` - floating action bar
- `apps/web/src/hooks/useTimesheetMerge.ts` - merge logic

## Technical Notes

- Merge is virtual, not persisted to DB
- Original TimeEntry records unchanged
- Merged group stored as: `{ tempId, entryIds[], customDescription, totalHours }`
- Consider allowing re-ordering of merged entries
- Shift+click for range selection

## UI Text (Romanian)

- Action bar: "X selectate"
- Merge button: "Îmbină selectate"
- Deselect button: "Deselectează"
- Dialog title: "Îmbină intrările"
- Description label: "Descriere combinată"
- Hours preview: "Total ore: X"
- Confirm: "Îmbină"
- Cancel: "Anulează"
- Un-merge button: "Desparte"
