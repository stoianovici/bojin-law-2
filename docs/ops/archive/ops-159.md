# OPS-159: Implement cases-deadline-tracker

| Field        | Value                                      |
| ------------ | ------------------------------------------ |
| **Status**   | Open                                       |
| **Type**     | Feature                                    |
| **Priority** | P2-Medium                                  |
| **Created**  | 2025-12-24                                 |
| **Epic**     | Reports Data Accuracy (OPS-156 to OPS-161) |

## Problem

The `cases-deadline-tracker` report (Monitor Termene) currently routes to generic `queryCases()` which groups by case status. This is wrong - "Monitor Termene" should show **upcoming and overdue deadlines** from tasks, not case statuses.

## Solution

1. Add `getDeadlineTracker()` method that:
   - Queries `Task` table where `dueDate` is set
   - Groups by time bucket:
     - **Depășite** (Overdue): dueDate < today
     - **Astăzi** (Today): dueDate = today
     - **Săptămâna aceasta** (This Week): dueDate within 7 days
     - **Luna aceasta** (This Month): dueDate within 30 days
     - **Mai târziu** (Later): dueDate > 30 days
   - Returns counts per bucket with appropriate colors (red for overdue)
2. Route `cases-deadline-tracker` to this method

## Example Output

```typescript
{
  data: [
    { label: 'Depășite', value: 3, color: '#ef4444', metadata: { bucket: 'overdue' } },
    { label: 'Astăzi', value: 2, color: '#f59e0b', metadata: { bucket: 'today' } },
    { label: 'Săptămâna aceasta', value: 5, color: '#3b82f6', metadata: { bucket: 'thisWeek' } },
    { label: 'Luna aceasta', value: 8, color: '#10b981', metadata: { bucket: 'thisMonth' } },
    { label: 'Mai târziu', value: 12, color: '#6b7280', metadata: { bucket: 'later' } },
  ],
  summary: {
    totalValue: 30,
    averageValue: 6,
    trendDirection: 'stable'
  }
}
```

## Files

- `services/gateway/src/services/report-data.service.ts`
- `services/gateway/src/graphql/resolvers/reports.resolvers.ts`

## Done When

- [x] Report shows deadline distribution by urgency
- [x] Overdue deadlines highlighted in red
- [x] Bar chart displays deadline urgency distribution
- [x] Only includes tasks from firm's cases

## Implementation

Added `getDeadlineTracker()` method in `report-data.service.ts`:

- Queries all tasks with `dueDate` set (excluding cancelled tasks)
- Groups into 5 buckets: Depășite (red), Astăzi (amber), Săptămâna aceasta (blue), Luna aceasta (green), Mai târziu (gray)
- Returns chart data with appropriate colors for each urgency level
- Scoped to firm via `firmId`

Routed `cases-deadline-tracker` report to use this new method in `reports.resolvers.ts`.
