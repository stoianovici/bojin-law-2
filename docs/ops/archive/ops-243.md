# OPS-243: Feature Toggles Page

**Type**: Feature
**Priority**: P2-Medium
**Status**: Completed
**Epic**: AI Batch Processing & Ops Dashboard

## Problem

No way to enable/disable AI features from UI. Must change code to turn features off.

## Solution

Create `/admin/ai-ops/features` page with toggle controls for each AI feature.

### Page Layout

```
┌─────────────────────────────────────────────────────────────┐
│  Funcționalități AI                                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  PROCESOARE BATCH (Noapte)                                  │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ● Generator Index Căutare    [ON ]  €0.42/zi  [▶]  │   │
│  │   Ultima rulare: 25 Dec 03:00 • 47 docs • ✓        │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ ● Briefing-uri Matinale      [ON ]  €0.28/zi  [▶]  │   │
│  │   Ultima rulare: 25 Dec 05:00 • 8 useri • ✓        │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ ○ Scor Sănătate Dosare       [OFF]  ~€0.15/zi      │   │
│  │   Dezactivat din: 20 Dec                            │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  AI LA CERERE                                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ● Asistent AI Chat           [ON ]  €1.24/zi       │   │
│  │   Astăzi: 47 conversații • 89K tokeni              │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ ● Clasificare Email          [ON ]  €0.12/zi       │   │
│  │   Astăzi: 156 emailuri • 31K tokeni                │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Feature Card Component

```tsx
interface FeatureCardProps {
  feature: AIFeatureConfig;
  onToggle: (enabled: boolean) => void;
  onRunNow?: () => void; // Only for batch processors
}

function FeatureCard({ feature, onToggle, onRunNow }: FeatureCardProps) {
  return (
    <div className="flex items-center justify-between p-4 border rounded-lg">
      <div className="flex items-center gap-3">
        <div
          className={clsx('w-2 h-2 rounded-full', feature.enabled ? 'bg-green-500' : 'bg-gray-300')}
        />
        <div>
          <h3 className="font-medium">{feature.featureName}</h3>
          <p className="text-sm text-gray-500">
            {feature.lastRunAt
              ? `Ultima rulare: ${formatDate(feature.lastRunAt)}`
              : 'Niciodată rulat'}
          </p>
        </div>
      </div>

      <div className="flex items-center gap-4">
        <span className="text-sm text-gray-500">~€{feature.dailyCostEstimate?.toFixed(2)}/zi</span>

        <Switch checked={feature.enabled} onCheckedChange={onToggle} />

        {feature.featureType === 'batch' && (
          <Button variant="ghost" size="sm" onClick={onRunNow}>
            <Play className="h-4 w-4" />
          </Button>
        )}
      </div>
    </div>
  );
}
```

### Run Now Flow

1. User clicks play button
2. Confirmation dialog: "Rulați acum {feature}?"
3. Call `triggerBatchJob` mutation
4. Show toast: "Job pornit..."
5. Poll for completion
6. Show result toast: "Completat: 47 elemente procesate"

## Acceptance Criteria

- [x] Features list grouped by type (batch vs request-time)
- [x] Toggle switch enables/disables feature
- [x] Toggle persists via GraphQL mutation
- [x] "Run Now" button for batch processors
- [x] Confirmation dialog before running
- [x] Success/error toast feedback
- [x] Last run status displayed
- [x] Daily cost estimate shown

## Files Created/Modified

- `apps/web/src/app/admin/ai-ops/features/page.tsx` (created) - Main features page
- `apps/web/src/components/admin/ai-ops/FeatureCard.tsx` (created) - Feature card with toggle/status
- `apps/web/src/components/admin/ai-ops/RunNowDialog.tsx` (created) - Confirmation dialog
- `apps/web/src/components/ui/switch.tsx` (created) - Radix UI Switch component
- `apps/web/src/hooks/useAIFeatures.ts` (created) - GraphQL hooks for features

## Dependencies

- OPS-241 (GraphQL schema)
- OPS-242 (Admin layout)

## Parallel Work

Can be done in parallel with OPS-244, OPS-245, OPS-246.
