# OPS-292: Add GraphQL Query for Emails by Folder

**Type**: API | **Priority**: P1-High | **Complexity**: S
**Status**: Closed
**Blocked by**: OPS-288 (closed)
**Epic**: Sync All Outlook Folders

## Problem

Frontend needs to query emails grouped by Outlook folder for display in the new Outlook Folders section.

## Approach

Add query:

```graphql
type Query {
  emailsByFolder: [OutlookFolder!]!
}

type OutlookFolder {
  id: String! # parentFolderId
  name: String! # parentFolderName
  emailCount: Int!
  unreadCount: Int!
  emails(limit: Int, offset: Int): [Email!]!
}
```

Only returns folders with **unassigned** emails (no case link, not ignored).

## Done When

- [x] GraphQL schema updated with OutlookFolder type
- [x] Resolver aggregates by parentFolderName
- [x] Returns only unassigned, non-ignored emails
- [x] Pagination supported on emails field
- [x] Excludes system folders (Drafts, Deleted Items, Junk)

## Files

- `services/gateway/src/graphql/schema/email.graphql`
- `services/gateway/src/graphql/resolvers/email.resolvers.ts`

## Technical Notes

Query should filter:

```typescript
where: {
  userId: user.id,
  caseLinks: { none: {} },  // Not assigned to any case (multi-case model)
  isIgnored: false,         // Not ignored
  parentFolderName: {
    notIn: ['Drafts', 'Deleted Items', 'Junk Email', 'Outbox']
  }
}
```

The resolver:

1. Fetches all unassigned emails with folder info (using relation filter `caseLinks: { none: {} }`)
2. Aggregates in memory by `parentFolderName`
3. Counts total and unread per folder
4. Sorts by email count descending

The `OutlookFolder.emails` field resolver provides pagination for individual folders.

## Session Log

- 2025-12-27: Issue created as part of Outlook Folders epic
- 2025-12-27: Implemented - Added OutlookFolder type and emailsByFolder query with resolver
