# OPS-124: Three-Pane Communications Layout

**Type:** Feature
**Priority:** P1-High
**Status:** Open
**Created:** 2025-12-23
**Epic:** Communications UX Overhaul

## Problem

Current `/communications` page uses a two-pane layout:

- Left: CaseSidebar (320-384px)
- Right: MessageView (flex-1, full remaining width)

This doesn't accommodate:

- Inline attachment preview (OPS-122)
- Optimal reading width for conversation (currently too wide)
- Side-by-side comparison of email and attachments

## Context

- Outlook uses three-pane: Navigation | Thread List | Reading Pane
- Current layout: Sidebar combines navigation + thread list
- Goal: Three-pane when attachment preview is open
- Responsive: Collapse to two-pane on smaller screens

## Solution

Restructure `/communications` to support three-pane layout:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CaseSidebar â”‚ ConversationView                â”‚ AttachmentPreview   â”‚
â”‚ (280px)     â”‚ (flex-1, min 400px, max 700px)  â”‚ Panel (350-500px)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚                                 â”‚                     â”‚
â”‚ DOSARE      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  Contract.pdf       â”‚
â”‚ â–¼ Case 1    â”‚  â”‚ ğŸ’¡ Rezumat AI           â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â€¢ thread  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚               â”‚  â”‚
â”‚   â€¢ thread  â”‚                                 â”‚  â”‚  [PDF Embed]  â”‚  â”‚
â”‚ â–º Case 2    â”‚  â”Œâ”€ Ion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚               â”‚  â”‚
â”‚             â”‚  â”‚ VÄƒ rog sÄƒ revizuiÈ›i... â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ INSTANÈšE    â”‚  â”‚           ğŸ“ Contract   â”‚     â”‚                     â”‚
â”‚ â€¢ court     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  [Download] [Next]  â”‚
â”‚             â”‚                                 â”‚                     â”‚
â”‚ NECLAR      â”‚       â”Œâ”€ Maria â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚             â”‚       â”‚ Am verificat.   â”‚       â”‚  AtaÈ™amente (3):    â”‚
â”‚             â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â€¢ Contract.pdf     â”‚
â”‚             â”‚                                 â”‚  â€¢ Note.docx        â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â€¢ Contract_v2.pdf  â”‚
â”‚             â”‚  â”‚ RÄƒspunde...         [Send] â”‚ â”‚                     â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layout Modes

1. **Two-pane (default)**: Sidebar + ConversationView
   - When no attachment selected
   - ConversationView gets full remaining width (constrained to max 800px with auto margins)

2. **Three-pane**: Sidebar + ConversationView + AttachmentPreviewPanel
   - When attachment clicked
   - ConversationView constrained to min 400px
   - Panel takes 350-500px

3. **Responsive breakpoints**:
   - `â‰¥1536px`: Full three-pane inline
   - `1280-1535px`: Three-pane with narrower panel (300px)
   - `1024-1279px`: Two-pane, preview as slide-over
   - `<1024px`: Two-pane, preview as modal

### Reading Pane Optimization

From Microsoft's research: Optimal reading width is ~65 characters (2.5 alphabets).

```css
.conversation-view {
  max-width: 700px; /* ~65 chars at 14px font */
  margin: 0 auto; /* Center when extra space */
}
```

## Implementation

### Page Layout Structure

```tsx
// app/communications/page.tsx

export default function CommunicationsPage() {
  const { previewPanelOpen, selectedAttachmentId } = useCommunicationStore();
  const [viewMode, setViewMode] = useState<'conversation' | 'cards'>('conversation');

  return (
    <main className="flex h-screen flex-col overflow-hidden bg-gray-50">
      {/* Header */}
      <CommunicationsHeader onViewModeChange={setViewMode} viewMode={viewMode} />

      {/* Three-pane layout */}
      <div className="flex flex-1 overflow-hidden">
        {/* Left: Case Sidebar */}
        <div className="w-72 xl:w-80 border-r bg-white flex-shrink-0 overflow-hidden">
          <CaseSidebar {...sidebarProps} />
        </div>

        {/* Center: Conversation/Message View */}
        <div
          className={clsx(
            'flex-1 flex flex-col overflow-hidden',
            previewPanelOpen && 'max-w-[700px]' // Constrain when panel open
          )}
        >
          {viewMode === 'conversation' ? (
            <ConversationView thread={selectedThread} onAttachmentClick={handleAttachmentClick} />
          ) : (
            <MessageView />
          )}
        </div>

        {/* Right: Attachment Preview Panel */}
        {previewPanelOpen && (
          <AttachmentPreviewPanel
            isOpen={previewPanelOpen}
            onClose={closePreviewPanel}
            selectedAttachment={selectedAttachment}
            threadAttachments={threadAttachments}
            onSelectAttachment={selectAttachment}
          />
        )}
      </div>

      {/* Modals */}
      <ComposeInterface />
      <ClassificationModal />
    </main>
  );
}
```

### Responsive Panel Behavior

```tsx
// components/communication/AttachmentPreviewPanel.tsx

export function AttachmentPreviewPanel({ isOpen, onClose, ...props }) {
  const isLargeScreen = useMediaQuery('(min-width: 1280px)');
  const isMediumScreen = useMediaQuery('(min-width: 1024px)');

  // Large screens: inline panel
  if (isLargeScreen) {
    return (
      <div className="w-[400px] xl:w-[450px] border-l bg-white flex-shrink-0">
        <PanelContent {...props} onClose={onClose} />
      </div>
    );
  }

  // Medium screens: slide-over from right
  if (isMediumScreen) {
    return (
      <div
        className={clsx(
          'fixed right-0 top-0 h-full w-[400px] bg-white shadow-xl z-40',
          'transform transition-transform duration-200',
          isOpen ? 'translate-x-0' : 'translate-x-full'
        )}
      >
        <PanelContent {...props} onClose={onClose} />
      </div>
    );
  }

  // Small screens: modal fallback
  return (
    <DocumentPreviewModal isOpen={isOpen} onClose={onClose} document={props.selectedAttachment} />
  );
}
```

### View Mode Toggle

```tsx
// components/communication/CommunicationsHeader.tsx

interface CommunicationsHeaderProps {
  viewMode: 'conversation' | 'cards';
  onViewModeChange: (mode: 'conversation' | 'cards') => void;
}

export function CommunicationsHeader({ viewMode, onViewModeChange }: CommunicationsHeaderProps) {
  return (
    <div className="border-b bg-white px-6 py-4 flex items-center justify-between">
      {/* Left: Sync controls */}
      <SyncControls />

      {/* Center: View mode toggle */}
      <div className="flex items-center gap-1 bg-gray-100 rounded-lg p-1">
        <button
          onClick={() => onViewModeChange('conversation')}
          className={clsx(
            'px-3 py-1.5 text-sm rounded-md transition-colors',
            viewMode === 'conversation'
              ? 'bg-white text-gray-900 shadow-sm'
              : 'text-gray-600 hover:text-gray-900'
          )}
        >
          <MessageSquare className="h-4 w-4 inline mr-1.5" />
          ConversaÈ›ie
        </button>
        <button
          onClick={() => onViewModeChange('cards')}
          className={clsx(
            'px-3 py-1.5 text-sm rounded-md transition-colors',
            viewMode === 'cards'
              ? 'bg-white text-gray-900 shadow-sm'
              : 'text-gray-600 hover:text-gray-900'
          )}
        >
          <LayoutList className="h-4 w-4 inline mr-1.5" />
          Carduri
        </button>
      </div>

      {/* Right: Outlook link */}
      <OutlookLink />
    </div>
  );
}
```

### Store Updates

```tsx
// stores/communication.store.ts

interface CommunicationState {
  // ... existing

  // View mode
  viewMode: 'conversation' | 'cards';
  setViewMode: (mode: 'conversation' | 'cards') => void;

  // Preview panel
  previewPanelOpen: boolean;
  selectedAttachmentId: string | null;
  openPreviewPanel: (attachmentId: string) => void;
  closePreviewPanel: () => void;
  selectAttachment: (attachmentId: string) => void;
}
```

## Acceptance Criteria

- [ ] Page renders with three-pane layout when preview panel open
- [ ] Two-pane layout when no attachment selected
- [ ] ConversationView constrained to max-width for readability
- [ ] Preview panel width: 350-500px depending on screen size
- [ ] View mode toggle: Conversation / Cards
- [ ] Responsive: slide-over panel on medium screens
- [ ] Responsive: modal fallback on small screens
- [ ] Smooth transitions between layout states
- [ ] No horizontal overflow at any viewport size
- [ ] Sidebar width slightly reduced (280px) to accommodate panel

## Files to Modify

| File                                                  | Change                     |
| ----------------------------------------------------- | -------------------------- |
| `app/communications/page.tsx`                         | Restructure layout         |
| `components/communication/CommunicationsHeader.tsx`   | **New** - view toggle      |
| `components/communication/AttachmentPreviewPanel.tsx` | Responsive behavior        |
| `stores/communication.store.ts`                       | Add viewMode + panel state |
| `hooks/useMediaQuery.ts`                              | **New** (if not exists)    |

## Dependencies

- OPS-121: ConversationView component
- OPS-122: AttachmentPreviewPanel component

## Related Issues

- OPS-041: /communications Case-Organized Redesign (current layout origin)
