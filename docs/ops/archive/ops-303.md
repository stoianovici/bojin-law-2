# OPS-303: Add FAB to ConditionalLayout for Mobile

**Type**: Feature
**Priority**: P1-High
**Platform**: Mobile
**Status**: Completed
**Complexity**: S (Small)
**Created**: 2025-12-27

## Problem

The AssistantFAB and AssistantSheet need to be rendered on all mobile pages, not just MobileHome. Currently, the mobile branch of ConditionalLayout just renders children directly without any global elements.

## Solution

Add AssistantFAB and AssistantSheet to ConditionalLayout's mobile branch so they appear on every mobile page.

## Implementation

### Current Code (ConditionalLayout.tsx ~line 105-107)

```tsx
if (isMobile) {
  return <>{children}</>;
}
```

### Updated Code

```tsx
if (isMobile) {
  return (
    <>
      {children}
      <AssistantFAB />
      <AssistantSheet />
    </>
  );
}
```

### Considerations

1. **No duplicate assistants**: Desktop uses `AssistantPill` (rendered in desktop branch), mobile uses FAB+Sheet
2. **Z-index coordination**: FAB is z-50, Sheet is z-50 with backdrop at z-40
3. **Safe area**: FAB already handles safe-area-inset-bottom
4. **Route exclusions**: Consider if any mobile routes should NOT show FAB (probably none)

### Import Updates

```tsx
import { AssistantFAB, AssistantSheet } from '@/components/mobile';
```

## Files

- `apps/web/src/components/layout/ConditionalLayout.tsx` (edit)

## Dependencies

- OPS-299: AssistantFAB Component (must exist)
- OPS-300: AssistantSheet Component (must exist)

## Blocked By

- OPS-299: AssistantFAB Component
- OPS-300: AssistantSheet Component

## Blocks

- OPS-305: Remove Embedded Assistant from MobileHome

## Done Criteria

- [x] FAB visible on MobileHome
- [x] FAB visible on /cases (mobile)
- [x] FAB visible on /tasks (mobile)
- [x] FAB visible on /communications (mobile)
- [x] Sheet opens correctly when FAB tapped
- [x] Sheet closes on backdrop tap
- [x] No FAB on desktop (only AssistantPill)
- [x] No console errors or hydration mismatches

## Testing

1. Navigate to mobile home → FAB visible
2. Tap FAB → Sheet opens
3. Navigate to /cases → FAB still visible
4. Tap FAB → Sheet opens with conversation intact
5. Resize to desktop → No FAB, AssistantPill appears instead

## Session Log

### Session 1 - 2025-12-27

**Changes Made:**

1. Updated `ConditionalLayout.tsx`:
   - Added import for `AssistantFAB, AssistantSheet` from `../mobile`
   - Added FAB and Sheet to mobile branch render

2. Updated `AssistantFAB.tsx`:
   - Added `useIsMobile` check to prevent rendering on desktop
   - Component now returns null if `!isMobile`

3. Updated `AssistantSheet.tsx`:
   - Added `useIsMobile` check to prevent rendering on desktop
   - Component now returns null if `!isMobile`

**Verification:**

- Tested on mobile viewport (390x844): FAB visible, sheet opens on tap ✅
- Tested on desktop viewport (1280x800): FAB hidden, AssistantPill visible ✅
- Tested on /cases and /tasks pages: FAB appears on mobile ✅
- No React hooks errors or hydration mismatches ✅
