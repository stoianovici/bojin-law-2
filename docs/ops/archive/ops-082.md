# OPS-082: Define Claude Tool Schemas

**Status:** Implemented | **Priority:** P0-Critical | **Type:** Feature
**Created:** 2025-12-21 | **Depends on:** OPS-081 | **Blocks:** OPS-084

## Summary

Define Claude tool schemas for all AI assistant actions. These replace the intent detection system with structured tool definitions that Claude can call directly.

## Background

Claude's native tool use provides:

- Structured input/output via JSON schemas
- Natural language understanding of when to call tools
- Automatic parameter extraction from conversation context
- No need for explicit keyword matching or examples

## Requirements

### Tool Definitions

```typescript
// services/gateway/src/services/ai-tools.schema.ts

export const AI_TOOLS = [
  // ============================================================
  // TASK TOOLS
  // ============================================================
  {
    name: 'create_task',
    description:
      'Creează o sarcină nouă. Folosește când utilizatorul vrea să adauge un task, o sarcină, un reminder, sau ceva de făcut.',
    input_schema: {
      type: 'object',
      properties: {
        title: {
          type: 'string',
          description: 'Titlul sarcinii (ce trebuie făcut)',
        },
        description: {
          type: 'string',
          description: 'Descriere detaliată (opțional)',
        },
        dueDate: {
          type: 'string',
          description:
            'Data limită în format ISO 8601 (YYYY-MM-DD). Interpretează expresii ca "mâine", "vinerea viitoare", "peste 3 zile" relativ la data curentă.',
        },
        priority: {
          type: 'string',
          enum: ['Low', 'Medium', 'High', 'Urgent'],
          description: 'Prioritatea sarcinii. Default: Medium',
        },
        caseId: {
          type: 'string',
          description:
            'ID-ul dosarului asociat. Folosește contextul conversației dacă utilizatorul e pe pagina unui dosar.',
        },
        assigneeId: {
          type: 'string',
          description: 'ID-ul utilizatorului căruia i se atribuie sarcina (opțional)',
        },
      },
      required: ['title'],
    },
  },

  {
    name: 'list_tasks',
    description:
      'Listează sarcinile. Folosește când utilizatorul întreabă despre taskuri, sarcini de făcut, deadline-uri.',
    input_schema: {
      type: 'object',
      properties: {
        caseId: {
          type: 'string',
          description: 'Filtrează după dosar (opțional)',
        },
        status: {
          type: 'string',
          enum: ['pending', 'in_progress', 'completed', 'all'],
          description: 'Filtrează după status. Default: pending',
        },
        assigneeId: {
          type: 'string',
          description: 'Filtrează după persoana atribuită',
        },
        dueBefore: {
          type: 'string',
          description: 'Sarcini cu deadline înainte de această dată (ISO 8601)',
        },
      },
    },
  },

  {
    name: 'update_task',
    description: 'Actualizează o sarcină existentă (status, deadline, prioritate).',
    input_schema: {
      type: 'object',
      properties: {
        taskId: { type: 'string', description: 'ID-ul sarcinii de actualizat' },
        status: { type: 'string', enum: ['pending', 'in_progress', 'completed'] },
        dueDate: { type: 'string', description: 'Noua dată limită (ISO 8601)' },
        priority: { type: 'string', enum: ['Low', 'Medium', 'High', 'Urgent'] },
      },
      required: ['taskId'],
    },
  },

  // ============================================================
  // CASE TOOLS
  // ============================================================
  {
    name: 'get_case_summary',
    description: 'Obține rezumatul unui dosar - status, părți, deadline-uri, evenimente recente.',
    input_schema: {
      type: 'object',
      properties: {
        caseId: {
          type: 'string',
          description:
            'ID-ul dosarului. Folosește din context dacă utilizatorul e pe pagina unui dosar.',
        },
      },
      required: ['caseId'],
    },
  },

  {
    name: 'search_cases',
    description: 'Caută dosare după nume, număr, client, sau status.',
    input_schema: {
      type: 'object',
      properties: {
        query: { type: 'string', description: 'Text de căutare' },
        status: {
          type: 'string',
          enum: ['Active', 'Pending', 'Closed', 'Archived'],
        },
        clientName: { type: 'string', description: 'Numele clientului' },
      },
    },
  },

  {
    name: 'get_case_deadlines',
    description: 'Listează termenele și deadline-urile unui dosar.',
    input_schema: {
      type: 'object',
      properties: {
        caseId: { type: 'string' },
        upcoming: {
          type: 'boolean',
          description: 'Doar termenele viitoare (default: true)',
        },
      },
      required: ['caseId'],
    },
  },

  // ============================================================
  // EMAIL TOOLS
  // ============================================================
  {
    name: 'search_emails',
    description: 'Caută emailuri în dosare.',
    input_schema: {
      type: 'object',
      properties: {
        caseId: { type: 'string', description: 'Caută în dosarul specificat' },
        query: { type: 'string', description: 'Text de căutare în subiect/corp' },
        from: { type: 'string', description: 'Filtrează după expeditor' },
        after: { type: 'string', description: 'Emailuri după această dată (ISO 8601)' },
        before: { type: 'string', description: 'Emailuri înainte de această dată' },
      },
    },
  },

  {
    name: 'draft_email_reply',
    description:
      'Creează un draft de răspuns la un email. Returnează textul propus pentru aprobare.',
    input_schema: {
      type: 'object',
      properties: {
        emailId: { type: 'string', description: 'ID-ul emailului la care răspundem' },
        tone: {
          type: 'string',
          enum: ['formal', 'friendly', 'brief'],
          description: 'Tonul răspunsului. Default: formal',
        },
        instructions: {
          type: 'string',
          description: 'Instrucțiuni specifice pentru conținutul răspunsului',
        },
      },
      required: ['emailId'],
    },
  },

  // ============================================================
  // DOCUMENT TOOLS
  // ============================================================
  {
    name: 'search_documents',
    description: 'Caută documente în dosare.',
    input_schema: {
      type: 'object',
      properties: {
        caseId: { type: 'string' },
        query: { type: 'string', description: 'Text de căutare în nume/conținut' },
        type: {
          type: 'string',
          description: 'Tipul documentului (contract, cerere, hotărâre, etc.)',
        },
      },
    },
  },

  {
    name: 'generate_document',
    description:
      'Generează un document nou (contract, cerere, notificare). Returnează draft pentru aprobare.',
    input_schema: {
      type: 'object',
      properties: {
        templateType: {
          type: 'string',
          enum: ['contract', 'cerere', 'notificare', 'procura', 'scrisoare'],
          description: 'Tipul documentului de generat',
        },
        caseId: { type: 'string', description: 'Dosarul asociat' },
        instructions: {
          type: 'string',
          description: 'Instrucțiuni specifice pentru conținut',
        },
      },
      required: ['templateType'],
    },
  },

  // ============================================================
  // CALENDAR TOOLS
  // ============================================================
  {
    name: 'get_calendar',
    description: 'Obține evenimentele din calendar pentru o perioadă.',
    input_schema: {
      type: 'object',
      properties: {
        startDate: { type: 'string', description: 'Data de început (ISO 8601)' },
        endDate: { type: 'string', description: 'Data de sfârșit (ISO 8601)' },
        caseId: { type: 'string', description: 'Filtrează după dosar (opțional)' },
      },
    },
  },

  {
    name: 'create_calendar_event',
    description: 'Creează un eveniment în calendar (ședință, termen, întâlnire).',
    input_schema: {
      type: 'object',
      properties: {
        title: { type: 'string' },
        startTime: { type: 'string', description: 'Data și ora de început (ISO 8601)' },
        endTime: { type: 'string', description: 'Data și ora de sfârșit (ISO 8601)' },
        caseId: { type: 'string' },
        location: { type: 'string' },
        attendees: {
          type: 'array',
          items: { type: 'string' },
          description: 'Lista de participanți (email-uri)',
        },
      },
      required: ['title', 'startTime'],
    },
  },

  // ============================================================
  // BRIEFING TOOLS
  // ============================================================
  {
    name: 'get_morning_briefing',
    description: 'Generează briefingul zilnic - sarcini urgente, termene, emailuri noi.',
    input_schema: {
      type: 'object',
      properties: {},
    },
  },
] as const;

export type AIToolName = (typeof AI_TOOLS)[number]['name'];
```

## Acceptance Criteria

- [x] All tools defined with Romanian descriptions
- [x] Input schemas cover all parameters from existing handlers
- [x] Tool descriptions explain when to use each tool
- [x] Date handling documented (ISO 8601 with natural language interpretation)
- [x] Optional vs required parameters clearly marked
- [x] Type exported for use in orchestrator

## Files to Create/Modify

- `services/gateway/src/services/ai-tools.schema.ts` (new) ✅

## Implementation Summary

Created `ai-tools.schema.ts` with **20 tools** covering all assistant capabilities:

### Tools Defined

| Category         | Tools                                                                                |
| ---------------- | ------------------------------------------------------------------------------------ |
| **Task** (3)     | `create_task`, `list_tasks`, `update_task`                                           |
| **Case** (4)     | `get_case_summary`, `search_cases`, `get_case_deadlines`, `get_case_actors`          |
| **Email** (4)    | `search_emails`, `summarize_email_thread`, `draft_email_reply`, `get_recent_emails`  |
| **Document** (4) | `search_documents`, `summarize_document`, `generate_document`, `list_case_documents` |
| **Calendar** (2) | `get_calendar`, `create_calendar_event`                                              |
| **Briefing** (2) | `get_morning_briefing`, `get_proactive_alerts`                                       |

### Exports

- `AI_TOOLS: Tool[]` - Complete tool array for Claude API
- `AIToolName` - Union type of all tool names
- `AIToolInput` - Discriminated union for type-safe tool inputs
- Individual input interfaces: `CreateTaskInput`, `SearchEmailsInput`, etc.
- Helper functions: `isValidToolName()`, `getToolByName()`

### Key Design Decisions

1. **Romanian descriptions** - All tool descriptions in Romanian for natural language understanding
2. **Date interpretation** - Instructions in descriptions for Claude to interpret "mâine", "vinerea viitoare", etc.
3. **Context awareness** - Descriptions mention using page context (currentCaseId, selectedEmailId)
4. **Local types** - Defined `Tool` interface locally instead of importing Anthropic SDK

## Session Log

- [2025-12-21] Issue created
- [2025-12-21 Session 1] Implemented all 20 tool schemas, TypeScript types, and helper functions. TypeScript compilation verified.
