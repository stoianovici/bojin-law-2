# OPS-030: Email Import with Classification

**Status:** Verifying
**Priority:** P1-High
**Type:** Feature (Integration)
**Created:** 2025-12-16
**Blocked By:** OPS-028, OPS-029
**Blocks:** OPS-031

---

## Problem Statement

The email import wizard currently imports ALL emails from specified contacts into a single case. With the classification service (OPS-029) and metadata UI (OPS-028) complete, we need to integrate classification into the import flow so users can:

1. See which case each email will be assigned to
2. Review and adjust classifications before import
3. Import emails to multiple cases in one operation

---

## Scope

### 1. Multi-Case Import Flow

Redesign EmailImportWizard for clients with multiple cases:

```
Step 1: Enter contact emails (unchanged)

Step 2: Classification Preview (NEW)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Previzualizare Clasificare                             ‚îÇ
‚îÇ  847 emailuri gƒÉsite pentru 3 dosare active             ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  üìÅ Litigiu Contract 2023                    342 emails ‚îÇ
‚îÇ     ‚îú‚îÄ‚îÄ Clasificare automatƒÉ (>85%)          298       ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ De revizuit (50-85%)                  44       ‚îÇ
‚îÇ     [Detalii ‚ñæ]                                         ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  üìÅ Consultan»õƒÉ Fuziune                      289 emails ‚îÇ
‚îÇ     ‚îú‚îÄ‚îÄ Clasificare automatƒÉ                 256       ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ De revizuit                           33       ‚îÇ
‚îÇ     [Detalii ‚ñæ]                                         ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  üìÅ Recuperare Crean»õƒÉ                       156 emails ‚îÇ
‚îÇ     ‚îú‚îÄ‚îÄ Clasificare automatƒÉ                 142       ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ De revizuit                           14       ‚îÇ
‚îÇ     [Detalii ‚ñæ]                                         ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚ö†Ô∏è Neclasificate                             60 emails ‚îÇ
‚îÇ     NecesitƒÉ revizuire manualƒÉ                         ‚îÇ
‚îÇ     [Revizuie»ôte ‚ñæ]                                     ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ  [√énapoi] [Revizuie»ôte nesigure] [ImportƒÉ toate]       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. Email Review Interface

Expandable section showing emails per case:

```
üìÅ Litigiu Contract 2023 (342 emails)                    ‚ñæ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Clasificare automatƒÉ (298)                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ ‚úì "Re: Contract semnat" - client@co.ro  95%    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚úì "Documente solicitate" - avocat@...   92%    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ... (aratƒÉ mai multe)                           ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  De revizuit (44)                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ ? "Re: √éntrebare" - client@co.ro        67%    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ   Motiv: Potrivire keyword, dar »ôi √Æn alt dosar ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ   [‚úì ConfirmƒÉ] [‚Üí MutƒÉ la alt dosar]           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                 ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ? "FW: Meeting" - unknown@co.ro         54%    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ   Motiv: Contact nou, potrivire slabƒÉ          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ   [‚úì ConfirmƒÉ] [‚Üí MutƒÉ] [‚úó Exclude]           ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3. Unclassified Emails Handler

```
‚ö†Ô∏è Neclasificate (60 emails)                              ‚ñæ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Aceste emailuri nu au putut fi clasificate automat.    ‚îÇ
‚îÇ  Selecta»õi dosarul pentru fiecare sau exclude»õi-le.     ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚ñ° "Informare generalƒÉ" - info@court.ro       12 Dec   ‚îÇ
‚îÇ    Dosar: [SelecteazƒÉ ‚ñæ] sau [‚úó Exclude]               ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚ñ° "Re: ???" - unknown@external.ro            10 Dec   ‚îÇ
‚îÇ    Dosar: [SelecteazƒÉ ‚ñæ] sau [‚úó Exclude]               ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  [SelecteazƒÉ toate ‚Üí Dosar...] [Exclude toate]          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 4. Single-Case Client Flow

For clients with only one active case, use simplified flow (current behavior with classification confidence shown):

```
Step 2: Preview
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Previzualizare Import                                  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  üìÅ Dosar: Litigiu Contract 2023                       ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  342 emailuri vor fi importate                          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Potrivire bunƒÉ (>85%)              298            ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Potrivire medie (50-85%)            44            ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚ö†Ô∏è 5 emailuri excluse (potrivire <50%)                ‚îÇ
‚îÇ     [Revizuie»ôte excluse ‚ñæ]                            ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  [√énapoi] [ContinuƒÉ]                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 5. Backend: Multi-Case Import Mutation

```graphql
input ClassifiedEmailImportInput {
  clientId: ID!
  emailAddresses: [String!]!

  # Override classifications if user reviewed
  classificationOverrides: [ClassificationOverride!]

  # Import settings
  importAttachments: Boolean!
  excludedEmailIds: [ID!]
}

input ClassificationOverride {
  emailId: ID!
  caseId: ID! # User-selected case
}

type MultiCaseImportResult {
  success: Boolean!
  importedByCase: [CaseImportResult!]!
  excluded: Int!
  errors: [ImportError!]
}

type CaseImportResult {
  caseId: ID!
  case: Case!
  emailsImported: Int!
  attachmentsImported: Int!
  contactsCreated: Int!
}

extend type Mutation {
  executeClassifiedEmailImport(input: ClassifiedEmailImportInput!): MultiCaseImportResult!
}
```

### 6. Modified Email Import Service

Update `email-to-case.service.ts`:

```typescript
async executeClassifiedImport(
  input: ClassifiedEmailImportInput,
  userContext: UserContext
): Promise<MultiCaseImportResult> {
  // 1. Get all emails for the contact addresses
  // 2. Apply classification service results
  // 3. Apply user overrides
  // 4. Group emails by target case
  // 5. For each case:
  //    - Link emails to case
  //    - Sync to CommunicationEntry
  //    - Create CaseActors
  //    - Import attachments if enabled
  // 6. Return aggregated results
}
```

---

## Acceptance Criteria

- [x] Multi-case flow detects clients with multiple active cases
- [x] Classification preview shows emails grouped by case
- [x] Users can review uncertain classifications
- [x] Users can move emails between cases before import
- [x] Users can exclude emails from import
- [x] Single-case clients see simplified flow (4 steps, no classification)
- [x] Emails import to correct cases based on classification
- [x] CaseActors created appropriately per case
- [x] Attachments import to correct case documents
- [x] Import results show per-case breakdown
- [ ] **Pending verification**: End-to-end test with production data

---

## User Flow Decision Tree

```
User enters contact emails
         ‚îÇ
         ‚ñº
   Is client known?
    /          \
   NO          YES
   ‚îÇ            ‚îÇ
   ‚ñº            ‚ñº
Current     How many active
 flow       cases for client?
              /        \
            ONE      MULTIPLE
             ‚îÇ          ‚îÇ
             ‚ñº          ‚ñº
         Simplified   Multi-case
          preview     classification
             ‚îÇ        preview
             ‚îÇ          ‚îÇ
             ‚ñº          ‚ñº
         [Import]   [Review uncertain]
                        ‚îÇ
                        ‚ñº
                    [Import all]
```

---

## Files to Create/Modify

### Modified Files

- `apps/web/src/components/case/EmailImportWizard.tsx` (major changes)
- `apps/web/src/hooks/useEmailImport.ts` (add classification state)
- `services/gateway/src/graphql/schema/email-import.graphql` (new types)
- `services/gateway/src/graphql/resolvers/email-import.resolvers.ts`
- `services/gateway/src/services/email-to-case.service.ts`

### New Files

- `apps/web/src/components/case/ClassificationPreviewStep.tsx`
- `apps/web/src/components/case/EmailReviewList.tsx`
- `apps/web/src/components/case/UnclassifiedEmailsPanel.tsx`

---

## Edge Cases

1. **All emails unclassified** - Show warning, require manual assignment
2. **User moves all emails to single case** - Revert to simple import
3. **No cases for client** - Prompt to create case first
4. **Classification service unavailable** - Fall back to current behavior with warning
5. **Large email volume (1000+)** - Pagination, progressive loading

---

## Session Log

### Session 1 (2025-12-16)

**Status**: In Progress

**Context Restored:**

- Reviewed existing EmailImportWizard.tsx, useEmailImport.ts, email-import.graphql
- Reviewed email-classification.service.ts and email-classification.resolvers.ts from OPS-029
- OPS-027 (Schema) and OPS-029 (AI Classification Service) are complete
- OPS-028 (Metadata UI) is partially complete

**Implementation Strategy:**

Given the existing infrastructure:

1. The `previewEmailClassification` query in email-classification.resolvers.ts is a placeholder - need to implement it fully
2. Can leverage existing `classifySingleEmail` function from OPS-029
3. Need to add new wizard step between "preview" and "assign" for classification
4. For single-case clients, keep current flow (no classification needed)
5. For multi-case clients, show classification preview with review option

**Work Completed This Session:**

1. **GraphQL Schema Updates** (`services/gateway/src/graphql/schema/email-classification.graphql`):
   - Added `EmailForClassification` type for displaying email details in classification preview
   - Added `PreviewClassificationForImportInput` input type with caseId and emailAddresses
   - Added `ExecuteClassifiedImportInput` with support for overrides and exclusions
   - Added `CaseImportSummary` and `ClassifiedImportResult` types
   - Added `previewClassificationForImport` query
   - Added `clientHasMultipleCases` query for flow detection
   - Added `executeClassifiedImport` mutation

2. **Backend Resolvers** (`services/gateway/src/graphql/resolvers/email-classification.resolvers.ts`):
   - Implemented `previewClassificationForImport` resolver:
     - Derives client from caseId
     - Gets all active cases for the client
     - Fetches emails by participant addresses
     - Classifies each email against all client cases
     - Returns grouped results with email details
   - Implemented `clientHasMultipleCases` resolver
   - Implemented `executeClassifiedImport` mutation:
     - Applies user overrides and exclusions
     - Groups emails by target case
     - Imports to each case with timeline sync
     - Handles attachment import
     - Creates CaseActors
     - Returns per-case breakdown

3. **Frontend Hook** (`apps/web/src/hooks/useEmailImport.ts`):
   - Added classification types (ClassificationResult, ClassificationPreview, etc.)
   - Extended state to include classificationPreview, overrides, exclusions
   - Added `clientHasMultipleCases` query hook
   - Added `loadClassificationPreview` action
   - Added `setClassificationOverride` for user overrides
   - Added `setEmailExcluded` for excluding emails
   - Added `executeClassifiedImport` mutation call
   - Updated goBack to handle classify step

4. **Frontend UI** (`apps/web/src/components/case/EmailImportWizard.tsx`):
   - Added dynamic progress steps (4 or 5 steps based on multi-case)
   - Added classification step UI:
     - Summary by case (email count, auto vs review)
     - Needs review banner
     - Email list with checkboxes and case selectors
     - Confidence badges and reasons
     - Excluded count indicator
   - Updated preview step button to trigger classification for multi-case
   - Added classify step "ContinuƒÉ la Roluri" button
   - Updated assign step to use executeClassifiedImport when classification was performed

**TypeScript Compilation:** Both gateway and web app compile without errors.

**Files Modified:**

- `services/gateway/src/graphql/schema/email-classification.graphql`
- `services/gateway/src/graphql/resolvers/email-classification.resolvers.ts`
- `apps/web/src/hooks/useEmailImport.ts`
- `apps/web/src/components/case/EmailImportWizard.tsx`

**Bug Fixes During Testing:**

5. **Server Wiring** (`services/gateway/src/graphql/server.ts`):
   - Added `emailClassificationResolvers.Mutation` to Mutation resolvers
   - Added `CaseImportSummary` field resolver

6. **UI Improvements**:
   - Fixed progress bar to show 5 steps immediately when `hasMultipleCases` is true (not waiting for classificationPreview)
   - Increased modal width from `max-w-2xl` to `max-w-4xl` for better email visibility
   - Increased email list height from `max-h-64` to `max-h-96`

**Current State:**

- All code implemented and compiling
- Dev server running with production data
- TT Solaria client has 2 active cases (confirmed in database)
- Ready for end-to-end testing

**Next Steps:**

- Test complete flow: enter email ‚Üí preview ‚Üí classification ‚Üí roles ‚Üí import
- Verify emails are correctly classified between the two TT Solaria cases
- Run preflight checks
- Test in Docker preview
