# OPS-139: DocumentsContentPanel Context Integration

**Status**: Closed
**Type**: Feature
**Priority**: P2-Medium
**Complexity**: S (Small)
**Created**: 2024-12-24
**Closed**: 2024-12-24

## Context

Part of the Context-Aware Document Preview Actions epic. Integrates the action toolbar with the Documents tab in case details.

## Problem

DocumentsContentPanel opens DocumentPreviewModal but doesn't pass any context or actions. Users must close the modal to perform actions like "Add to Mapa", "Rename", or "Delete".

## Solution

1. Use `usePreviewActions('case-documents')` to get filtered actions
2. Implement action handlers for each action
3. Pass context, actions, and onAction to DocumentPreviewModal
4. Wire up handlers to existing modals where applicable

## Implementation Summary

### Completed Changes

1. **DocumentPreviewModal.tsx** (OPS-137):
   - Added `ActionToolbar` component with primary/secondary action grouping
   - Added props: `context`, `actions`, `userRole`, `onAction`
   - Integrated action toolbar footer that renders when actions are available
   - Download action handled internally

2. **usePreviewActions.ts** (OPS-138):
   - Created hook for role-based action filtering
   - Integrates with `useAuth` for user role
   - Returns `actions`, `primaryActions`, `secondaryActions`, `userRole`

3. **DocumentsContentPanel.tsx** (OPS-139):
   - Integrated `usePreviewActions({ context: 'case-documents' })`
   - Added `handlePreviewAction` callback for all action types
   - Connected to existing `AssignToMapaModal` for "add-to-mapa" action
   - Passed context, actions, userRole, and onAction to modal

### Action Handlers Status

| Action ID      | Handler                 | Status     |
| -------------- | ----------------------- | ---------- |
| `add-to-mapa`  | Opens AssignToMapaModal | ✅ Working |
| `download`     | Handled by modal        | ✅ Working |
| `rename`       | TODO log                | ⏳ Future  |
| `move`         | TODO log                | ⏳ Future  |
| `link-to-case` | TODO log                | ⏳ Future  |
| `delete`       | TODO log                | ⏳ Future  |

## Done When

- [x] `usePreviewActions('case-documents')` integrated
- [x] `handlePreviewAction` callback implemented for all actions
- [x] Context and actions passed to DocumentPreviewModal
- [x] Download action uses existing download logic
- [x] Mapa action reuses existing AssignToMapaModal
- [ ] Rename action shows modal/dialog (can be simple alert for MVP) - TODO
- [ ] Move action shows folder picker (can be TODO for MVP) - TODO
- [ ] Link action shows case picker (can be TODO for MVP) - TODO
- [ ] Delete action shows confirmation dialog - TODO
- [ ] Preview modal closes after successful action (where appropriate) - TODO

## Files Modified

- `apps/web/src/components/preview/DocumentPreviewModal.tsx`
- `apps/web/src/hooks/usePreviewActions.ts`
- `apps/web/src/components/documents/DocumentsContentPanel.tsx`

## Follow-up Work

The following modals need to be created for full functionality:

- `RenameDocumentModal.tsx`
- `MoveDocumentModal.tsx`
- `LinkDocumentModal.tsx`
- `DeleteDocumentDialog.tsx`

These are logged as TODOs in the action handler and can be addressed in future issues.

## Epic

Context-Aware Document Preview Actions (Phase 3 - Integration)
