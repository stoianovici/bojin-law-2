# OPS-212: ReferencesSection Component

**Type**: Feature | **Priority**: P2-Medium | **Complexity**: S
**Status**: Closed

## Problem

Case reference numbers need inline editing (dosar instanță, contract number, etc.).

## Approach

Simple list of key-value reference numbers using `InlineEditField`. Add button for new reference types.

```tsx
interface ReferencesSectionProps {
  caseId: string;
  references: CaseReference[];
  editable: boolean;
}

const referenceTypes = [
  { value: 'courtFileNumber', label: 'Nr. Dosar Instanță' },
  { value: 'contractNumber', label: 'Nr. Contract' },
  { value: 'registrationNumber', label: 'Nr. Înregistrare' },
  { value: 'executionFileNumber', label: 'Nr. Dosar Executare' },
  { value: 'custom', label: 'Altă referință' },
];

function ReferencesSection({ caseId, references, editable }: ReferencesSectionProps) {
  const [isAdding, setIsAdding] = useState(false);
  const [newRefType, setNewRefType] = useState('');

  return (
    <Card
      title="Referințe"
      action={
        editable && (
          <Button size="sm" variant="ghost" onClick={() => setIsAdding(true)}>
            + Adaugă
          </Button>
        )
      }
    >
      <div className="space-y-3">
        {references.map((ref) => (
          <div key={ref.key} className="flex items-center justify-between">
            <InlineEditField
              caseId={caseId}
              fieldName={`metadata.${ref.key}`}
              value={ref.value}
              label={referenceTypes.find((t) => t.value === ref.key)?.label || ref.key}
              editable={editable}
            />
            {editable && (
              <button
                onClick={() => handleRemove(ref.key)}
                className="text-red-500 hover:text-red-700"
              >
                <XIcon className="w-4 h-4" />
              </button>
            )}
          </div>
        ))}

        {isAdding && (
          <div className="border rounded-lg p-3 space-y-2">
            <select
              value={newRefType}
              onChange={(e) => setNewRefType(e.target.value)}
              className="w-full border rounded px-2 py-1"
            >
              <option value="">Selectează tipul...</option>
              {referenceTypes
                .filter((t) => !references.some((r) => r.key === t.value))
                .map((t) => (
                  <option key={t.value} value={t.value}>
                    {t.label}
                  </option>
                ))}
            </select>
            <div className="flex justify-end gap-2">
              <Button size="sm" variant="ghost" onClick={() => setIsAdding(false)}>
                Anulează
              </Button>
              <Button size="sm" onClick={handleAdd} disabled={!newRefType}>
                Adaugă
              </Button>
            </div>
          </div>
        )}

        {references.length === 0 && !isAdding && (
          <p className="text-gray-400 text-sm">Nicio referință adăugată</p>
        )}
      </div>
    </Card>
  );
}
```

## Done When

- [x] Renders existing references
- [x] Inline edit per reference via custom ReferenceItem component
- [x] Add new reference type with dropdown
- [x] Remove reference with X button
- [x] Per-field save via `useCaseUpdate` (stores in metadata.references)
- [x] Read-only mode when `editable=false`
- [x] Empty state message

## Implementation Notes

Used `useCaseUpdate` hook to store references in `metadata.references` array rather than individual metadata fields. Each reference is stored as `{type, value}` object. Custom references support custom labels stored as `custom:labelName` type format.

## Files

- `apps/web/src/components/case/sections/ReferencesSection.tsx` - new

## Dependencies

- OPS-207: useCaseEditPermission Hook

## Part Of

Expandable Case Workspace Epic (OPS-207 to OPS-217)
