# OPS-215: CaseHeader Edit Toggle

**Type**: Feature | **Priority**: P2-Medium | **Complexity**: S
**Status**: Closed

## Problem

Partners and Leads need visible edit toggle in case header to enter/exit edit mode.

## Solution Implemented

Added "Editează" button that sets URL query `?edit=true`. Only visible when `useCaseEditPermission.canEdit`. Button changes to "Vizualizare" when in edit mode.

**Changes:**

- Integrated `useCaseEditPermission` hook to check edit permissions
- Added URL-based edit mode toggle using `useRouter` and `useSearchParams`
- Button dynamically switches between "Editează" (pencil icon) and "Vizualizare" (eye icon)
- Removed callback-based `onEditCase` prop in favor of URL navigation
- Updated tests to mock new dependencies

## Approach

```tsx
import { useCaseEditPermission } from '@/hooks/useCaseEditPermission';
import { useRouter, useSearchParams } from 'next/navigation';

function CaseHeader({ caseId, caseData }: CaseHeaderProps) {
  const router = useRouter();
  const searchParams = useSearchParams();
  const { canEdit } = useCaseEditPermission(caseId);

  const isEditMode = searchParams.get('edit') === 'true';

  const toggleEditMode = () => {
    const params = new URLSearchParams(searchParams.toString());
    if (isEditMode) {
      params.delete('edit');
    } else {
      params.set('edit', 'true');
    }
    router.push(`/cases/${caseId}?${params.toString()}`);
  };

  return (
    <header className="...">
      {/* Existing header content */}

      <div className="flex items-center gap-2">
        {canEdit && (
          <Button variant={isEditMode ? 'secondary' : 'outline'} size="sm" onClick={toggleEditMode}>
            {isEditMode ? (
              <>
                <EyeIcon className="w-4 h-4 mr-1" />
                Vizualizare
              </>
            ) : (
              <>
                <PencilIcon className="w-4 h-4 mr-1" />
                Editează
              </>
            )}
          </Button>
        )}

        {/* Keep existing buttons: Add Team Member, More options */}
      </div>
    </header>
  );
}
```

## Done When

- [x] Edit button visible for Partner/Lead only
- [x] Toggles `?edit=true` query param
- [x] Button text/icon changes based on mode ("Editează" ↔ "Vizualizare")
- [x] Edit mode propagates to OverviewTab via URL
- [x] Works with browser back/forward navigation
- [x] Button styled appropriately (outline vs secondary)

## Files

- `apps/web/src/components/case/CaseHeader.tsx` - modify

## Dependencies

- OPS-207: useCaseEditPermission Hook

## Part Of

Expandable Case Workspace Epic (OPS-207 to OPS-217)
