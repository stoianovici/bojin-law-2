# OPS-037: Case Communications Tab - Read-Only Mode

**Status:** Fixing | **Priority:** P2-Medium | **Type:** Feature | **Created:** 2025-12-18
**Sessions:** 1 | **Last Active:** 2025-12-18

## Overview

Transform the Case Details Communications tab into a read-only view that shows all firm users' communications for the case.

## Dependencies

- **Depends on:** None
- **Blocks:** None (independent simplification)
- **Parallel with:** OPS-035, OPS-036

## Context

Part of the Communications Architecture Rethink. The case communications tab should be:

- **Read-only** - no compose, reply, or action buttons
- **Comprehensive** - shows ALL firm users' emails, not just current user
- **Informative** - AI summary + thread list

Users who want to take action go to `/communications` (their personal workspace).

## Requirements

### 1. Remove Action Capabilities

Remove from the tab:

- Compose button
- Reply buttons on threads/emails
- Forward buttons
- Email import wizard (will be accessible elsewhere or deprecated)
- Any edit/delete actions

### 2. Show All Firm Users' Emails

- Query emails for the case across ALL users in the firm
- Display which user each email belongs to (e.g., "Avocat Ana", "Avocat Mihai")
- Group by thread as usual

### 3. UI Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ComunicÄƒri                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“‹ Rezumat AI                                      [â–¼]  â”‚    â”‚
â”‚  â”‚ (collapsible, existing CaseConversationSummaryPanel)    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Thread-uri                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“§ Re: ÃntÃ¢lnire vineri (3 mesaje)                      â”‚    â”‚
â”‚  â”‚    ion.popescu@... â†” avocat.ana@firma.ro                â”‚    â”‚
â”‚  â”‚    Ultima: 15 dec 2025                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ›ï¸ CitaÈ›ie dosar 123/2025                               â”‚    â”‚
â”‚  â”‚    tribunalul@just.ro â†’ avocat.mihai@firma.ro           â”‚    â”‚
â”‚  â”‚    Ultima: 12 dec 2025                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Thread Preview Cards

Each thread shows:

- Subject line
- Participants (sender â†” recipient)
- Message count
- Last activity date
- Icon for court/institutional emails (ğŸ›ï¸)

Clicking a thread expands to show full conversation (read-only).

## Acceptance Criteria

- [x] All action buttons removed (compose, reply, forward) âœ…
- [x] Email import wizard removed from this tab âœ…
- [x] Tab shows emails from ALL firm users for this case âœ… (already done by backend - queries by firmId)
- [x] User attribution visible on emails âœ… (senderName/senderEmail already displayed)
- [x] AI summary panel preserved (CaseConversationSummaryPanel) âœ…
- [x] Thread preview cards with proper information âœ… (existing TimelineEntryCard)
- [ ] Court emails have special icon (future OPS-040)
- [x] No TypeScript errors âœ…

## Files Modified

- `apps/web/src/components/case/tabs/CommunicationsTab.tsx` - removed EmailImportWizard, set showComposer=false, added readOnly=true
- `apps/web/src/components/communication/UnifiedTimeline.tsx` - added readOnly prop, passes to TimelineEntryCard
- `apps/web/src/components/communication/TimelineEntryCard.tsx` - added readOnly prop, conditionally hides action buttons
- `apps/web/src/app/cases/[caseId]/page.tsx` - removed caseTitle prop from CommunicationsTab usage

## Implementation Notes

- The backend (`unified-timeline.service.ts`) already queries by `caseId` and `firmId`, not by `userId` - so it was already showing all firm users' emails
- User attribution is already visible via `senderName` and `senderEmail` fields in the TimelineEntry
- Court email special icon is deferred to OPS-040 (Court Email Detection)

---

#### Local Verification Status

| Step           | Status     | Date | Notes |
| -------------- | ---------- | ---- | ----- |
| Prod data test | â¬œ Pending |      |       |
| Preflight      | â¬œ Pending |      |       |
| Docker test    | â¬œ Pending |      |       |

**Verified**: No

---

## Session Log

- [2025-12-18] Session 1 started. Implementing read-only mode.
  - Explored current CommunicationsTab.tsx, UnifiedTimeline.tsx, TimelineEntryCard.tsx
  - Discovered backend already queries all firm users' emails (by firmId, not userId)
  - Removed EmailImportWizard import and usage
  - Set showComposer={false} and added readOnly={true} to UnifiedTimeline
  - Added readOnly prop to UnifiedTimeline and TimelineEntryCard components
  - Conditionally hide action buttons (Reply, Forward, More) when readOnly=true
  - Removed unused caseTitle prop from CommunicationsTab
  - TypeScript checks pass
  - Ready for local verification
