# OPS-280: Graph Service - Draft Mode Toggle

**Type**: Feature
**Priority**: P1-High
**Status**: Verifying
**Blocked By**: None

## Problem

`graphService.sendMail()` calls `/me/sendMail` which sends immediately. Need to redirect to `/me/messages` (create draft) with ability to toggle back when team is confident.

## Solution

1. Add `EMAIL_SEND_MODE` env var (values: `draft` | `send`, default: `draft`)
2. Modify `sendMail()` method:
   - If mode=draft: `POST /me/messages` → returns `{ id: "AAMk..." }`
   - If mode=send: `POST /me/sendMail` → returns `void`
3. Change return type to `Promise<{ draftId?: string }>`
4. Update graph.config.ts to document new env var

## API Reference

**Create Draft (Microsoft Graph)**:

```
POST https://graph.microsoft.com/v1.0/me/messages
Content-Type: application/json

{
  "subject": "...",
  "body": { "contentType": "HTML", "content": "..." },
  "toRecipients": [{ "emailAddress": { "address": "..." } }],
  "ccRecipients": [...],
  "attachments": [...]
}

Response: { "id": "AAMkAGI1...", "subject": "...", ... }
```

The draft appears in user's Outlook Drafts folder immediately.

## Done When

- [x] `sendMail()` creates draft when `EMAIL_SEND_MODE=draft`
- [x] `sendMail()` sends directly when `EMAIL_SEND_MODE=send`
- [x] Returns Outlook draft message ID when in draft mode
- [x] Works with existing callers (backwards compatible)
- [x] Env var documented in graph.config.ts

## Files

- `services/gateway/src/services/graph.service.ts`
- `services/gateway/src/config/graph.config.ts`

## Part Of

Universal Draft Mode Epic (OPS-279 to OPS-284)

## Notes

This is the core behavioral change. All downstream issues depend on this working.
