# OPS-208: useDraftCase Hook

**Type**: Feature | **Priority**: P2-Medium | **Complexity**: M
**Status**: Closed

## Problem

New case creation needs local state management before first save. Must warn on navigation to prevent data loss.

## Approach

Create hook managing draft case state with `useBeforeUnload` for navigation warning. State matches `CreateCaseInput` shape.

```typescript
interface DraftActor {
  id: string; // temp ID
  name: string;
  role: ActorRole;
  email?: string;
  organization?: string;
  phone?: string;
}

interface DraftReference {
  key: string;
  value: string;
}

interface DraftBilling {
  type: 'Hourly' | 'Fixed';
  fixedAmount?: number;
  customRates?: {
    partner: number;
    associate: number;
    paralegal: number;
  };
}

interface DraftCase {
  title: string;
  description: string;
  clientId: string | null;
  type: string;
  actors: DraftActor[];
  references: DraftReference[];
  billing?: DraftBilling;
}

function useDraftCase() {
  const [draft, setDraft] = useState<DraftCase>(initialDraft);
  const [isDirty, setIsDirty] = useState(false);

  // Warn on navigation if dirty
  useBeforeUnload(isDirty, 'Aveți modificări nesalvate. Sigur doriți să părăsiți pagina?');

  const updateField = <K extends keyof DraftCase>(field: K, value: DraftCase[K]) => {
    setDraft((prev) => ({ ...prev, [field]: value }));
    setIsDirty(true);
  };

  const save = async () => {
    /* call useCaseCreate */
  };
  const reset = () => {
    setDraft(initialDraft);
    setIsDirty(false);
  };

  return { draft, updateField, addActor, removeActor, save, reset, isDirty };
}
```

## Done When

- [x] Hook manages all draft fields
- [x] `isDirty` flag tracks unsaved changes
- [x] Browser warns on navigation when dirty
- [x] `save()` calls `useCaseCreate` mutation
- [x] `reset()` clears draft to initial state

## Implementation

Created `apps/web/src/hooks/useDraftCase.ts` with:

- `DraftCase` state with title, description, clientName, type, value, actors, references, billing
- `DraftActor` with tempId for UI tracking, name, role, email, emailDomains, organization, phone
- `DraftReference` with key/value pairs
- `DraftBilling` with type (Hourly/Fixed), fixedAmount, customRates
- `isDirty` flag tracking unsaved changes
- `beforeunload` event handler warning on navigation when dirty
- `save()` calling `useCaseCreate` mutation with validation
- `reset()` clearing draft to initial state
- Full validation with Romanian error messages
- Actor/reference/billing management methods

## Files

- `apps/web/src/hooks/useDraftCase.ts` - new

## Dependencies

None

## Part Of

Expandable Case Workspace Epic (OPS-207 to OPS-217)
