# OPS-185: Unify Case Communications Tab with /communications Thread View

| Field        | Value      |
| ------------ | ---------- |
| **Status**   | Complete   |
| **Priority** | P2-Medium  |
| **Created**  | 2025-12-24 |
| **Type**     | Feature    |

## Symptom

User wants the communications display in case detail to match the `/communications` page implementation. Currently they show different UI patterns:

- `/communications` shows chat-style conversation bubbles grouped by thread
- Case detail shows expandable card per email entry (timeline view)

## Root Cause

The case detail `CommunicationsTab` uses `UnifiedTimeline` component which displays individual timeline entries as expandable cards, while `/communications` uses `ConversationView` which displays email threads as chat-style conversation bubbles.

**Key Files**:

- `apps/web/src/components/case/tabs/CommunicationsTab.tsx:75` - Uses `UnifiedTimeline`
- `apps/web/src/components/communication/UnifiedTimeline.tsx` - Timeline card-based view
- `apps/web/src/components/communication/ConversationView.tsx` - Chat bubble view

**Data Flow Difference**:

1. `UnifiedTimeline` uses `useCaseTimeline` hook - fetches individual timeline entries
2. `ConversationView` uses `useCommunicationStore` + `useEmailThread` - fetches grouped thread data

## Fix

Replace `UnifiedTimeline` in `CommunicationsTab` with a threads-based view that:

1. Lists email threads for the case (like CaseSidebar in /communications)
2. Shows selected thread using `ConversationView` component

### Implementation Options

**Option A: Minimal - Reuse CaseSidebar + ConversationView**

- Add a `caseId` filter mode to `CaseSidebar`
- Embed `ConversationView` for selected thread
- Pros: Maximum code reuse
- Cons: May need to adjust sidebar styling for inline case tab

**Option B: New Component - CaseThreadsPanel**

- Create `CaseThreadsPanel` component that combines:
  - Thread list using `useEmailThreads({ caseId })`
  - Selected thread display using `ConversationView`
- Pros: Can customize for case context (no uncertain/court sections)
- Cons: Some code duplication

**Recommended: Option A** - Reuse existing components with minor adjustments.

### Required Changes

1. **Modify `CaseSidebar`** to support standalone mode:
   - Add `singleCaseMode?: boolean` prop
   - When `singleCaseMode`, only show threads for that case (no court/uncertain sections)

2. **Update `CommunicationsTab`**:
   - Replace `UnifiedTimeline` with thread list + `ConversationView`
   - Fetch threads using `useEmailThreads({ caseId })`
   - Store selected thread in local state

3. **Keep AI Summary Section**:
   - The collapsible AI summary panel should remain at top

## Verification

- [ ] Open case detail > Communications tab
- [ ] Verify threads are listed in sidebar-style list
- [ ] Click a thread - shows chat-style conversation bubbles
- [ ] Verify sent/received message alignment matches `/communications`
- [ ] Test with case that has multiple threads
- [ ] Test with case that has no threads (empty state)

## Session Log

### 2025-12-24 - Investigation

- Investigated difference between `/communications` and case detail communications
- Found root cause: different components (`ConversationView` vs `UnifiedTimeline`)
- Documented fix approach

### 2025-12-24 - Implementation

- Replaced `UnifiedTimeline` with thread-based view in `CommunicationsTab`
- Added two-column layout: thread list on left, `ConversationView` on right
- Added Chat/Cards view mode toggle (reuses `threadViewMode` from communication store)
- Kept AI Summary collapsible panel at top
- Verified UI displays correctly with empty state
- Screenshot: `.playwright-mcp/ops-185-communications-tab-unified.png`
