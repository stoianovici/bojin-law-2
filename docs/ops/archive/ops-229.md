# OPS-229: Remove Semantic Search from Backend

**Type**: Refactor | **Priority**: P2-Medium | **Status**: Resolved

**Blocked by**: OPS-228 (resolved)

## Problem

Semantic search code (Voyage AI embeddings, pgvector queries, RRF algorithm) adds ~400 lines of dead code and complexity. Since Voyage AI will never be used, this code should be removed to simplify maintenance.

## Solution

Removed all semantic search related code from the search service:

### Removed from `search.service.ts`

1. **Types removed**:
   - `SearchMode` enum (removed entirely)
   - `RankedItem` interface
   - Kept `SearchMatchType` (simplified to only `FULL_TEXT`)

2. **Constants removed**:
   - `SEARCH_MIN_SIMILARITY`
   - `SEMANTIC_CACHE_TTL`
   - `RRF_K`

3. **Methods removed**:
   - `semanticSearch()`
   - `semanticSearchCases()`
   - `semanticSearchDocuments()`
   - `hybridSearch()`
   - `applyRRF()`
   - `truncateText()` (was only used by semantic search)

4. **Simplified `search()` method**:
   - Removed `mode` parameter
   - Removed switch statement
   - Calls `fullTextSearch()` directly

5. **Updated `recordSearch()` method**:
   - Removed `searchType` parameter (always uses 'FullText')

### Import changes

- Removed `embeddingService` import from search service
- Kept `embedding.service.ts` (used by email-search and attachment-suggestion services)

### Updated files consuming SearchMode

- `services/gateway/src/graphql/resolvers/search.resolvers.ts` - Removed SearchMode import, simplified resolver
- `services/gateway/src/services/intent-handlers/document.handler.ts` - Removed SearchMode import
- `services/gateway/src/services/ai-orchestrator.service.ts` - Removed SearchMode import
- `services/gateway/src/services/search.service.test.ts` - Updated tests for simplified API

## Done

- [x] `SearchMode` enum removed from service
- [x] All semantic search methods removed
- [x] `hybridSearch()` and `applyRRF()` removed
- [x] `search()` method simplified to call `fullTextSearch()` directly
- [x] Embedding service import removed from search service
- [x] TypeScript compiles without errors
- [x] All usages of SearchMode updated
- [x] Tests updated

## Files Changed

- `services/gateway/src/services/search.service.ts` - Major refactor (~370 lines removed)
- `services/gateway/src/services/search.service.test.ts` - Updated tests
- `services/gateway/src/graphql/resolvers/search.resolvers.ts` - Simplified resolver
- `services/gateway/src/services/intent-handlers/document.handler.ts` - Updated import
- `services/gateway/src/services/ai-orchestrator.service.ts` - Updated import

## Notes

- GraphQL schema still has `SearchMode` enum for backwards compatibility (will be removed in OPS-230)
- `embedding.service.ts` kept because it's used by other services
- All search modes now use full-text search internally
