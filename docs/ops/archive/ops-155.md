# OPS-155: useReportData Hook + ReportViewer Integration

**Type**: Feature
**Priority**: P2-Medium
**Status**: Resolved
**Resolved**: 2025-12-24
**Created**: 2025-12-24
**Epic**: Predefined Reports with AI-Generated Insights (OPS-150 to OPS-155)

## Problem

Frontend has no hooks to fetch from new API, and ReportViewer doesn't display AI insights.

## Solution

1. Create React hooks for report data fetching
2. Add AI insights section to ReportViewer
3. Update both ReportViewer and ReportCategoriesSidebar to use API

## Implementation

### Hooks (`apps/web/src/hooks/useReportData.ts`)

```typescript
export function usePredefinedReports(categoryId?: ReportCategory);
export function useReportData(reportId: string | null, dateRange?: DateRange);
export function useReportAIInsight(reportId: string | null, dateRange?: DateRange);
export function useReportWithInsight(reportId: string | null, dateRange?: DateRange);
```

### ReportViewer Changes

- Replaced mock data with API calls via `usePredefinedReports` and `useReportData`
- Added collapsible "AnalizÄƒ AI" section with:
  - Confidence badge
  - AI summary paragraph
  - Key findings bullet list
  - Recommendations bullet list
  - Regenerate button
  - Loading skeleton
- Added loading states with skeleton shimmer
- Added error states with AlertCircle icon

### ReportCategoriesSidebar Changes

- Replaced `getReportMetadata()` mock call with `usePredefinedReports()` API hook
- Role-based filtering now happens on backend
- Added loading skeleton state

## Files

- `apps/web/src/hooks/useReportData.ts` (new)
- `apps/web/src/components/reports/ReportViewer.tsx` (updated)
- `apps/web/src/components/reports/ReportCategoriesSidebar.tsx` (updated)

## Done When

- [x] Three hooks implemented with Apollo Client
- [x] AI section added to ReportViewer
- [x] Loading/error states handled
- [x] Romanian UI text
- [x] TypeScript compiles

## Blocked By

~~OPS-151, OPS-154~~ (completed)

## Resolution

Implemented complete frontend integration for reports:

**New Hook** (`useReportData.ts`):

- `usePredefinedReports()` - fetches report templates from API, filtered by role on backend
- `useReportData()` - fetches chart data and summary for selected report
- `useReportAIInsight()` - lazy query for AI insights (on-demand loading)
- `useReportWithInsight()` - combined hook for both data and insights

**ReportViewer Updates**:

- Now fetches from GraphQL API instead of mock data
- Collapsible AI insights section with on-demand loading
- Confidence score badge
- Regenerate button for fresh AI analysis
- Proper loading skeletons
- Error state handling

**ReportCategoriesSidebar Updates**:

- Fetches templates from API
- Role filtering happens on backend (cleaner architecture)
- Loading skeleton state
