# OPS-192: Action Bar - Outlook + Compose Button

**Status:** Closed | **Priority:** P2-Medium | **Type:** Feature | **Created:** 2025-12-24

## Overview

Update email action bar: "RÄƒspunde" opens Outlook, add "+ Nou" button for composing, remove "NotificÄƒ pÄƒrÈ›ile".

## Dependencies

- **Depends on:** None (mostly UI)
- **Blocks:** None
- **Parallel with:** OPS-190, OPS-191

## Context

Part of Communications UX Overhaul epic. Instead of in-app email composition, users should reply via Outlook directly. This simplifies the app and leverages Outlook's full capabilities.

## Requirements

### 1. "RÄƒspunde" Button Behavior

Opens Outlook with reply context:

```typescript
function openOutlookReply(email: Email) {
  const to = encodeURIComponent(extractSenderEmail(email.from));
  const subject = encodeURIComponent(`Re: ${email.subject}`);

  // Try desktop Outlook first, fallback to web
  const desktopUrl = `ms-outlook://compose?to=${to}&subject=${subject}`;
  const webUrl = `https://outlook.office.com/mail/deeplink/compose?to=${to}&subject=${subject}`;

  // Attempt desktop, fallback to web after timeout
  window.location.href = desktopUrl;
  setTimeout(() => {
    window.open(webUrl, '_blank');
  }, 500);
}
```

### 2. "+ Nou" Button

New compose button for starting fresh threads:

```typescript
function openOutlookCompose() {
  const desktopUrl = 'ms-outlook://compose';
  const webUrl = 'https://outlook.office.com/mail/deeplink/compose';

  window.location.href = desktopUrl;
  setTimeout(() => {
    window.open(webUrl, '_blank');
  }, 500);
}
```

### 3. Remove "NotificÄƒ pÄƒrÈ›ile"

Delete the NotifyStakeholdersModal and its trigger button.

### 4. Action Bar Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [+ Nou]   [RÄƒspunde]   [Personal]   [ğŸ”’ Privat]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- "+ Nou": Primary outline button
- "RÄƒspunde": Primary filled button
- "Personal": Secondary button
- "ğŸ”’ Privat": Toggle (partners only, added in OPS-194)

## Acceptance Criteria

- [ ] "RÄƒspunde" opens Outlook (desktop or web)
- [ ] Reply prefills to/subject correctly
- [ ] "+ Nou" button visible and opens compose
- [ ] "NotificÄƒ pÄƒrÈ›ile" button removed
- [ ] NotifyStakeholdersModal component removed or deprecated
- [ ] Works on Windows and Mac
- [ ] Fallback to Outlook Web if desktop not available

## Files to Modify

- `apps/web/src/components/communication/ConversationHeader.tsx`
- `apps/web/src/utils/outlook.ts` (NEW - utility functions)
- `apps/web/src/app/communications/page.tsx`
- `apps/web/src/components/communication/NotifyStakeholdersModal.tsx` (REMOVE or deprecate)

## Estimated Scope

Small - Button behavior changes and utility creation.

---

## Session Log

### Session 2025-12-24

**Changes Made:**

1. **Created `apps/web/src/utils/outlook.ts`**
   - `extractEmail()` - parses "Name <email>" format
   - `openOutlookCompose()` - opens Outlook for new email
   - `openOutlookReply(senderEmail, subject)` - opens Outlook with reply context
   - Uses `ms-outlook://` protocol for desktop with web fallback

2. **Updated `ConversationView.tsx`**
   - Replaced internal `openCompose` with `openOutlookReply`
   - Added "+ Nou" button that calls `openOutlookCompose`
   - Updated "RÄƒspunde" button with external link icon
   - Removed NotifyStakeholdersModal import and usage
   - Removed `showNotifyModal` state

3. **Updated `MessageView.tsx`**
   - Same changes as ConversationView
   - Updated `Message` component interface: `onReply: () => void`
   - Removed "NotificÄƒ pÄƒrÈ›ile" button
   - Added "+ Nou" and updated "RÄƒspunde" buttons

**Acceptance Criteria Status:**

- [x] "RÄƒspunde" opens Outlook (desktop or web)
- [x] Reply prefills to/subject correctly
- [x] "+ Nou" button visible and opens compose
- [x] "NotificÄƒ pÄƒrÈ›ile" button removed
- [x] NotifyStakeholdersModal no longer used (kept file for potential future use)
- [x] Works on Windows and Mac (protocol-based)
- [x] Fallback to Outlook Web if desktop not available

**Note:** NotifyStakeholdersModal.tsx file kept but no longer imported/used. Can be removed in OPS-198 cleanup phase.
