# OPS-157: Fix team-workload-distribution aggregation

| Field        | Value                                      |
| ------------ | ------------------------------------------ |
| **Status**   | Open                                       |
| **Type**     | Bug                                        |
| **Priority** | P2-Medium                                  |
| **Created**  | 2025-12-24                                 |
| **Epic**     | Reports Data Accuracy (OPS-156 to OPS-161) |

## Problem

The `team-workload-distribution` report uses `getTasksByStatus()` which shows task counts grouped by status (Pending, InProgress, Completed). But the report description says "Cum sunt distribuite dosarele în echipă" - it should show **case count per team member**.

## Root Cause

In `reports.resolvers.ts`:

```typescript
case 'team-task-completion':
case 'team-workload-distribution':
  result = await dataService.getTasksByStatus(range);
  break;
```

Both reports incorrectly use the same method. `team-workload-distribution` needs a different aggregation.

## Solution

1. Add `getWorkloadDistribution()` method that:
   - Queries `CaseTeam` to get user-case assignments
   - Groups by user, counts active cases per user
   - Returns user names with case counts
2. Route `team-workload-distribution` to this new method

## Files

- `services/gateway/src/services/report-data.service.ts`
- `services/gateway/src/graphql/resolvers/reports.resolvers.ts`

## Done When

- [x] Report shows each team member's name with their case count
- [x] Chart displays horizontal bar chart of workload per person
- [x] Only counts non-archived cases

## Implementation

Added `getWorkloadDistribution()` method to `report-data.service.ts`:

- Queries `CaseTeam` join table for user-case assignments
- Filters to non-archived cases via `case.status: { not: 'Archived' }`
- Aggregates by user, counts cases per user
- Returns sorted horizontal bar chart data

Updated `reports.resolvers.ts`:

- Separated `team-workload-distribution` from `team-task-completion`
- Routes to new `getWorkloadDistribution()` method
