# OPS-281: Email Resolvers - Draft ID Tracking

**Type**: Feature
**Priority**: P1-High
**Status**: Closed
**Blocked By**: ~~OPS-279, OPS-280~~ (Complete)

## Problem

`sendNewEmail` and `replyToEmail` mutations send emails but don't track the resulting draft IDs for audit purposes.

## Solution

1. Update `sendNewEmail` mutation:
   - Get draft ID from `graphService.sendMail()` response
   - Create `SentEmailDraft` record with source=NEW_EMAIL
   - Return draft ID in mutation response
2. Update `replyToEmail` mutation:
   - Same pattern, source=REPLY
3. Update GraphQL schema to return `outlookDraftId` in response types

## Schema Changes

```graphql
type SendEmailResult {
  success: Boolean!
  messageId: String
  error: String
  outlookDraftId: String # NEW - OPS-281
  savedToDrafts: Boolean # NEW - indicates draft mode was used
}
```

## Done When

- [x] `sendNewEmail` creates `SentEmailDraft` record
- [x] `replyToEmail` creates `SentEmailDraft` record
- [x] Both mutations return `outlookDraftId` in response
- [x] Records include caseId when available

## Files

- `services/gateway/src/graphql/resolvers/email.resolvers.ts`
- `services/gateway/src/graphql/schema/email.graphql`

## Part Of

Universal Draft Mode Epic (OPS-279 to OPS-284)

## Implementation Summary

1. Added `GraphService` import and instance to email.resolvers.ts
2. Updated `sendNewEmail` mutation:
   - Replaced raw `fetch()` calls with `graphService.sendMail()`
   - Creates `SentEmailDraft` record with `SentEmailSource.NEW_EMAIL` when in draft mode
   - Returns `outlookDraftId` and `savedToDrafts` in response
3. Updated `replyToEmail` mutation:
   - Same pattern, uses `SentEmailSource.REPLY`
   - Gets caseId from email's primary caseLink for audit trail
4. Updated GraphQL schema:
   - Added `outlookDraftId: String` to `SendEmailResult`
   - Added `savedToDrafts: Boolean` to `SendEmailResult`

## Notes

The `source` enum helps distinguish where emails originated for reporting.
