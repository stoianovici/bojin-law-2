# OPS-226: Client GraphQL Query + Resolver

**Type**: Feature
**Priority**: P2-Medium
**Status**: Completed
**Created**: 2025-12-25

## Problem

No way to query a client's full case portfolio from the API. Need backend support before building client profile page (OPS-227).

Currently, the only way to see a client's cases is to filter the cases list, which is not user-friendly.

## Solution

Add `client(id: ID!)` query returning client details with their cases. Include case count, status breakdown, and list of cases with basic info.

## Implementation

### 1. GraphQL Schema

```graphql
# In client.graphql

type ClientWithCases {
  id: ID!
  name: String!
  email: String
  phone: String
  address: String
  cases: [CaseSummary!]!
  caseCount: Int!
  activeCaseCount: Int!
}

type CaseSummary {
  id: ID!
  caseNumber: String!
  title: String!
  status: CaseStatus!
  type: String!
  openedDate: DateTime!
}

extend type Query {
  client(id: ID!): ClientWithCases
}
```

### 2. Resolver

```typescript
// In client.resolvers.ts

client: async (_: unknown, { id }: { id: string }, context: GraphQLContext) => {
  const { userId, firmId } = context.user;

  const client = await prisma.client.findFirst({
    where: { id, firmId },
    include: {
      cases: {
        select: {
          id: true,
          caseNumber: true,
          title: true,
          status: true,
          type: true,
          openedDate: true,
        },
        orderBy: { openedDate: 'desc' },
      },
    },
  });

  if (!client) return null;

  return {
    ...client,
    caseCount: client.cases.length,
    activeCaseCount: client.cases.filter((c) => c.status === 'Active').length,
  };
};
```

### 3. Service Method (optional)

If complex logic needed, add to `client.service.ts`:

```typescript
async getClientWithCases(clientId: string, firmId: string): Promise<ClientWithCases | null>
```

## Files to Modify

- `services/gateway/src/graphql/schema/client.graphql` - add types and query
- `services/gateway/src/graphql/resolvers/client.resolvers.ts` - add resolver
- `services/gateway/src/services/client.service.ts` - add method if needed

## Done When

- [x] GraphQL query `client(id: ID!)` added
- [x] Returns: id, name, email, phone, address, cases[], caseCount, activeCaseCount
- [x] Cases include: id, caseNumber, title, status, type, openedDate
- [x] Resolver fetches from database with proper firm scoping
- [x] Query works in GraphQL playground
- [x] No TypeScript errors

## Dependencies

- None (parallel with OPS-224, OPS-225)

## Blocks

- OPS-227: Client Profile Page (needs this query)
