# OPS-050: Overview Tab AI Summary UI

**Status:** Implementing | **Priority:** P1-High | **Type:** Feature
**Created:** 2025-12-19 | **Depends on:** OPS-046, OPS-048, OPS-049
**Sessions:** 1 | **Last Active:** 2025-12-19

## Summary

Integrate the AI case summary and unified chronology into the Prezentare GeneralÄƒ (Overview) tab with a 2-column layout.

## Background

The Overview tab currently shows static case details. This issue adds:

1. AI-generated executive summary (persistent, auto-updating)
2. Key developments and open issues in 2-column layout
3. Unified chronology with all case events

## Requirements

### 1. Layout Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§  Rezumat AI                                    Actualizat acum â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  [Rezumat executiv - 2-3 propoziÈ›ii despre starea cazului]      â”‚
â”‚                                                                  â”‚
â”‚  Status Curent: Dosarul este Ã®n faza de...                      â”‚
â”‚                                                                  â”‚
â”‚  [Actualizare Ã®n curs...] â† shown when isStale=true             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¡ DezvoltÄƒri Cheie          â”‚  â”‚  âš ï¸ Probleme Nerezolvate      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â†’ Contract semnat 15 dec     â”‚  â”‚  â€¢ LipseÈ™te dovada de platÄƒ   â”‚
â”‚  â†’ RÄƒspuns instanÈ›Äƒ primit    â”‚  â”‚  â€¢ Client neconfirmat         â”‚
â”‚  â†’ Expert desemnat            â”‚  â”‚  â€¢ Termen scurt (3 zile)      â”‚
â”‚  â†’ Depunere cerere finalizatÄƒ â”‚  â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“… Cronologie                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  18 dec  ğŸ“„ Document: ExpertizÄƒ tehnicÄƒ Ã®ncÄƒrcatÄƒ       [HIGH]  â”‚
â”‚  15 dec  âœ‰ï¸ Email instanÈ›Äƒ: CitaÈ›ie termen              [HIGH]  â”‚
â”‚  12 dec  âœ… SarcinÄƒ: Depunere cerere finalizatÄƒ         [MED]   â”‚
â”‚  10 dec  ğŸ“ NotÄƒ: DiscuÈ›ie telefonicÄƒ cu clientul       [MED]   â”‚
â”‚  08 dec  âœ‰ï¸ Email primit de la client                   [MED]   â”‚
â”‚                                                                  â”‚
â”‚                    [ÃncarcÄƒ mai multe]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Detalii Caz                  â”‚  â”‚  Membrii Echipei              â”‚
â”‚  (existing card)              â”‚  â”‚  (existing card)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. CaseAISummarySection Component

```tsx
// apps/web/src/components/case/CaseAISummarySection.tsx

'use client';

import { Brain, RefreshCw, Loader2 } from 'lucide-react';
import { formatDistanceToNow } from 'date-fns';
import { ro } from 'date-fns/locale';
import { useCaseSummary } from '../../hooks/useCaseSummary';

interface CaseAISummarySectionProps {
  caseId: string;
}

export function CaseAISummarySection({ caseId }: CaseAISummarySectionProps) {
  const { summary, loading } = useCaseSummary(caseId);

  if (loading && !summary) {
    return <SummarySkeleton />;
  }

  if (!summary) {
    return <EmptyState />;
  }

  return (
    <div className="space-y-4">
      {/* Executive Summary Card */}
      <div className="bg-white rounded-lg border border-gray-200 p-5">
        <div className="flex items-center justify-between mb-3">
          <div className="flex items-center gap-2">
            <Brain className="h-5 w-5 text-purple-500" />
            <h3 className="font-semibold text-gray-900">Rezumat AI</h3>
          </div>
          <div className="flex items-center gap-2 text-xs text-gray-500">
            {summary.isStale && (
              <span className="flex items-center gap-1 text-amber-600">
                <Loader2 className="h-3 w-3 animate-spin" />
                Actualizare Ã®n curs...
              </span>
            )}
            <span>
              Actualizat{' '}
              {formatDistanceToNow(new Date(summary.generatedAt), {
                addSuffix: true,
                locale: ro,
              })}
            </span>
          </div>
        </div>

        <p className="text-gray-700 mb-4">{summary.executiveSummary}</p>

        <div className="bg-blue-50 rounded-lg p-3 border border-blue-100">
          <h4 className="text-sm font-medium text-blue-800 mb-1">Status Curent</h4>
          <p className="text-sm text-blue-700">{summary.currentStatus}</p>
        </div>
      </div>

      {/* 2-Column: Key Developments + Open Issues */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <KeyDevelopmentsCard developments={summary.keyDevelopments} />
        <OpenIssuesCard issues={summary.openIssues} />
      </div>
    </div>
  );
}
```

### 3. CaseChronology Component

```tsx
// apps/web/src/components/case/CaseChronology.tsx

'use client';

import { Calendar, FileText, Mail, MessageSquare, CheckCircle } from 'lucide-react';
import { format } from 'date-fns';
import { ro } from 'date-fns/locale';
import { useCaseEvents } from '../../hooks/useCaseEvents';

const EVENT_ICONS = {
  DOCUMENT_UPLOADED: FileText,
  DOCUMENT_SIGNED: FileText,
  EMAIL_RECEIVED: Mail,
  EMAIL_SENT: Mail,
  EMAIL_COURT: Mail,
  NOTE_CREATED: MessageSquare,
  TASK_COMPLETED: CheckCircle,
  // ... etc
};

const IMPORTANCE_STYLES = {
  HIGH: 'bg-red-100 text-red-700 border-red-200',
  MEDIUM: 'bg-gray-100 text-gray-600 border-gray-200',
  LOW: 'bg-gray-50 text-gray-400 border-gray-100',
};

export function CaseChronology({ caseId }: { caseId: string }) {
  const { events, loading, loadMore, hasMore } = useCaseEvents(caseId);

  return (
    <div className="bg-white rounded-lg border border-gray-200">
      <div className="px-5 py-4 border-b border-gray-200 flex items-center gap-2">
        <Calendar className="h-5 w-5 text-green-500" />
        <h3 className="font-semibold text-gray-900">Cronologie</h3>
      </div>

      <div className="divide-y divide-gray-100">
        {events.map((event) => {
          const Icon = EVENT_ICONS[event.eventType] || Calendar;
          return (
            <div key={event.id} className="px-5 py-3 flex items-start gap-3">
              <div className="text-xs text-gray-500 w-16 flex-shrink-0 pt-0.5">
                {format(new Date(event.occurredAt), 'dd MMM', { locale: ro })}
              </div>
              <Icon className="h-4 w-4 text-gray-400 flex-shrink-0 mt-0.5" />
              <div className="flex-1 min-w-0">
                <p className="text-sm text-gray-900">{event.title}</p>
                {event.description && (
                  <p className="text-xs text-gray-500 truncate">{event.description}</p>
                )}
              </div>
              <span
                className={`text-xs px-1.5 py-0.5 rounded border ${IMPORTANCE_STYLES[event.importance]}`}
              >
                {event.importance === 'HIGH' ? 'Important' : ''}
              </span>
            </div>
          );
        })}
      </div>

      {hasMore && (
        <div className="px-5 py-3 border-t border-gray-100">
          <button
            onClick={loadMore}
            disabled={loading}
            className="w-full text-sm text-blue-600 hover:text-blue-700"
          >
            {loading ? 'Se Ã®ncarcÄƒ...' : 'ÃncarcÄƒ mai multe'}
          </button>
        </div>
      )}
    </div>
  );
}
```

### 4. useCaseSummary Hook

```typescript
// apps/web/src/hooks/useCaseSummary.ts

import { gql, useQuery } from '@apollo/client';

const GET_CASE_SUMMARY = gql`
  query GetCaseSummary($caseId: ID!) {
    caseSummary(caseId: $caseId) {
      id
      executiveSummary
      currentStatus
      keyDevelopments
      openIssues
      generatedAt
      isStale
      emailCount
      documentCount
    }
  }
`;

export function useCaseSummary(caseId: string) {
  const { data, loading, error, refetch } = useQuery(GET_CASE_SUMMARY, {
    variables: { caseId },
    skip: !caseId,
    // Poll every 30s if stale to check for updates
    pollInterval: data?.caseSummary?.isStale ? 30000 : 0,
  });

  return {
    summary: data?.caseSummary,
    loading,
    error,
    refetch,
  };
}
```

### 5. useCaseEvents Hook

```typescript
// apps/web/src/hooks/useCaseEvents.ts

import { gql, useQuery } from '@apollo/client';

const GET_CASE_EVENTS = gql`
  query GetCaseEvents($caseId: ID!, $first: Int, $after: String) {
    caseEvents(caseId: $caseId, minImportance: MEDIUM, first: $first, after: $after) {
      edges {
        node {
          id
          eventType
          title
          description
          importance
          occurredAt
        }
        cursor
      }
      pageInfo {
        hasNextPage
        endCursor
      }
      totalCount
    }
  }
`;

export function useCaseEvents(caseId: string) {
  const { data, loading, fetchMore } = useQuery(GET_CASE_EVENTS, {
    variables: { caseId, first: 10 },
    skip: !caseId,
  });

  const loadMore = () => {
    if (data?.caseEvents?.pageInfo?.hasNextPage) {
      fetchMore({
        variables: {
          after: data.caseEvents.pageInfo.endCursor,
        },
      });
    }
  };

  return {
    events: data?.caseEvents?.edges?.map((e) => e.node) ?? [],
    loading,
    loadMore,
    hasMore: data?.caseEvents?.pageInfo?.hasNextPage ?? false,
    totalCount: data?.caseEvents?.totalCount ?? 0,
  };
}
```

### 6. OverviewTab Integration

Update `OverviewTab.tsx` to include the new sections:

```tsx
export function OverviewTab({ case: caseData, ... }) {
  return (
    <div className="h-full overflow-y-auto bg-gray-50 p-6">
      <div className="max-w-7xl mx-auto space-y-6">
        {/* NEW: AI Summary Section */}
        <CaseAISummarySection caseId={caseData.id} />

        {/* NEW: Chronology */}
        <CaseChronology caseId={caseData.id} />

        {/* Existing cards in grid */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <Card title="Detalii Caz">...</Card>
          <Card title="Membrii Echipei">...</Card>
          {/* ... rest of existing cards */}
        </div>
      </div>
    </div>
  );
}
```

## Acceptance Criteria

- [x] `CaseAISummarySection` component displays cached summary
- [x] 2-column layout for dezvoltÄƒri cheie + probleme nerezolvate
- [x] `CaseChronology` component with paginated events
- [x] Event icons based on type
- [x] Importance badges (only show for HIGH)
- [x] "Actualizare Ã®n curs" indicator when `isStale`
- [x] Polling for updates when stale
- [x] Romanian text throughout
- [x] Responsive design (stacks on mobile)

## Files to Create/Modify

- `apps/web/src/components/case/CaseAISummarySection.tsx` (new)
- `apps/web/src/components/case/CaseChronology.tsx` (new)
- `apps/web/src/hooks/useCaseSummary.ts` (new)
- `apps/web/src/hooks/useCaseEvents.ts` (new)
- `apps/web/src/components/case/tabs/OverviewTab.tsx` (modify)

## Testing

- Unit test: components render with mock data
- Unit test: loading states
- Unit test: empty states
- E2E test: summary appears in overview tab
- E2E test: pagination works for chronology
- Visual test: 2-column layout on desktop, stacked on mobile

## Local Verification Status

| Step           | Status     | Date       | Notes                            |
| -------------- | ---------- | ---------- | -------------------------------- |
| Prod data test | â¬œ Pending |            | Need to test with real case data |
| Preflight      | âœ… Passed  | 2025-12-19 | TypeScript + Docker build passes |
| Docker test    | â¬œ Pending |            | Need to test in Docker           |

**Verified**: No (awaiting manual verification)

## Session Log

### Session 1 (2025-12-19)

**Implemented:**

1. Created `useCaseSummary` hook (`apps/web/src/hooks/useCaseSummary.ts`)
   - Fetches cached AI summary via GraphQL
   - Polls every 30s when summary is stale

2. Created `useCaseEvents` hook (`apps/web/src/hooks/useCaseEvents.ts`)
   - Fetches paginated case events
   - Supports importance filtering
   - Cursor-based pagination with loadMore

3. Created `CaseAISummarySection` component (`apps/web/src/components/case/CaseAISummarySection.tsx`)
   - Executive summary card with Brain icon
   - Current status in blue highlight box
   - 2-column layout: Key Developments + Open Issues
   - Data stats (email, doc, note, task counts)
   - Loading skeleton and empty states
   - "Actualizare Ã®n curs" indicator when stale

4. Created `CaseChronology` component (`apps/web/src/components/case/CaseChronology.tsx`)
   - Paginated event timeline
   - Event-type icons (FileText, Mail, MessageSquare, etc.)
   - Importance badges (only shown for HIGH)
   - Actor display
   - Load more button

5. Integrated into `OverviewTab.tsx`
   - Added AI Summary section at top
   - Added Chronology below summary
   - Existing cards remain in grid below

**Verification:**

- TypeScript: âœ… Compiles with no errors
- Production build: âœ… Succeeds
- Docker build: âœ… Both web and gateway build successfully
- Pre-existing test failure: `ListView.test.tsx` (unrelated to this work)

**Next Steps:**

1. Test with production data locally
2. Verify UI in browser
3. Close issue when verified
