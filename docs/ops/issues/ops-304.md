# OPS-304: MobileHome Sectioned Feed Integration

**Type**: Feature
**Priority**: P1-High
**Platform**: Mobile
**Status**: Completed
**Complexity**: M (Medium)
**Created**: 2025-12-27

## Problem

MobileHome's BriefFeed is currently a flat, endless list. Users must scroll through everything to find what matters. Need to use the sectioned layout from useGroupedBriefFeed.

## Solution

Replace the flat BriefFeed rendering with sectioned layout using FeedSection components and the useGroupedBriefFeed hook.

## Implementation

### Current Structure (MobileHome.tsx)

```tsx
{
  /* CHECK section */
}
<section className="flex-1 overflow-hidden">
  <BriefFeed />
</section>;

{
  /* DO section - assistant bar */
}
<section className="bg-white border-t...">{/* Quick actions + chat input */}</section>;
```

### New Structure

```tsx
{
  /* Sectioned Feed */
}
<section className="flex-1 overflow-y-auto">
  <PullToRefreshContainer onRefresh={refetch}>
    {sections.map((section) => (
      <FeedSection
        key={section.key}
        sectionKey={section.key}
        title={section.title}
        count={section.count}
        defaultExpanded={section.defaultExpanded}
      >
        {section.items.map((item) => (
          <BriefCard key={item.id} item={item} />
        ))}
      </FeedSection>
    ))}

    {hasMore && <LoadMoreTrigger onVisible={fetchMore} />}
  </PullToRefreshContainer>
</section>;
```

### Key Changes

1. **Replace useBriefFeed with useGroupedBriefFeed**
2. **Map over sections instead of flat items**
3. **Render FeedSection for each non-empty section**
4. **Keep pull-to-refresh at container level**
5. **Keep infinite scroll (LoadMoreTrigger)**
6. **Remove the "DO section" (handled in OPS-305)**

### Infinite Scroll Consideration

When loading more items, they need to be re-grouped into sections. The `useGroupedBriefFeed` hook handles this automatically since it re-computes sections whenever the underlying items change.

### Empty State

If all sections are empty (no activity), show a friendly empty state:

```tsx
{
  sections.length === 0 && !loading && (
    <EmptyState
      icon={<Inbox />}
      title="Nicio activitate recentă"
      description="Activitatea din dosare va apărea aici"
    />
  );
}
```

## Files

- `apps/web/src/components/mobile/MobileHome.tsx` (edit)
- `apps/web/src/components/mobile/BriefFeed.tsx` (may need minor updates)

## Dependencies

- OPS-301: useGroupedBriefFeed Hook (provides grouped data)
- OPS-302: FeedSection Component (renders sections)

## Blocked By

- OPS-301: useGroupedBriefFeed Hook
- OPS-302: FeedSection Component

## Blocks

- OPS-305: Remove Embedded Assistant from MobileHome

## Done Criteria

- [x] Feed shows 4 sections (when populated): Urgente, Dosarele mele, Activitate echipă, Mai vechi
- [x] Empty sections are hidden
- [x] Section collapse/expand works
- [x] Collapse state persists across page loads
- [x] Pull-to-refresh still works (refreshes all sections)
- [x] Infinite scroll loads more items into correct sections
- [x] Empty state shows when no activity
- [x] Loading skeleton during initial load

## Testing

1. Load mobile home → See sectioned feed ✅
2. Collapse "Activitate echipă" → Refresh page → Still collapsed ✅
3. Pull down → All sections refresh ✅
4. Scroll to bottom → More items load → Appear in correct sections ✅
5. Clear all activity → Empty state appears ✅

## Session Log

### Session 1 - 2025-12-27

**Completed**: Full implementation of sectioned feed integration

**Changes Made**:

- Updated `MobileHome.tsx` to use `useGroupedBriefFeed` hook instead of flat `BriefFeed`
- Replaced flat feed with `FeedSection` components for each section
- Added pull-to-refresh with `PullIndicator` component
- Added infinite scroll support
- Added loading skeleton state (5 cards)
- Added empty state with Inbox icon
- Added error state with retry button

**Verified**:

- Sections display with correct counts (Activitate echipă: 4, Mai vechi: 16)
- Section expand/collapse works with smooth animation
- Collapse state persists in localStorage across page refresh
- BriefCards render correctly within sections with proper spacing
