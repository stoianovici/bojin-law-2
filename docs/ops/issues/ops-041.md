# OPS-041: /communications Case-Organized Redesign

**Status:** Open | **Priority:** P1-High | **Type:** Feature | **Created:** 2025-12-18

## Overview

Complete redesign of `/communications` as the user's email workspace, organized by case with separate sections for court emails and uncertain classifications.

## Dependencies

- **Depends on:** OPS-035, OPS-036, OPS-038, OPS-039, OPS-040
- **Blocks:** None
- **Parallel with:** OPS-042

## Context

Part of the Communications Architecture Rethink. This is the main integration issue that brings together all the foundation work.

**Key principles:**

- Shows only current user's emails
- Organized by case (not a flat inbox)
- Action-oriented: reply, forward, compose
- Separate sections for court emails (INSTANȚE) and uncertain (NECLAR)

## Requirements

### 1. Page Layout

```
┌─────────────────────────────────────────────────────────────────────┐
│  Emailurile Mele                                          [Sync ↻] │
├──────────────────┬──────────────────────────────────────────────────┤
│                  │                                                  │
│  DOSARE          │  Thread View (Outlook-style)                     │
│  ─────────────── │  ──────────────────────────────────────────────  │
│  ▼ Popescu v.    │  From: ion.popescu@email.com                     │
│    Ionescu (3)   │  To: me                                          │
│    • Thread 1    │  Subject: Re: Întâlnire vineri                   │
│    • Thread 2    │  ────────────────────────────────────────────    │
│    • Thread 3    │                                                  │
│                  │  Bună ziua,                                      │
│  ▼ SC Alpha v.   │                                                  │
│    SC Beta (1)   │  Confirm prezența la întâlnirea de vineri...     │
│                  │                                                  │
│  ─────────────── │  ──────────────────────────────────────────────  │
│  INSTANȚE (2)    │                        [Răspunde] [Redirecționează]
│  • Citație 123   │                                                  │
│  • Notificare    │                                                  │
│                  │                                                  │
│  ─────────────── │                                                  │
│  NECLAR (1) [!]  │                                                  │
│  • De la Maria   │                                                  │
│                  │                                                  │
└──────────────────┴──────────────────────────────────────────────────┘
```

### 2. Left Sidebar - Case Accordion

```typescript
interface SidebarSection {
  type: 'cases' | 'court' | 'uncertain';
  items: SidebarItem[];
}

interface SidebarItem {
  id: string;
  label: string; // Case title or email subject
  unreadCount: number;
  threads?: ThreadPreview[]; // Expandable
}
```

**Behavior:**

- Cases expanded by default if they have unread emails
- Click case to expand/collapse thread list
- Click thread to view in main panel
- INSTANȚE section: court emails not assigned (COURT_UNASSIGNED)
- NECLAR section: emails needing classification (UNCERTAIN)

### 3. Thread View

Outlook-style conversation view:

- Full email thread with all messages
- Most recent at top or bottom (configurable?)
- HTML email rendering (existing MessageView)
- Action buttons: Răspunde, Redirecționează

### 4. Data Fetching

```graphql
query getMyEmailsByCase {
  myEmailsByCase {
    cases {
      id
      title
      unreadCount
      threads {
        id
        subject
        lastMessageDate
        messageCount
        isUnread
      }
    }
    courtUnassigned {
      id
      subject
      from
      receivedDateTime
      extractedReferences
    }
    uncertain {
      id
      subject
      from
      receivedDateTime
      suggestedCases {
        id
        title
        confidence
      }
    }
  }
}
```

### 5. Empty States

- No cases: "Nu aveți emailuri în dosare active"
- No court emails: Section hidden or "Nicio corespondență de la instanțe"
- No uncertain: Section hidden (good state!)

### 6. Sync Integration

Keep existing sync button and status:

- "Sincronizează email" button
- Last sync timestamp
- Sync in progress indicator

After sync, new emails appear in appropriate sections based on classification.

## Acceptance Criteria

- [ ] Left sidebar shows cases with thread counts
- [ ] Cases expandable to show threads
- [ ] INSTANȚE section shows unassigned court emails
- [ ] NECLAR section shows uncertain emails (with badge)
- [ ] Thread view shows full conversation
- [ ] Reply and Forward buttons work
- [ ] AI assist available in reply composer
- [ ] Only current user's emails shown
- [ ] Infinite scroll in thread lists
- [ ] Sync button works
- [ ] Responsive design (mobile-friendly)
- [ ] No TypeScript errors

## Files to Modify

- `apps/web/src/app/communications/page.tsx` - complete rewrite
- New: `apps/web/src/components/communication/CaseSidebar.tsx`
- New: `apps/web/src/components/communication/CaseAccordion.tsx`
- New: `apps/web/src/hooks/useMyEmailsByCase.ts`
- Reuse: `apps/web/src/components/communication/MessageView.tsx`
- Reuse: `apps/web/src/components/communication/ComposeInterface.tsx`

## Estimated Scope

Large - Complete page redesign.

---

## Session Log

_(Add session notes here as work progresses)_
