# OPS-248: Add document_drafting to AI Feature Config

**Type**: Feature
**Priority**: P2-Medium
**Status**: Completed
**Created**: 2025-12-26

## Problem

Document drafting is fully implemented (Story 3.3, QA passed 90/100) but invisible in the AI Ops dashboard. Admins cannot:

- See document generation costs
- Toggle the feature on/off
- Select which model to use (Haiku vs Sonnet)

This is inconsistent with `email_drafting` which has all these controls.

## Solution

Add `document_drafting` as a request-type feature in `AI_FEATURES` constant and refactor the resolver to use `aiClient.complete()` for usage tracking.

## Implementation

1. Add `document_drafting` to `AI_FEATURES` constant
2. Add `document_drafting` to operation type mapping
3. Refactor `generateDocumentWithAI` resolver to use `aiClient.complete()` instead of calling ai-service
4. Add Romanian feature name to FEATURE_NAMES in ai-usage.service

## Files Modified

- `services/gateway/src/services/ai-feature-config.service.ts` - Added to `AI_FEATURES` and operation type mapping
- `services/gateway/src/graphql/resolvers/document-drafting.resolvers.ts` - Refactored to use aiClient.complete()
- `services/gateway/src/services/ai-usage.service.ts` - Added feature name

## Done When

- [x] `document_drafting` appears in Feature Toggles page at `/admin/ai-ops/features`
- [x] Toggle enables/disables document generation
- [x] Model selector works (Haiku/Sonnet)
- [x] Document generation calls are tracked in AI Usage stats
- [x] Costs appear in Cost Breakdown charts

## Technical Notes

- Default model: `claude-sonnet-4-20250514` (complex legal documents need quality)
- Rate limiting already exists in resolver (10/hour/user) - kept
- The resolver now calls Claude directly via `aiClient` instead of proxying to ai-service
- Simplified context aggregation (case info only, no precedent lookup in gateway version)

## Session Log

### Session 1 - 2025-12-26

- Issue created from /ops-ideate exploration
- Discovered document drafting is implemented but not in AI_FEATURES

### Session 2 - 2025-12-26

- Added `document_drafting` to `AI_FEATURES` constant in ai-feature-config.service.ts
- Added operation type mapping for budget tracking
- Refactored generateDocumentWithAI resolver to use aiClient.complete()
- Added feature check - throws error if feature is disabled
- Added model selection from feature config (default: Sonnet for quality)
- Added Romanian feature name "Redactare Document" to FEATURE_NAMES
- Build passes, feature is now trackable in AI Ops dashboard
