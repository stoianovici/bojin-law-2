# OPS-313: MobileHome Briefing + Masthead Integration

**Type**: Feature | **Priority**: P1-High | **Platform**: Mobile
**Status**: Verifying
**Blocked by**: OPS-310 (MobileBriefing), OPS-312 (ConditionalLayout Footer)

## Problem

MobileHome currently shows chronological BriefRow feed. Need to replace with personalized briefing layout and add masthead avatar for drawer access (since edge swipe is hidden/non-discoverable).

## Approach

### 1. Masthead Changes

- Add user avatar/initials button on right side of masthead
- Tap opens drawer (replaces hidden edge swipe as primary access)
- Keep date on left, avatar on right
- Use same initials pattern as MobileDrawer header

### 2. Content Changes

- Add `MobileBriefing` component above the existing feed
- Keep the grouped BriefRow feed below briefing as "Activitate Recenta"
- Or: Replace feed entirely with briefing-only for cleaner look
- Pull-to-refresh refreshes both briefing and feed

### 3. Layout Adjustments

- Remove existing `pb-*` and let ConditionalLayout handle footer padding
- Keep edge swipe as secondary drawer trigger

## Implementation

```tsx
// apps/web/src/components/mobile/MobileHome.tsx

// Add imports
import { MobileBriefing } from './MobileBriefing';
import { useAuth } from '../../contexts/AuthContext';
import { Menu } from 'lucide-react';

// Modify Masthead component:
function Masthead({ onMenuClick }: { onMenuClick: () => void }) {
  const { user } = useAuth();
  const dateStr = format(new Date(), 'EEE d MMM', { locale: ro });
  const formattedDate = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);

  const initials = user
    ? `${user.firstName?.[0] || ''}${user.lastName?.[0] || ''}`.toUpperCase()
    : 'U';

  return (
    <div className="px-4 pt-6 pb-2 flex items-center justify-between">
      <span className="text-xs font-semibold text-gray-400 uppercase tracking-wider">
        Rezumat Â· {formattedDate}
      </span>
      <button
        onClick={onMenuClick}
        className="w-9 h-9 rounded-full bg-blue-500 flex items-center justify-center"
        aria-label="Deschide meniu"
      >
        <span className="text-white text-sm font-medium">{initials}</span>
      </button>
    </div>
  );
}

// In MobileHome, update Masthead usage:
<Masthead onMenuClick={openDrawer} />

// Replace or augment feed content:
<main className="flex-1 flex flex-col overflow-hidden">
  <section ref={containerRef} className="flex-1 overflow-y-auto relative" onScroll={handleScroll} {...containerProps}>
    <PullIndicator state={pullState} pullDistance={pullDistance} progress={progress} />

    <div
      className="transition-transform duration-200"
      style={{ transform: pullDistance > 0 ? `translateY(${pullDistance}px)` : undefined }}
    >
      {/* Morning Briefing Section */}
      <MobileBriefing />

      {/* Divider */}
      <div className="px-4 py-3">
        <div className="border-t border-gray-200" />
      </div>

      {/* Recent Activity Feed (existing sections) */}
      <div className="px-4 pb-2">
        <span className="text-xs font-semibold text-gray-400 uppercase tracking-wider">
          Activitate Recenta
        </span>
      </div>

      {sections.map((section, sectionIndex) => (
        // ... existing section rendering
      ))}
    </div>
  </section>
</main>
```

## Done When

- [x] Masthead shows user avatar/initials on right side
- [x] Tapping avatar opens drawer
- [x] MobileBriefing renders at top of content
- [x] Feed sections appear below briefing with divider
- [x] Pull-to-refresh works on entire content area
- [x] Edge swipe still works as backup drawer trigger
- [x] No double bottom padding (ConditionalLayout handles it)

## Files

- `apps/web/src/components/mobile/MobileHome.tsx` - modify Masthead, add MobileBriefing

## Testing

- Open mobile home - see briefing at top
- See avatar in masthead, tap to open drawer
- Scroll down to see activity feed
- Pull to refresh - both briefing and feed update
- Edge swipe from left still opens drawer
- Navigate away and back - state preserved
