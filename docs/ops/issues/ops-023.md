# OPS-023: Gateway Service TypeScript Compilation Errors

**Status:** Open | **Priority:** P1-High | **Type:** Bug | **Created:** 2025-12-14

## Problem

The gateway service (`services/gateway`) has multiple TypeScript compilation errors that prevent `pnpm build` from completing. These errors predate OPS-022 and block full monorepo builds.

## Impact

- Cannot run `pnpm preview` (full production build)
- Cannot deploy gateway service
- Web app builds independently and can still be deployed

## Error Categories

### 1. Missing Module/Export Errors

- `winston` and `../lib/logger` modules not found
- `getR2StorageService` not exported from r2-storage.service
- `getEmbeddingService` not exported from embedding.service

### 2. Prisma Schema Mismatches

- `deadlineDate` field doesn't exist on ExtractedDeadline (should be `dueDate`)
- `dependsOn` relation not in TaskInclude
- `parent` relation not in TaskInclude
- `assignedToId` should be `assignedTo`
- `metadata` field missing from Task model
- `email` field doesn't exist on Client model (use `contactInfo` JSON)

### 3. Type Incompatibilities

- `Task` type missing properties: `createdBy`, `parseHistoryId`, `templateStepId`, `templateUsageId`, `metadata`
- `DocumentStatus` doesn't include `"active"` (different casing?)
- `CaseType` type mismatch in pattern-detection.service
- `Record<string, unknown>` not assignable to `InputJsonValue`
- `Timer` vs `Timeout` type mismatch in clearTimeout

### 4. Missing NotificationType Values

- `TaskAssigned` not in NotificationType enum

### 5. Service Method Mismatches

- `R2StorageService` missing: `uploadFile`, `deleteFile`, `getSignedUrl`
- `EmbeddingService.generateEmbedding` signature mismatch

## Affected Files

```
src/services/dashboard-export.service.ts
src/services/deadline-warning.service.ts
src/services/email-attachment.service.ts
src/services/email-search.service.ts
src/services/estimate-comparison.service.ts
src/services/extraction-conversion.service.ts
src/services/notification.service.ts
src/services/parallel-task.service.ts
src/services/pattern-detection.service.ts
src/services/performance-metrics.service.ts
src/services/subtask.service.ts
src/services/task-attachment.service.ts
src/services/task-history.service.ts
src/services/template-application.service.ts
src/services/time-entry.service.ts
src/workers/email-categorization.worker.ts
src/workers/monthly-intelligence-report.worker.ts
```

## Root Cause Analysis

These appear to be accumulated from multiple feature implementations where:

1. Prisma schema was updated but services weren't updated to match
2. Service interfaces changed but consumers weren't updated
3. New features added placeholder code that was never completed

## Recommended Fix Strategy

1. **Phase 1: Quick Fixes** - Fix type annotations and simple mismatches
2. **Phase 2: Schema Alignment** - Update services to match current Prisma schema
3. **Phase 3: Service Stubs** - Add missing methods to R2StorageService, EmbeddingService
4. **Phase 4: Clean Up** - Remove or complete placeholder code

## Session Log

- [2025-12-14] Issue created during OPS-022 deployment attempt
