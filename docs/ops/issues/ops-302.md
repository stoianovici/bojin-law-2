# OPS-302: FeedSection Component

**Type**: Feature
**Priority**: P1-High
**Platform**: Mobile
**Status**: Completed
**Complexity**: S (Small)
**Created**: 2025-12-27

## Problem

Need a collapsible section UI component for the grouped brief feed. Each section should have a header with title, count badge, and collapse toggle.

## Solution

Create a reusable collapsible section component with animated height transitions and persistent collapse state.

## Implementation

### Visual Design

```
┌─────────────────────────────────────────┐
│  ▼ Urgente                          (3) │  ← Expanded
├─────────────────────────────────────────┤
│  [BriefCard]                            │
│  [BriefCard]                            │
│  [BriefCard]                            │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│  ▶ Activitate echipă               (12) │  ← Collapsed
└─────────────────────────────────────────┘
```

### Component Interface

```tsx
interface FeedSectionProps {
  sectionKey: string; // For localStorage persistence
  title: string; // Romanian label
  count: number; // Item count for badge
  defaultExpanded: boolean;
  children: ReactNode; // BriefCards
}

export function FeedSection({
  sectionKey,
  title,
  count,
  defaultExpanded,
  children,
}: FeedSectionProps) {
  const [isExpanded, setIsExpanded] = usePersistedState(
    `feed-section-${sectionKey}`,
    defaultExpanded
  );

  return (
    <div className="border-b border-gray-100">
      <button
        onClick={() => setIsExpanded(!isExpanded)}
        className="w-full flex items-center justify-between p-4 hover:bg-gray-50"
      >
        <div className="flex items-center gap-2">
          <ChevronRight
            className={clsx('w-4 h-4 transition-transform', isExpanded && 'rotate-90')}
          />
          <span className="font-medium text-gray-900">{title}</span>
        </div>
        <span className="text-sm text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full">{count}</span>
      </button>

      <AnimatePresence>
        {isExpanded && (
          <motion.div
            initial={{ height: 0, opacity: 0 }}
            animate={{ height: 'auto', opacity: 1 }}
            exit={{ height: 0, opacity: 0 }}
            transition={{ duration: 0.2 }}
          >
            {children}
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}
```

### Persistence

Use localStorage to remember collapse state per section:

- Key format: `feed-section-{sectionKey}`
- Falls back to `defaultExpanded` on first visit
- Syncs across tabs (optional, use storage event)

## Files

- `apps/web/src/components/mobile/FeedSection.tsx` (new)

## Dependencies

- Framer Motion (already installed)
- `usePersistedState` or similar pattern (may need to create)

## Blocked By

- OPS-301: useGroupedBriefFeed Hook (needs section interface)

## Blocks

- OPS-304: MobileHome Sectioned Feed Integration

## Done Criteria

- [x] Header with title + count badge
- [x] Tappable header toggles collapse state
- [x] Chevron icon rotates on collapse (0° → 90°)
- [x] Smooth height animation using Framer Motion
- [x] Collapse state persists to localStorage
- [x] Renders children (BriefCards) when expanded
- [x] Exported from `components/mobile/index.ts`

## Session Log

### Session 1 (2025-12-27)

**Completed:**

1. Created `usePersistedState.ts` hook for localStorage persistence with SSR safety
2. Created `FeedSection.tsx` component with:
   - Collapsible header with title and count badge
   - Chevron icon with Framer Motion rotation animation
   - AnimatePresence for smooth height transitions
   - localStorage persistence via usePersistedState
   - ARIA attributes for accessibility
3. Exported from `components/mobile/index.ts`
4. TypeScript check passes

**Files Created:**

- `apps/web/src/hooks/usePersistedState.ts`
- `apps/web/src/components/mobile/FeedSection.tsx`

**Status:** Ready for integration in OPS-304
