# OPS-296: Mobile Drawer State Behavior

**Type**: Feature | **Priority**: P1-High | **Complexity**: S

## Problem

Current toggle behavior is designed for desktop: collapsed (icons only) ↔ expanded (with labels). On mobile, the semantics need adjustment: hidden ↔ visible drawer.

## Solution

Adjust state handling so the same `isSidebarCollapsed` state works correctly for both contexts:

- On mobile: `isSidebarCollapsed=true` means hidden off-screen, `false` means drawer visible
- On desktop: `isSidebarCollapsed=true` means narrow icons, `false` means expanded
- Both use the same toggle function

Key behavioral adjustments:

1. Sidebar should default to collapsed (hidden on mobile, narrow on desktop)
2. When navigating on mobile, auto-close drawer (existing behavior in `handleItemClick`)
3. Backdrop click closes drawer (existing behavior)
4. Consider: on mobile, always start collapsed regardless of localStorage

## Implementation

### Sidebar.tsx - Adjust default and backdrop logic

```tsx
// Backdrop should show on mobile when drawer is open (!isSidebarCollapsed)
// But on desktop, backdrop already shows when expanded
{
  !isSidebarCollapsed && (
    <div
      className="fixed inset-0 bg-black/20 z-[55] transition-opacity duration-300"
      onClick={toggleSidebar}
      aria-hidden="true"
    />
  );
}
```

Current backdrop logic is correct - it shows when `!isSidebarCollapsed` which means:

- Mobile: drawer open
- Desktop: expanded

### navigation.store.ts - Consider mobile-first default

```tsx
// Option: Default to collapsed (better mobile experience)
isSidebarCollapsed: true, // Changed from false
```

Or add viewport-aware initialization:

```tsx
// On mount, check viewport and set appropriate default
isSidebarCollapsed: typeof window !== 'undefined' && window.innerWidth < 768
  ? true // Mobile: start hidden
  : false; // Desktop: start expanded
```

## Done When

- [ ] Hamburger opens/closes drawer on mobile
- [ ] Navigation item click closes drawer on mobile
- [ ] Click outside (backdrop) closes drawer on mobile
- [ ] Desktop collapse/expand behavior unchanged
- [ ] Fresh page load on mobile shows content first (drawer closed)

## Files

- `apps/web/src/components/layout/Sidebar.tsx` - Verify click handlers
- `apps/web/src/stores/navigation.store.ts` - Adjust default state

## Testing

1. Clear localStorage, load on mobile viewport - verify drawer closed
2. Click hamburger - drawer opens
3. Click nav item - drawer closes, navigation works
4. Click backdrop - drawer closes
5. Desktop: collapse/expand still works as before

## Dependencies

- OPS-294: Mobile Sidebar CSS Transform (CSS must be in place)
- OPS-295: Mobile Layout Padding Removal (layout must be adjusted)

## Blocked By

- OPS-294
- OPS-295

## Blocks

- OPS-297: Touch Gesture Support
