# OPS-053: Chronology Tab Bar & Event Type Filtering

**Status:** Implemented | **Priority:** P2-Medium | **Type:** Feature | **Created:** 2025-12-19 | **Sessions:** 1

## Context

Part of the chronology structure improvement (OPS-051 through OPS-054). This issue creates the tab bar component and event filtering logic.

## Scope

1. Create a tab bar component for switching between event categories
2. Define event type mappings for each tab
3. Add filtering logic (client-side)

## Tab Configuration

| Tab            | Label      | Event Types                                                              |
| -------------- | ---------- | ------------------------------------------------------------------------ |
| all            | Toate      | All events                                                               |
| documents      | Documente  | `DocumentUploaded`, `DocumentSigned`, `DocumentDeleted`                  |
| communications | Comunicări | `EmailReceived`, `EmailSent`, `EmailCourt`, `NoteCreated`, `NoteUpdated` |
| tasks          | Sarcini    | `TaskCreated`, `TaskCompleted`                                           |

**Note:** `CaseStatusChanged`, `TeamMemberAdded`, `ContactAdded` only appear in "Toate" tab.

## Implementation

### Constants File

`apps/web/src/components/case/chronologyTabs.ts`

```typescript
import type { CaseEventType } from '../../hooks/useCaseEvents';

export type ChronologyTab = 'all' | 'documents' | 'communications' | 'tasks';

export const TAB_CONFIG: Record<
  ChronologyTab,
  {
    label: string;
    eventTypes: CaseEventType[] | null; // null = all types
  }
> = {
  all: {
    label: 'Toate',
    eventTypes: null,
  },
  documents: {
    label: 'Documente',
    eventTypes: ['DocumentUploaded', 'DocumentSigned', 'DocumentDeleted'],
  },
  communications: {
    label: 'Comunicări',
    eventTypes: ['EmailReceived', 'EmailSent', 'EmailCourt', 'NoteCreated', 'NoteUpdated'],
  },
  tasks: {
    label: 'Sarcini',
    eventTypes: ['TaskCreated', 'TaskCompleted'],
  },
};

export const TAB_ORDER: ChronologyTab[] = ['all', 'documents', 'communications', 'tasks'];

export function filterEventsByTab(
  events: Array<{ eventType: CaseEventType }>,
  tab: ChronologyTab
): Array<{ eventType: CaseEventType }> {
  const config = TAB_CONFIG[tab];
  if (!config.eventTypes) return events;
  return events.filter((e) => config.eventTypes!.includes(e.eventType));
}

export function countEventsByTab(
  events: Array<{ eventType: CaseEventType }>
): Record<ChronologyTab, number> {
  return {
    all: events.length,
    documents: filterEventsByTab(events, 'documents').length,
    communications: filterEventsByTab(events, 'communications').length,
    tasks: filterEventsByTab(events, 'tasks').length,
  };
}
```

### Tab Bar Component

`apps/web/src/components/case/ChronologyTabBar.tsx`

```typescript
'use client';

import React from 'react';
import { clsx } from 'clsx';
import { TAB_CONFIG, TAB_ORDER, type ChronologyTab } from './chronologyTabs';

export interface ChronologyTabBarProps {
  activeTab: ChronologyTab;
  counts: Record<ChronologyTab, number>;
  onTabChange: (tab: ChronologyTab) => void;
  className?: string;
}

export function ChronologyTabBar({
  activeTab,
  counts,
  onTabChange,
  className
}: ChronologyTabBarProps) {
  return (
    <div className={clsx('flex border-b border-gray-200', className)}>
      {TAB_ORDER.map((tab) => {
        const config = TAB_CONFIG[tab];
        const isActive = tab === activeTab;
        const count = counts[tab];

        return (
          <button
            key={tab}
            onClick={() => onTabChange(tab)}
            className={clsx(
              'px-4 py-2 text-sm font-medium transition-colors relative',
              isActive
                ? 'text-blue-600 border-b-2 border-blue-600 -mb-px'
                : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
            )}
          >
            {config.label}
            {tab !== 'all' && count > 0 && (
              <span className={clsx(
                'ml-1.5 text-xs px-1.5 py-0.5 rounded-full',
                isActive ? 'bg-blue-100 text-blue-600' : 'bg-gray-100 text-gray-500'
              )}>
                {count}
              </span>
            )}
          </button>
        );
      })}
    </div>
  );
}

ChronologyTabBar.displayName = 'ChronologyTabBar';
```

### UI Design

```
┌─────────────────────────────────────────────────────┐
│ [Toate] [Documente (12)] [Comunicări (28)] [Sarcini (7)]│
│ ════════                                            │
└─────────────────────────────────────────────────────┘
```

- Active tab: `text-blue-600` with bottom border
- Inactive tabs: `text-gray-600` with hover state
- Count badges: Only shown for non-"Toate" tabs, in pill style

## Acceptance Criteria

- [x] Tab constants and filtering logic created
- [x] TabBar component created with proper styling
- [x] Active state clearly visible
- [x] Count badges show filtered counts
- [x] Follows project conventions (clsx, displayName)

## Dependencies

- None (can be built independently)

## Blocked By

- Nothing

## Blocks

- OPS-054 (CaseChronology Integration)

---

## Session Log

- [2025-12-19] Session 1: Implemented chronologyTabs.ts and ChronologyTabBar.tsx. TypeScript compilation passes. All acceptance criteria met. Ready for integration in OPS-054.

## Files Created

- `apps/web/src/components/case/chronologyTabs.ts` - Tab config, types, and filtering functions
- `apps/web/src/components/case/ChronologyTabBar.tsx` - Tab bar UI component
