# OPS-298: Mobile Home - Fresh Build

**Type**: Feature | **Priority**: P0-Critical | **Platform**: Mobile | **Complexity**: L

**Supersedes**: OPS-294, OPS-295, OPS-296, OPS-297 (drawer-based approach abandoned)

## Vision

Mobile-first home screen built on the **Check vs Do** mental model:

- **CHECK** (top 2/3): Company Brief - latest comms, docs received/approved
- **DO** (bottom 1/3): Assistant bar - 3 quick actions + AI chat

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‰¡  Bojin Law           [avatar] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚   BRIEF - Ce e nou              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ ğŸ“¨ Email primit            â”‚ â”‚
â”‚   â”‚ Tribunal Sector 3          â”‚ â”‚
â”‚   â”‚ CitaÈ›ie dosar Ionescu...   â”‚ â”‚
â”‚   â”‚ acum 2 ore                 â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ âœ… Document aprobat        â”‚ â”‚
â”‚   â”‚ Contract servicii.pdf      â”‚ â”‚
â”‚   â”‚ Aprobat: Av. Bojin         â”‚ â”‚
â”‚   â”‚ ieri                       â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ ğŸ“„ Document primit         â”‚ â”‚
â”‚   â”‚ Ãncheiere instanÈ›Äƒ.pdf     â”‚ â”‚
â”‚   â”‚ Dosar: Ionescu v. Alpha    â”‚ â”‚
â”‚   â”‚ acum 3 ore                 â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ASSISTANT                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Sarciniâ”‚ â”‚ NotiÈ›eâ”‚ â”‚Finalizatâ”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Altceva...                 ğŸ¤â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Architecture

### Detection Strategy

Create `useIsMobile()` hook - renders MobileHome on screens < 768px:

```tsx
// hooks/useIsMobile.ts
export function useIsMobile() {
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    const check = () => setIsMobile(window.innerWidth < 768);
    check();
    window.addEventListener('resize', check);
    return () => window.removeEventListener('resize', check);
  }, []);

  return isMobile;
}
```

### Component Tree

```
app/page.tsx
â”œâ”€â”€ useIsMobile()
â”œâ”€â”€ if mobile â†’ <MobileHome />
â””â”€â”€ if desktop â†’ <PartnerDashboard /> (existing)

MobileHome
â”œâ”€â”€ MobileHeader (hamburger, logo, avatar)
â”œâ”€â”€ BriefFeed (scrollable)
â”‚   â””â”€â”€ BriefCard[] (email, doc, approval)
â”œâ”€â”€ AssistantBar (fixed bottom)
â”‚   â”œâ”€â”€ QuickActionButton[] (Sarcini, NotiÈ›e, Finalizat)
â”‚   â””â”€â”€ ChatInput (Altceva... + voice)
â””â”€â”€ MobileDrawer (slide-in navigation)
```

### New Components

| Component      | Location                             | Purpose                  |
| -------------- | ------------------------------------ | ------------------------ |
| `MobileHome`   | `components/mobile/MobileHome.tsx`   | Main mobile container    |
| `MobileHeader` | `components/mobile/MobileHeader.tsx` | Top bar with hamburger   |
| `BriefFeed`    | `components/mobile/BriefFeed.tsx`    | Scrollable activity list |
| `BriefCard`    | `components/mobile/BriefCard.tsx`    | Individual activity card |
| `AssistantBar` | `components/mobile/AssistantBar.tsx` | Fixed bottom actions     |
| `MobileDrawer` | `components/mobile/MobileDrawer.tsx` | Navigation drawer        |
| `useIsMobile`  | `hooks/useIsMobile.ts`               | Screen size detection    |
| `useBriefFeed` | `hooks/useBriefFeed.ts`              | Activity feed data       |

### Data Requirements

**New GraphQL Query: `briefFeed`**

Returns unified activity stream:

```graphql
type BriefItem {
  id: ID!
  type: BriefItemType! # EMAIL_RECEIVED, EMAIL_SENT, DOC_RECEIVED, DOC_APPROVED, NOTE_ADDED, DEADLINE_SET
  title: String!
  subtitle: String
  metadata: String # "acum 2 ore", "ieri"
  caseId: ID
  caseName: String
  documentId: ID
  emailId: ID
  createdAt: DateTime!
}

query BriefFeed($limit: Int = 20) {
  briefFeed(limit: $limit) {
    items {
      ...BriefItemFields
    }
  }
}
```

**Backend Sources to Aggregate:**

- `Email` table (received/sent, recent)
- `Document` table (uploadedAt, approvedAt)
- `CaseNote` table (internal notes)
- `CaseDeadline` table (new deadlines)

### AI Context Integration

Tapping a BriefCard sets assistant context:

```tsx
// In BriefCard
const { setContext } = useAIAssistant();

const handleTap = () => {
  setContext({
    type: item.type,
    caseId: item.caseId,
    caseName: item.caseName,
    documentId: item.documentId,
  });
  // Navigate to detail or expand card
};
```

Quick actions are context-aware:

- **Sarcini**: Opens task list filtered by current case (if context set)
- **NotiÈ›e**: Opens note input pre-filled with case reference
- **Finalizat**: Shows completable items for current context

### Mobile Drawer Content

Adapted desktop navigation (not 1:1 copy):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ•                    [avatar]   â”‚
â”‚ Ion Popescu                     â”‚
â”‚ Asociat                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ ğŸ“Š  Tablou de Bord              â”‚
â”‚ âš–ï¸  Cazuri                       â”‚
â”‚ ğŸ“„  Documente                   â”‚
â”‚ âœ“   Sarcini                     â”‚
â”‚ ğŸ’¬  ComunicÄƒri                  â”‚
â”‚ â±   Pontaj                      â”‚
â”‚                                 â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ ğŸ“ˆ  AnalizÄƒ         (Partner)   â”‚
â”‚ ğŸ‘¥  Activitate      (Partner)   â”‚
â”‚                                 â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ âš™ï¸  SetÄƒri                       â”‚
â”‚ ğŸšª  Deconectare                 â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Implementation Phases

### Phase 1: Foundation (This Issue) - COMPLETED

- [x] Create `useIsMobile` hook
- [x] Create `MobileHome` shell component
- [x] Create `MobileHeader` with hamburger toggle
- [x] Create `MobileDrawer` with navigation
- [x] Wire up in `page.tsx` - conditional render

### Phase 2: Brief Feed - COMPLETED

- [x] Design `BriefItem` GraphQL type (`services/gateway/src/graphql/schema/brief.graphql`)
- [x] Implement `briefFeed` resolver (`services/gateway/src/graphql/resolvers/brief.resolvers.ts`)
- [x] Create `useBriefFeed` hook (`apps/web/src/hooks/useBriefFeed.ts`)
- [x] Create `BriefFeed` component (`apps/web/src/components/mobile/BriefFeed.tsx`)
- [x] Create `BriefCard` component (`apps/web/src/components/mobile/BriefCard.tsx`)

### Phase 3: Assistant Bar - COMPLETED

- [x] AssistantBar integrated in MobileHome (quick actions + chat input)
- [x] Implement quick action buttons (Sarcini, NotiÈ›e, Finalizat)
- [x] Create chat input with voice button placeholder
- [x] Wire navigation from BriefCard taps
- [x] Connect to assistant store for opening assistant

### Phase 4: Polish

- [ ] Touch gestures (swipe drawer)
- [ ] Pull-to-refresh on BriefFeed
- [ ] Animations/transitions
- [ ] Loading states
- [ ] Empty states

## Files to Create

```
apps/web/src/
â”œâ”€â”€ components/mobile/
â”‚   â”œâ”€â”€ MobileHome.tsx
â”‚   â”œâ”€â”€ MobileHeader.tsx
â”‚   â”œâ”€â”€ MobileDrawer.tsx
â”‚   â”œâ”€â”€ BriefFeed.tsx
â”‚   â”œâ”€â”€ BriefCard.tsx
â”‚   â”œâ”€â”€ AssistantBar.tsx
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useIsMobile.ts
â”‚   â””â”€â”€ useBriefFeed.ts
â””â”€â”€ app/page.tsx (modify)

services/gateway/src/
â”œâ”€â”€ resolvers/brief.resolver.ts (new)
â””â”€â”€ schema/brief.graphql (new)
```

## Testing

1. Chrome DevTools mobile viewport (390x844 iPhone 14)
2. Verify MobileHome renders < 768px
3. Verify desktop dashboard renders >= 768px
4. Test drawer open/close
5. Test BriefFeed scrolling
6. Test quick actions
7. Test AI chat input

## Dependencies

- Existing `useAssistant` hook
- Existing `AIAssistantContext`
- Existing Zustand navigation store

## Notes

- Desktop UI unchanged - mobile is a separate experience
- Can iterate on mobile independently
- Brief feed is new backend work but leverages existing tables
- AssistantBar reuses AI infrastructure, just different UI placement
