# OPS-049: Unified Chronology with Importance Scoring

**Status:** Implementing | **Priority:** P1-High | **Type:** Feature
**Created:** 2025-12-19 | **Depends on:** OPS-046 | **Parallel with:** OPS-047, OPS-048
**Sessions:** 1 | **Last Active:** 2025-12-19

## Summary

Create a unified timeline of all case events with importance-based scoring and filtering, exposed via paginated GraphQL query.

## Background

The Overview tab needs a chronology showing what actually happened on a case - not suggestions or predictions, but real events. Events come from multiple sources and need consistent importance scoring.

## Acceptance Criteria

- [x] `calculateImportance()` function implemented
- [x] `generateEventTitle()` produces Romanian titles
- [x] GraphQL query with cursor-based pagination
- [x] Filter by minimum importance level
- [x] Sync service populates events from existing data
- [ ] Events created automatically via OPS-047 hooks (depends on OPS-047)

## Implementation

### Files Created

1. **`services/gateway/src/services/case-event.service.ts`**
   - `calculateImportance()` - scoring logic for event types
   - `generateEventTitle()` - Romanian title generation
   - `getCaseEvents()` - paginated query with importance filtering
   - `createCaseEvent()` - create new event
   - `createEventFromSource()` - auto-generate title and importance
   - `syncCaseEvents()` - sync from existing data sources

2. **`services/gateway/src/graphql/schema/case-event.graphql`**
   - `CaseEventType` enum
   - `EventImportance` enum
   - `CaseEvent` type
   - `CaseEventConnection` with pagination
   - `caseEvents` query
   - `syncCaseEvents` mutation

3. **`services/gateway/src/graphql/resolvers/case-event.resolvers.ts`**
   - Query resolver for `caseEvents`
   - Mutation resolver for `syncCaseEvents`

### Importance Scoring

| Event Type        | Importance | Condition             |
| ----------------- | ---------- | --------------------- |
| EmailCourt        | HIGH       | Always                |
| DocumentSigned    | HIGH       | Always                |
| CaseStatusChanged | HIGH       | Always                |
| TaskCompleted     | HIGH       | If priority = Urgent  |
| EmailReceived     | MEDIUM     | If from client        |
| EmailSent         | MEDIUM     | Always                |
| DocumentUploaded  | MEDIUM     | Always                |
| NoteCreated       | MEDIUM     | Always                |
| TaskCompleted     | MEDIUM     | If priority != Urgent |
| TaskCreated       | MEDIUM     | If priority != Low    |
| TeamMemberAdded   | MEDIUM     | Always                |
| ContactAdded      | MEDIUM     | Always                |
| Other             | LOW        | Default               |

### GraphQL API

```graphql
query GetCaseEvents($caseId: ID!, $minImportance: EventImportance, $first: Int, $after: String) {
  caseEvents(caseId: $caseId, minImportance: $minImportance, first: $first, after: $after) {
    edges {
      node {
        id
        eventType
        title
        description
        importance
        occurredAt
        actor {
          id
          firstName
          lastName
          email
        }
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      endCursor
    }
    totalCount
  }
}

mutation SyncCaseEvents($caseId: ID!) {
  syncCaseEvents(caseId: $caseId) {
    created
    skipped
  }
}
```

## Local Verification Status

| Step           | Status     | Date | Notes                       |
| -------------- | ---------- | ---- | --------------------------- |
| Prod data test | ⬜ Pending |      | Need to test with real case |
| Preflight      | ⬜ Pending |      | Need to run                 |
| Docker test    | ⬜ Pending |      | Need to run                 |

**Verified**: No

## Session Log

- [2025-12-19] Session 1 started. Continuing from: Open
- [2025-12-19] Created case-event.service.ts with importance scoring and title generation
- [2025-12-19] Created case-event.graphql schema with pagination types
- [2025-12-19] Created case-event.resolvers.ts with paginated query
- [2025-12-19] Registered resolvers in GraphQL server (server.ts)
- [2025-12-19] TypeScript check passes for case-event files

## Files Modified

- `services/gateway/src/services/case-event.service.ts` (new)
- `services/gateway/src/graphql/schema/case-event.graphql` (new)
- `services/gateway/src/graphql/resolvers/case-event.resolvers.ts` (new)
- `services/gateway/src/graphql/server.ts` (added imports and resolvers)

## Next Steps

1. Run full preflight to verify build passes
2. Wait for OPS-047 to add event trigger hooks
3. Test with real case data via GraphQL playground
4. Frontend integration via OPS-050
