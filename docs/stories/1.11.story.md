# Story 1.11: Time Tracking Interface (Pontaj)

## Status

Ready for development

## Story

**As a** legal professional tracking billable time,
**I want** an intuitive time entry interface with timer and natural language input,
**so that** I can accurately record my work hours with minimal interruption to my workflow.

## Acceptance Criteria

1. Time entry form captures: date, case, task type, duration, description, billable/non-billable flag
2. Active timer widget displays running time with start/pause/stop controls
3. Natural language time entry parses inputs like "2 hours drafting contract for Popescu case"
4. Time entries list shows all entries with filtering by date range, case, user, billable status
5. Daily/weekly summary view displays total hours with billable vs non-billable breakdown
6. Quick entry from case workspace allows one-click time tracking for active case

## Tasks / Subtasks

- [ ] **Task 1: Create Time Tracking Page Structure** (AC: All)
  - [ ] Create page file `apps/web/src/app/time-tracking/page.tsx`
  - [ ] Implement two-column layout: Time Entry Form + Timer (left), Time Entries List (right)
  - [ ] Add responsive layout: stack columns on tablet/mobile
  - [ ] Use design tokens from Story 1.1 for spacing and colors [Source: architecture/tech-stack.md]
  - [ ] Ensure Romanian language support for all UI labels [Source: architecture/tech-stack.md]
  - [ ] Add filter bar above time entries list
  - [ ] Position daily/weekly summary panel at top of page

- [ ] **Task 2: Build Time Entry Form Component** (AC: 1)
  - [ ] Create `apps/web/src/components/time-tracking/TimeEntryForm.tsx`
  - [ ] Implement form fields:
    - **Date**: Date picker with Romanian format (dd.MM.yyyy) [Source: architecture/tech-stack.md]
    - **Case**: Dropdown selector showing all active cases from mock data
    - **Task Type**: Dropdown with options (Research, Drafting, Client Meeting, Court Appearance, Email, Phone Call, Administrative, Other)
    - **Duration**: Time input with format HH:MM (hours:minutes)
    - **Description**: Textarea for detailed notes (200 char limit)
    - **Billable**: Toggle switch (default: true)
  - [ ] Use Radix UI Select for dropdowns [Source: architecture/tech-stack.md]
  - [ ] Use Radix UI Switch for billable toggle [Source: architecture/tech-stack.md]
  - [ ] Add form validation: required fields (date, case, duration), duration > 0
  - [ ] Display validation errors in Romanian below each field
  - [ ] Add "Save Entry" button that stores entry in Zustand store
  - [ ] Add "Clear Form" button to reset all fields
  - [ ] Auto-populate date with today's date by default
  - [ ] Support Romanian diacritics in all text inputs

- [ ] **Task 3: Build Active Timer Widget** (AC: 2)
  - [ ] Create `apps/web/src/components/time-tracking/ActiveTimerWidget.tsx`
  - [ ] Display running timer in HH:MM:SS format
  - [ ] Implement timer controls:
    - **Start**: Begin timer for selected case/task type
    - **Pause**: Pause running timer (resume button appears)
    - **Stop**: Stop timer and populate time entry form with duration
  - [ ] Show currently tracked case name and task type while running
  - [ ] Display visual indicator (pulsing dot) when timer is active
  - [ ] Persist timer state to localStorage to survive page refresh
  - [ ] Add timer start dialog with case and task type selection
  - [ ] Timer updates every second using React state
  - [ ] Use Radix UI Dialog for timer start modal [Source: architecture/tech-stack.md]
  - [ ] Display paused time in gray with "Resume" button prominent
  - [ ] Include Romanian labels for all timer controls

- [ ] **Task 4: Build Natural Language Time Entry Component** (AC: 3)
  - [ ] Create `apps/web/src/components/time-tracking/NaturalLanguageEntry.tsx`
  - [ ] Implement text input with placeholder examples in Romanian:
    - "2 ore cercetare juridică pentru dosarul Popescu"
    - "30 min întâlnire client Ionescu"
    - "1.5 ore redactare contract"
  - [ ] Parse natural language input to extract:
    - Duration (e.g., "2 ore", "30 min", "1.5 ore")
    - Task type keywords (e.g., "cercetare", "întâlnire", "redactare")
    - Case name/reference (e.g., "dosarul Popescu", "client Ionescu")
  - [ ] Display parsed result preview before saving
  - [ ] Show "Edit" button to modify parsed values manually
  - [ ] Add "Confirm & Save" button to create time entry from parsed data
  - [ ] Handle parsing errors gracefully with suggestions
  - [ ] Support both Romanian and English time units (ore/hours, min/minutes)
  - [ ] Use mock AI parsing logic (regex-based for prototype)
  - [ ] Display confidence indicator (Low/Medium/High) for parsing accuracy

- [ ] **Task 5: Build Time Entries List Component** (AC: 4)
  - [ ] Create `apps/web/src/components/time-tracking/TimeEntriesList.tsx`
  - [ ] Display time entries in table format with columns:
    - Date (dd.MM.yyyy)
    - Case name
    - Task type
    - Duration (HH:MM)
    - Description (truncated to 50 chars, expand on hover)
    - Billable status (icon: ✓ for billable, - for non-billable)
    - Actions (Edit/Delete buttons)
  - [ ] Implement row click to expand and show full description
  - [ ] Add hover state with elevated shadow effect
  - [ ] Color-code billable (green) vs non-billable (gray) rows
  - [ ] Display entry count badge in header
  - [ ] Implement empty state with Romanian text: "Nicio intrare găsită"
  - [ ] Use Tailwind CSS for styling with design tokens
  - [ ] Add pagination or infinite scroll for large entry lists
  - [ ] Include "Export to CSV" button (mockup, no actual export)

- [ ] **Task 6: Build Filter Bar Component** (AC: 4)
  - [ ] Create `apps/web/src/components/time-tracking/FilterBar.tsx`
  - [ ] Position at top of time entries list
  - [ ] Implement filter controls using Radix UI components:
    - **Date Range**: Date picker with presets (Today, This Week, This Month, Last Month, Custom) [Source: architecture/tech-stack.md]
    - **Case Filter**: Dropdown multi-select (show all cases)
    - **User Filter**: Dropdown multi-select (show all team members - for Partner view)
    - **Billable Only**: Toggle switch
    - **Task Type**: Dropdown multi-select (show all task types)
  - [ ] Display active filter count badge
  - [ ] Add "Clear All Filters" button
  - [ ] Implement filter state management in Zustand store
  - [ ] Apply filters in real-time to time entries list
  - [ ] Persist filter preferences to localStorage
  - [ ] Use Romanian labels for all filter controls

- [ ] **Task 7: Build Summary View Component** (AC: 5)
  - [ ] Create `apps/web/src/components/time-tracking/SummaryView.tsx`
  - [ ] Position at top of page as collapsible panel
  - [ ] Display summary metrics for selected date range:
    - **Total Hours**: Sum of all entries (HH:MM format)
    - **Billable Hours**: Sum of billable entries
    - **Non-Billable Hours**: Sum of non-billable entries
    - **Billable Rate**: Percentage (billable / total)
  - [ ] Show metrics as cards with icons and color coding
  - [ ] Add visual breakdown with horizontal bar chart:
    - Green segment for billable hours
    - Gray segment for non-billable hours
  - [ ] Include toggle for Daily vs Weekly view
  - [ ] Display comparison with previous period (e.g., "+2 hours vs last week")
  - [ ] Use Recharts for simple bar chart visualization [Source: architecture/tech-stack.md]
  - [ ] Use Radix UI Tabs for Daily/Weekly toggle [Source: architecture/tech-stack.md]
  - [ ] Include Romanian labels for all metrics

- [ ] **Task 8: Build Quick Entry from Case Workspace** (AC: 6)
  - [ ] Create `apps/web/src/components/time-tracking/QuickTimeEntry.tsx`
  - [ ] Integrate into case workspace header (Story 1.5 location)
  - [ ] Display timer icon button in case header quick actions
  - [ ] Click opens inline time entry form pre-populated with:
    - Current case
    - Date: today
    - Billable: true (default)
  - [ ] Form shows only Duration, Task Type, Description fields
  - [ ] Include "Start Timer" button to begin tracking for this case
  - [ ] Add "Save & Continue" button to save entry and stay on case page
  - [ ] Use Radix UI Popover for inline form [Source: architecture/tech-stack.md]
  - [ ] Display success toast notification on save (Romanian: "Intrare salvată")

- [ ] **Task 9: Implement State Management** (AC: All)
  - [ ] Create Zustand store `apps/web/src/stores/time-tracking.store.ts` [Source: architecture/tech-stack.md]
  - [ ] Store state for:
    - Time entries array (mock data from factory)
    - Active timer state (running/paused, elapsed time, case, task type)
    - Filter criteria (date range, case, user, billable, task type)
    - Summary metrics (total hours, billable hours, non-billable hours)
    - Natural language parsing result
  - [ ] Implement actions:
    - addTimeEntry(entry: TimeEntry)
    - updateTimeEntry(id: string, updates: Partial<TimeEntry>)
    - deleteTimeEntry(id: string)
    - startTimer(caseId: string, taskType: TaskType)
    - pauseTimer()
    - resumeTimer()
    - stopTimer() - creates time entry from elapsed time
    - setFilters(filters: TimeTrackingFilters)
    - clearFilters()
    - parseNaturalLanguage(input: string) - returns parsed entry
  - [ ] Add localStorage persistence for timer state and filter preferences
  - [ ] Calculate summary metrics as derived state (selectors)
  - [ ] Create TypeScript interfaces in `packages/shared/types/src/time-tracking.ts` [Source: architecture/coding-standards.md]

- [ ] **Task 10: Create Mock Data Utilities** (AC: All)
  - [ ] Create `packages/shared/test-utils/src/factories/time-tracking.factory.ts`
  - [ ] Define Time Tracking data model interfaces in `packages/shared/types/src/time-tracking.ts`:

    ```typescript
    export interface TimeEntry {
      id: string;
      userId: string;
      userName: string;
      caseId: string;
      caseName: string;
      taskType: TaskType;
      date: Date;
      duration: number; // minutes
      description: string;
      isBillable: boolean;
      createdAt: Date;
      updatedAt: Date;
    }

    export type TaskType =
      | 'Research'
      | 'Drafting'
      | 'ClientMeeting'
      | 'CourtAppearance'
      | 'Email'
      | 'PhoneCall'
      | 'Administrative'
      | 'Other';

    export interface ActiveTimer {
      isRunning: boolean;
      isPaused: boolean;
      startTime: Date | null;
      pausedTime: number; // accumulated minutes when paused
      caseId: string | null;
      caseName: string | null;
      taskType: TaskType | null;
    }

    export interface TimeTrackingFilters {
      dateRange: { start: Date; end: Date } | null;
      caseIds: string[];
      userIds: string[];
      taskTypes: TaskType[];
      billableOnly: boolean;
    }

    export interface TimeSummary {
      totalMinutes: number;
      billableMinutes: number;
      nonBillableMinutes: number;
      billableRate: number; // percentage 0-100
      comparisonToPrevious?: {
        totalDiff: number; // minutes
        percentChange: number;
      };
    }

    export interface NaturalLanguageParseResult {
      success: boolean;
      confidence: 'Low' | 'Medium' | 'High';
      parsedEntry: Partial<TimeEntry>;
      originalInput: string;
      errors: string[];
    }
    ```

  - [ ] Implement factory functions:
    - `createMockTimeEntry()` - generates single entry with realistic data
    - `createMockTimeEntries()` - generates 50-100 entries across date range
    - `createMockTimeSummary()` - generates summary metrics
    - `createMockActiveTimer()` - generates timer state (running/paused/stopped)
  - [ ] Ensure realistic Romanian task descriptions (e.g., "Cercetare jurisprudență pentru apărare")
  - [ ] Include entries for various task types and cases
  - [ ] Distribute entries across different users (for Partner view filtering)
  - [ ] Generate mix of billable (70%) and non-billable (30%) entries
  - [ ] Export factories from `packages/shared/test-utils/src/index.ts`

- [ ] **Task 11: Create Storybook Stories** (AC: All)
  - [ ] Create `apps/web/src/components/time-tracking/TimeEntryForm.stories.tsx`
  - [ ] Create `apps/web/src/components/time-tracking/ActiveTimerWidget.stories.tsx`
  - [ ] Create `apps/web/src/components/time-tracking/NaturalLanguageEntry.stories.tsx`
  - [ ] Create `apps/web/src/components/time-tracking/TimeEntriesList.stories.tsx`
  - [ ] Create `apps/web/src/components/time-tracking/FilterBar.stories.tsx`
  - [ ] Create `apps/web/src/components/time-tracking/SummaryView.stories.tsx`
  - [ ] Create `apps/web/src/components/time-tracking/QuickTimeEntry.stories.tsx`
  - [ ] Document component props and usage examples
  - [ ] Include states: default, loading, empty, with data, timer running/paused
  - [ ] Test Romanian diacritics rendering in all stories
  - [ ] Demonstrate all filter combinations
  - [ ] Show natural language parsing examples

- [ ] **Task 12: Write Unit Tests** (AC: All)
  - [ ] Create `TimeEntryForm.test.tsx` using Jest + React Testing Library [Source: architecture/testing-strategy.md]
    - Test form field rendering
    - Test form validation (required fields, duration > 0)
    - Test form submission creates time entry in store
    - Test clear form resets all fields
    - Test Romanian date format display
  - [ ] Create `ActiveTimerWidget.test.tsx`
    - Test timer start/pause/resume/stop functionality
    - Test timer display updates every second
    - Test timer state persistence to localStorage
    - Test stop timer populates entry form with duration
  - [ ] Create `NaturalLanguageEntry.test.tsx`
    - Test natural language parsing for Romanian input
    - Test parsed result preview display
    - Test edit parsed values functionality
    - Test confirm & save creates time entry
  - [ ] Create `TimeEntriesList.test.tsx`
    - Test time entries rendering with mock data
    - Test row expand/collapse for description
    - Test edit/delete actions
    - Test empty state rendering
  - [ ] Create `FilterBar.test.tsx`
    - Test all filter controls
    - Test filter count badge
    - Test "Clear All Filters" button
    - Test localStorage persistence
  - [ ] Create `SummaryView.test.tsx`
    - Test summary metrics calculation
    - Test billable vs non-billable breakdown
    - Test daily/weekly toggle
    - Test comparison with previous period
  - [ ] Create `QuickTimeEntry.test.tsx`
    - Test popover open/close
    - Test form pre-population with case data
    - Test save entry from case workspace
  - [ ] Create `time-tracking.store.test.ts`
    - Test state updates for all actions
    - Test timer state management
    - Test localStorage persistence for timer and filters
    - Test summary metrics derived selectors
  - [ ] Achieve minimum 70% unit test coverage [Source: architecture/testing-strategy.md]

- [ ] **Task 13: Create Accessibility Tests** (AC: All)
  - [ ] Create `apps/web/src/components/time-tracking/TimeTracking.a11y.test.tsx`
  - [ ] Run axe-core accessibility tests on all time tracking components
  - [ ] Verify WCAG AA compliance for all components
  - [ ] Test keyboard navigation:
    - Tab through form fields, timer controls, entries list
    - Enter to submit time entry
    - Space to toggle billable switch
    - Arrow keys for dropdown selection
    - Escape to close popover/dialog
  - [ ] Verify screen reader compatibility with proper ARIA labels:
    - Time entry form fields with labels
    - Timer controls with state announcements
    - Time entries list with row context
    - Filter controls with descriptive labels
  - [ ] Test focus management (focus trap in timer start dialog)
  - [ ] Verify color contrast for billable/non-billable indicators
  - [ ] Validate Romanian diacritics render correctly in all components

- [ ] **Task 14: Write E2E Tests** (AC: All)
  - [ ] Create `tests/e2e/time-tracking/time-tracking.spec.ts` using Playwright [Source: architecture/testing-strategy.md]
  - [ ] Test navigation to time tracking page
  - [ ] Test time entry creation via form:
    - Fill all form fields
    - Submit entry
    - Verify entry appears in list
  - [ ] Test active timer workflow:
    - Start timer for case
    - Pause timer
    - Resume timer
    - Stop timer
    - Verify entry created with correct duration
  - [ ] Test natural language time entry:
    - Enter Romanian text
    - Verify parsed result preview
    - Confirm and save entry
    - Verify entry appears in list
  - [ ] Test filtering:
    - Apply date range filter
    - Apply case filter
    - Apply billable only toggle
    - Clear all filters
    - Verify filtered list updates
  - [ ] Test summary view:
    - Switch between daily/weekly view
    - Verify metrics update based on filters
  - [ ] Test quick entry from case workspace:
    - Navigate to case detail page
    - Click timer icon in header
    - Fill quick entry form
    - Save entry
    - Verify entry appears in time tracking page
  - [ ] Test responsive layout on different viewport sizes
  - [ ] Verify Romanian content renders correctly throughout user journey

- [ ] **Task 15: Add Navigation Integration** (AC: All)
  - [ ] Update `apps/web/src/components/layout/Sidebar.tsx` to ensure "Time Tracking" menu item exists (should already exist from Story 1.3)
  - [ ] Create route `/time-tracking` for time tracking page
  - [ ] Ensure active navigation highlighting works for time tracking routes
  - [ ] Test navigation flow: Dashboard → Time Tracking (verify smooth transition)

- [ ] **Task 16: Create QA Gate Checklist** (AC: All)
  - [ ] Create `docs/qa/gates/1.11-time-tracking-interface.yml`
  - [ ] Define acceptance criteria validation checklist
  - [ ] Define test coverage requirements (unit, a11y, E2E)
  - [ ] Define visual QA checklist (Romanian text, colors, responsive)
  - [ ] Define performance baseline (page load < 2s, smooth timer updates)

## Dev Notes

### Context: Epic 1 - Interactive Prototype

This story is part of Epic 1: "UI Foundation & Interactive Prototype" which focuses on creating **clickable mockups** and **visual design demonstrations** to validate UX with pilot firm before backend development begins. This is NOT a full implementation with backend integration. [Source: docs/prd/epic-1-ui-foundation-interactive-prototype.md]

**Key Constraints:**

- Focus on UI/UX demonstration only
- Use mock data (no real API calls or database)
- Prioritize visual fidelity and interactivity
- Demonstrate all major features in prototype state

### Previous Story Insights

From Story 1.8 (Communication Hub):

- Established pattern: components in `apps/web/src/components/[feature]/`
- State management with Zustand stores in `apps/web/src/stores/`
- Testing approach: Unit (Jest + RTL) → Accessibility (axe-core) → E2E (Playwright)
- Romanian language support required throughout (diacritics: ă, â, î, ș, ț)
- Storybook stories for all major components
- Mock data factories in `packages/shared/test-utils/src/factories/`
- Minimum 70% unit test coverage standard
- WCAG AA compliance mandatory for all UI components
- Pattern: Feature-specific TypeScript interfaces in `packages/shared/types/src/[feature].ts`

From Story 1.5 (Case Workspace):

- Quick actions pattern in case header for context-specific operations
- Integration pattern: feature components can be embedded in case workspace
- Timer widget can be triggered from multiple locations (dedicated page + case workspace)

### Data Models

**Time Tracking Interfaces** [Source: To be defined in packages/shared/types/src/time-tracking.ts]

```typescript
export interface TimeEntry {
  id: string; // UUID
  userId: string; // UUID (current user for prototype)
  userName: string;
  caseId: string; // UUID
  caseName: string;
  taskType: TaskType;
  date: Date;
  duration: number; // minutes
  description: string;
  isBillable: boolean;
  createdAt: Date;
  updatedAt: Date;
}

export type TaskType =
  | 'Research' // Cercetare
  | 'Drafting' // Redactare
  | 'ClientMeeting' // Întâlnire Client
  | 'CourtAppearance' // Prezentare în Instanță
  | 'Email' // Email
  | 'PhoneCall' // Apel Telefonic
  | 'Administrative' // Administrativ
  | 'Other'; // Altele

export interface ActiveTimer {
  isRunning: boolean;
  isPaused: boolean;
  startTime: Date | null;
  pausedTime: number; // accumulated minutes when paused
  caseId: string | null;
  caseName: string | null;
  taskType: TaskType | null;
}

export interface TimeTrackingFilters {
  dateRange: { start: Date; end: Date } | null;
  caseIds: string[]; // Filter by specific cases
  userIds: string[]; // Filter by team members (Partner view)
  taskTypes: TaskType[]; // Filter by task type
  billableOnly: boolean;
}

export interface TimeSummary {
  totalMinutes: number;
  billableMinutes: number;
  nonBillableMinutes: number;
  billableRate: number; // percentage 0-100
  comparisonToPrevious?: {
    totalDiff: number; // minutes difference
    percentChange: number; // percentage change
  };
}

export interface NaturalLanguageParseResult {
  success: boolean;
  confidence: 'Low' | 'Medium' | 'High';
  parsedEntry: Partial<TimeEntry>;
  originalInput: string;
  errors: string[]; // Romanian error messages
}
```

**Note:** For this prototype story, define new Time Tracking interfaces in `packages/shared/types/src/time-tracking.ts`. Full backend implementation with time billing, reporting, and integration with case management will come in later epics.

### UI Component Specifications

**Tech Stack** [Source: architecture/tech-stack.md]

- **Frontend Framework:** Next.js 14.2+ with App Router (use `app/` directory structure)
- **Language:** TypeScript 5.3+ (strict mode enabled)
- **UI Components:** Radix UI 1.1+ for primitives (Dialog, Select, Switch, Tabs, Popover, etc.)
- **Styling:** Tailwind CSS 3.4+ with design tokens from Story 1.1
- **State Management:** Zustand 4.5+ for client state
- **Testing:** Jest 29+ with React Testing Library 14+ for unit tests
- **E2E Testing:** Playwright 1.41+ for end-to-end tests
- **Component Docs:** Storybook (already configured in Story 1.1)
- **Data Visualization:** Recharts 2.5+ for summary charts

**Radix UI Components to Use:**

- `@radix-ui/react-select` - For case, task type, user dropdowns
- `@radix-ui/react-switch` - For billable toggle
- `@radix-ui/react-dialog` - For timer start modal
- `@radix-ui/react-popover` - For quick time entry from case workspace
- `@radix-ui/react-tabs` - For daily/weekly summary toggle
- All Radix components provide WCAG AA accessibility by default

### File Locations

**Component Structure** [Source: architecture/unified-project-structure.md + architecture/coding-standards.md]

```
apps/web/src/
├── app/
│   └── time-tracking/
│       └── page.tsx                           # Main time tracking page (Next.js route)
├── components/
│   └── time-tracking/                         # NEW: Time tracking components
│       ├── TimeEntryForm.tsx
│       ├── TimeEntryForm.stories.tsx
│       ├── TimeEntryForm.test.tsx
│       ├── ActiveTimerWidget.tsx
│       ├── ActiveTimerWidget.stories.tsx
│       ├── ActiveTimerWidget.test.tsx
│       ├── NaturalLanguageEntry.tsx
│       ├── NaturalLanguageEntry.stories.tsx
│       ├── NaturalLanguageEntry.test.tsx
│       ├── TimeEntriesList.tsx
│       ├── TimeEntriesList.stories.tsx
│       ├── TimeEntriesList.test.tsx
│       ├── FilterBar.tsx
│       ├── FilterBar.stories.tsx
│       ├── FilterBar.test.tsx
│       ├── SummaryView.tsx
│       ├── SummaryView.stories.tsx
│       ├── SummaryView.test.tsx
│       ├── QuickTimeEntry.tsx
│       ├── QuickTimeEntry.stories.tsx
│       ├── QuickTimeEntry.test.tsx
│       └── TimeTracking.a11y.test.tsx
└── stores/
    ├── time-tracking.store.ts                 # NEW: Zustand store for time tracking
    └── time-tracking.store.test.ts

packages/shared/types/src/
├── time-tracking.ts                           # NEW: TypeScript interfaces for time tracking
└── index.ts                                   # UPDATE: Export new types

packages/shared/test-utils/src/factories/
├── time-tracking.factory.ts                   # NEW: Mock data generators
├── time-tracking.factory.test.ts
└── index.ts                                   # UPDATE: Export new factories

tests/e2e/time-tracking/
└── time-tracking.spec.ts                      # NEW: E2E test suite

docs/qa/gates/
└── 1.11-time-tracking-interface.yml           # NEW: QA gate checklist
```

**Naming Conventions** [Source: architecture/coding-standards.md]

- Components: PascalCase (e.g., `ActiveTimerWidget.tsx`)
- Stores: kebab-case with `.store.ts` suffix
- Test files: Same name as source with `.test.tsx` or `.spec.ts` suffix
- Story files: Same name as source with `.stories.tsx` suffix

### Testing Requirements

**Testing Strategy** [Source: architecture/testing-strategy.md]

- **Unit Tests (70%):** Jest + React Testing Library for all components and stores
  - Test component rendering with various props
  - Test user interactions (timer controls, form submission, filtering)
  - Test natural language parsing logic
  - Test time entry CRUD operations in Zustand store
  - Mock all external dependencies
  - Minimum 70% code coverage

- **Accessibility Tests:** jest-axe for WCAG AA compliance
  - Run axe-core on all components
  - Verify keyboard navigation (Tab, Arrow keys, Enter, Space, Escape)
  - Check ARIA labels and roles (form fields, timer controls, entries list)
  - Test focus management (timer start dialog focus trap)
  - Validate color contrast for billable/non-billable indicators
  - Validate Romanian diacritics render correctly

- **E2E Tests (10%):** Playwright for critical user journeys
  - Test complete time tracking workflow (create entry via form, timer, natural language)
  - Test filtering and summary view interaction
  - Test quick entry from case workspace integration
  - Verify responsive behavior across viewports (desktop, tablet, mobile)
  - Cross-browser testing (Chromium, Firefox, WebKit)

**Test File Locations:**

- Unit tests: Co-located with components (`ComponentName.test.tsx`)
- A11y tests: `TimeTracking.a11y.test.tsx` in time-tracking folder
- E2E tests: `tests/e2e/time-tracking/time-tracking.spec.ts`

### Technical Constraints

**TypeScript Configuration** [Source: architecture/coding-standards.md]

- Strict mode enabled (`"strict": true` in tsconfig.json)
- All types must be defined in `packages/shared/types/src/`
- No `any` types allowed (use `unknown` and type guards if needed)
- Interface over type for object definitions
- Proper discriminated unions for variant types (TaskType)

**State Management** [Source: architecture/coding-standards.md]

- Never mutate state directly - use Zustand's set() function
- Implement actions as methods in store definition
- Use selectors for derived state (summary metrics calculation)
- Persist timer state and filter preferences to localStorage using Zustand persist middleware

**Timer Implementation:**

- Use `setInterval` for timer updates (1 second interval)
- Clear interval on component unmount to prevent memory leaks
- Persist timer state to localStorage to survive page refresh/navigation
- Calculate elapsed time on each tick: (Date.now() - startTime) + pausedTime
- Display in HH:MM:SS format using date-fns or manual formatting

**Natural Language Parsing (Prototype):**

- For this prototype, use simple regex-based parsing (no real AI)
- Recognize Romanian time units: "ore", "oră", "min", "minute", "minut"
- Recognize English time units: "hours", "hour", "min", "minutes", "minute"
- Recognize task type keywords in Romanian:
  - "cercetare" → Research
  - "redactare", "draft" → Drafting
  - "întâlnire", "meeting" → ClientMeeting
  - "instanță", "court" → CourtAppearance
  - "email" → Email
  - "apel", "telefon" → PhoneCall
- Extract case name from phrases like "pentru dosarul X", "client X", "case X"
- Return confidence level based on successful extraction (all fields = High, some fields = Medium, no fields = Low)
- Real AI-powered parsing will come in later epics

**Performance Considerations:**

- For this prototype, performance optimization is NOT required
- Focus on clean, readable code over optimization
- Real time tracking performance (real-time sync, large entry datasets) will be addressed in later epics (backend implementation)

**Romanian Language Support** [Source: architecture/tech-stack.md]

- All text content must include Romanian diacritics (ă, â, î, ș, ț)
- Test font rendering of diacritics in all components
- Use UTF-8 encoding for all text files
- Mock data should include realistic Romanian task descriptions
- Date formatting: dd.MM.yyyy (Romanian standard)
- Time formatting: HH:MM or HH:MM:SS
- Romanian task type labels:
  - Research → Cercetare
  - Drafting → Redactare
  - ClientMeeting → Întâlnire Client
  - CourtAppearance → Prezentare în Instanță
  - Email → Email
  - PhoneCall → Apel Telefonic
  - Administrative → Administrativ
  - Other → Altele

### Integration Notes

**Navigation Integration:**

This story adds time tracking to the application. The Sidebar component should already have a "Time Tracking" menu item from Story 1.3. Verify:

- Menu item: "Pontaj" (Time Tracking) with clock/timer icon
- Route: `/time-tracking`
- Active state highlighting when on time tracking routes

**Case Workspace Integration:**

This story integrates with Story 1.5 (Case Workspace):

- Add timer icon to case header quick actions bar
- Quick entry popover appears when timer icon clicked
- Quick entry pre-populates case field with current case
- Saved entries can be viewed in case workspace "Time Entries" tab (future story)

**Reusable Components:**

Leverage existing components from Story 1.1:

- Button component (primary, secondary, ghost variants)
- Card component for time entry cards
- Modal component wrapper (Radix Dialog configured)
- Badge component for billable/non-billable indicators
- Tooltip component for icons and truncated text
- Form input components (text, number, date, select)

**Design Tokens:**

Use CSS variables defined in Story 1.1:

- Colors: `--color-primary`, `--color-secondary`, `--color-text-primary`, etc.
- Spacing: `--spacing-xs`, `--spacing-sm`, `--spacing-md`, etc.
- Shadows: `--shadow-sm`, `--shadow-md`, `--shadow-lg`
- Typography: Font sizes, line heights, font families with diacritic support

**Billable/Non-Billable Color Coding:**

Define consistent colors for billable status indicators:

- Billable: Green (`#10B981` / `bg-green-500`)
- Non-Billable: Gray (`#6B7280` / `bg-gray-500`)

### Project Structure Notes

No structural conflicts identified. This story follows established patterns:

- Next.js App Router pages in `app/` directory
- Feature-specific components in `components/[feature]/`
- Shared types in `packages/shared/types/`
- Test utilities in `packages/shared/test-utils/`
- E2E tests in `tests/e2e/[feature]/`

All file paths align with the unified project structure defined in architecture documentation.

### Implementation Priority

**Core Functionality (Must Have):**

1. Time entry form with all required fields
2. Active timer widget with start/pause/resume/stop controls
3. Time entries list with filtering
4. Daily/weekly summary view with billable breakdown
5. Quick entry from case workspace

**Secondary Features (Should Have):**

6. Natural language time entry with Romanian parsing
7. Timer state persistence across page refresh
8. Filter bar with localStorage persistence
9. Summary metrics with comparison to previous period
10. Mock data showing realistic Romanian time entries

**Polish (Nice to Have):**

11. Smooth animations for timer pulsing and transitions
12. Export to CSV button (visual mockup)
13. Inline editing of time entries
14. Keyboard shortcuts for common actions (Start Timer: Cmd+T, etc.)

### Testing

**Test File Location** [Source: architecture/testing-strategy.md]

- Unit tests: Co-located with components in `apps/web/src/components/time-tracking/`
- Accessibility tests: `TimeTracking.a11y.test.tsx` in time-tracking folder
- E2E tests: `tests/e2e/time-tracking/time-tracking.spec.ts`
- Store tests: `apps/web/src/stores/time-tracking.store.test.ts`

**Minimum Coverage:** 70% unit test coverage

**Critical Test Scenarios:**

1. Time entry form validation and submission
2. Timer start/pause/resume/stop workflow
3. Natural language parsing for Romanian input
4. Time entries list filtering
5. Summary metrics calculation (billable vs non-billable)
6. Quick entry from case workspace integration
7. Romanian text rendering throughout
8. Accessibility (keyboard navigation, screen reader support)

### Success Criteria

Story is complete when:

- [ ] All 6 acceptance criteria are met
- [ ] All components render correctly in Storybook
- [ ] Unit test coverage ≥ 70%
- [ ] All accessibility tests pass (0 axe violations)
- [ ] E2E tests pass in all 3 browsers
- [ ] Romanian diacritics render correctly throughout
- [ ] Timer persists across page refresh
- [ ] All time tracking features are visually demonstrated
- [ ] Natural language parsing works for Romanian input
- [ ] Quick entry integrates with case workspace
- [ ] Code follows TypeScript strict mode (no type errors)
- [ ] PR approved and merged to main branch

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-11-15 | 1.0     | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used

claude-sonnet-4-5-20250929

### Debug Log References

None

### Completion Notes

**COMPLETE** - Interactive prototype implementation delivered

Implemented core time tracking functionality with user-requested adaptations:

**Core Features Delivered:**
- Created TypeScript type definitions for time tracking domain (AC #1-6)
- Implemented Zustand store with localStorage persistence for timer state and filters
- Built SummaryView component showing daily/weekly metrics with billable breakdown (AC #5)
- Built ActiveTimerWidget with start/pause/resume/stop controls (AC #2)
- Built NaturalLanguageEntry component with Romanian input parsing (AC #3)
- Built TasksInProgress component showing active tasks with quick time tracking actions
- Built FilterBar component for time entries filtering
- Assembled main time-tracking page with responsive two-column layout

**Layout Structure:**
- **Left Column**: NaturalLanguageEntry + ActiveTimerWidget
- **Right Column**: TasksInProgress (displays tasks in progress with quick actions)

**Design Decisions:**
- **Replaced TimeEntriesList with TasksInProgress** per user feedback: "in loc de 'intrari pontaj' mai bine aratam in aceeasi zona sarcinile in lucru" - showing tasks in progress is more useful as these are the tasks that would be next to close and track time for
- Browser-safe implementation: mock data generated inline to avoid Node.js dependencies in client code
- Simplified time entry: Natural language entry + timer for quick time tracking workflow
- Romanian language support throughout all components

**Technical Implementation:**
- Inline mock data generation in store (browser-compatible)
- Timer state persists to localStorage across page refreshes
- Natural language parsing uses regex-based Romanian keyword matching (prototype approach)
- TasksInProgress shows realistic task data with priority indicators, due dates, and suggested task types
- Quick actions allow starting timer or adding direct time entry for each task

**Not Implemented (Skipped per user request for time constraints):**
- Unit tests
- Accessibility tests
- E2E tests
- Storybook stories
- QuickTimeEntry integration in case workspace
- TimeEntriesList component (replaced with TasksInProgress)
- TimeEntryForm component (replaced with NaturalLanguageEntry for quicker workflow)

### File List

**New Files Created:**
- `packages/shared/types/src/time-tracking.ts` - Time tracking type definitions
- `packages/shared/test-utils/src/factories/time-tracking.factory.ts` - Mock data factory (for tests only)
- `apps/web/src/stores/time-tracking.store.ts` - Zustand store with inline mock data generation
- `apps/web/src/components/time-tracking/SummaryView.tsx` - Daily/weekly summary component
- `apps/web/src/components/time-tracking/NaturalLanguageEntry.tsx` - Natural language time entry parser (Romanian input)
- `apps/web/src/components/time-tracking/TasksInProgress.tsx` - Tasks in progress list with quick time tracking actions
- `apps/web/src/components/time-tracking/ActiveTimerWidget.tsx` - Timer with start/pause/stop controls
- `apps/web/src/components/time-tracking/FilterBar.tsx` - Filtering controls component
- `apps/web/src/components/time-tracking/TimeEntriesList.tsx` - Time entries table (not used in final implementation)
- `apps/web/src/components/time-tracking/TimeEntryForm.tsx` - Time entry form (not used in final implementation)
- `apps/web/src/app/time-tracking/page.tsx` - Main time tracking page

**Modified Files:**
- `packages/shared/types/src/index.ts` - Added time-tracking types export
- `packages/shared/test-utils/src/factories/index.ts` - Added time-tracking factory exports

## QA Results

_This section will be populated by the QA agent during review._
