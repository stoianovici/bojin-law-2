# Story 1.5: Case Workspace Prototype

## Status

Approved

## Story

**As a** lawyer working on a case,
**I want** to see all case information in one unified workspace,
**so that** I can efficiently manage all aspects of a legal matter.

## Acceptance Criteria

1. Case header shows: case name, client, status, assigned team, next deadline
2. Tab navigation for: Overview, Documents, Tasks, Communications, Time Entries, Notes
3. Documents tab demonstrates folder tree, document list with version badges, preview pane
4. Tasks tab shows kanban board with task cards containing assignee, due date, status
5. AI insights panel (collapsible) shows mockup suggestions relevant to case context
6. Quick actions bar enables natural language input (visual only, no processing)

## Tasks / Subtasks

- [x] **Task 1: Create Case Workspace Type Definitions** (AC: All)
  - [x] Create `packages/shared/types/src/case.ts` with Case interface from data models [Source: architecture/data-models.md, architecture/unified-project-structure.md]
    - Export Case type with fields: id, caseNumber, title, clientId, status, type, description, openedDate, closedDate, value, metadata
    - Export CaseStatus type: 'Active' | 'OnHold' | 'Closed' | 'Archived'
    - Export CaseType: 'Litigation' | 'Contract' | 'Advisory' | 'Criminal' | 'Other'
    - Add CaseTeamMember interface with userId, role, assignedDate
  - [x] Create `packages/shared/types/src/workspace.ts` for workspace-specific types
    - Export WorkspaceTab type: 'overview' | 'documents' | 'tasks' | 'communications' | 'time-entries' | 'notes'
    - Export DocumentNode interface for folder tree: id, name, type ('folder' | 'file'), children?, documentId?
    - Export TaskColumn type: 'todo' | 'in-progress' | 'review' | 'complete'
  - [x] Update `packages/shared/types/src/document.ts` if not already created [Source: architecture/data-models.md]
    - Export Document interface: id, caseId, title, type, currentVersion, status, blobStorageUrl, aiGenerated, createdBy, createdAt, updatedAt
    - Export DocumentStatus: 'Draft' | 'Review' | 'Approved' | 'Filed'
    - Export DocumentType: 'Contract' | 'Motion' | 'Letter' | 'Memo' | 'Pleading' | 'Other'
    - Export DocumentVersion interface: id, documentId, versionNumber, changesSummary, createdAt, createdBy
  - [x] Export all new types from `packages/shared/types/src/index.ts`

- [x] **Task 2: Create Case Workspace State Management Store** (AC: All)
  - [x] Create `apps/web/src/stores/case-workspace.store.ts` using Zustand [Source: architecture/tech-stack.md]
  - [x] Define CaseWorkspaceState interface with:
    - `activeTab: WorkspaceTab` - currently selected tab
    - `aiPanelCollapsed: boolean` - AI insights panel visibility
    - `quickActionsVisible: boolean` - quick actions bar visibility
    - `selectedCaseId: string | null` - current case being viewed
  - [x] Implement actions:
    - `setActiveTab(tab: WorkspaceTab)` - switch between tabs
    - `toggleAIPanel()` - show/hide AI insights
    - `toggleQuickActions()` - show/hide quick actions bar
    - `setSelectedCase(caseId: string)` - set active case
  - [x] Use Zustand persist middleware to save state to localStorage with key: "case-workspace-state"
  - [x] Export store with proper TypeScript types

- [x] **Task 3: Build Case Header Component** (AC: 1)
  - [ ] Create `apps/web/src/components/case/CaseHeader.tsx`
  - [ ] Display case information:
    - Case number badge (e.g., "CASE-2024-001") with blue background
    - Case title as h1 heading with proper Romanian diacritic support [Source: docs/stories/1.1.story.md]
    - Client name with person icon
    - Status badge with color coding: Active (green), OnHold (yellow), Closed (gray), Archived (slate)
    - Case type label (Litigation, Contract, etc.)
  - [ ] Show assigned team members section:
    - Display team member avatars with initials (max 5 visible, "+N more" indicator if > 5)
    - Tooltip on hover showing full name and role
    - Use Radix UI Avatar primitive [Source: architecture/tech-stack.md]
  - [ ] Display next deadline indicator:
    - Show "Next Deadline: [Date] - [Description]" with calendar icon
    - Color code by urgency: red if < 3 days, yellow if < 7 days, blue otherwise
    - Use date-fns for date formatting [Source: architecture/tech-stack.md]
  - [ ] Add action buttons in header:
    - "Edit Case" button (secondary style from Story 1.1)
    - "Add Team Member" button with plus icon
    - "More Options" three-dot menu (dropdown with Radix UI DropdownMenu)
  - [ ] Style with Tailwind CSS: shadow-sm border-b border-gray-200 p-6 bg-white
  - [ ] Make responsive: stack vertically on mobile, horizontal layout on desktop

- [x] **Task 4: Create Tab Navigation Component** (AC: 2)
  - [ ] Create `apps/web/src/components/case/WorkspaceTabs.tsx` using Radix UI Tabs [Source: architecture/tech-stack.md]
  - [ ] Implement tab list with 6 tabs: Overview, Documents, Tasks, Communications, Time Entries, Notes
  - [ ] Each tab shows icon + label
    - Overview: layout-dashboard icon
    - Documents: file-text icon
    - Tasks: check-square icon
    - Communications: mail icon
    - Time Entries: clock icon
    - Notes: sticky-note icon
  - [ ] Integrate with case-workspace.store.ts:
    - Read activeTab from store
    - Call setActiveTab(tab) on tab click
  - [ ] Style tabs:
    - Inactive tabs: text-gray-600 border-b-2 border-transparent
    - Active tab: text-blue-600 border-b-2 border-blue-600 font-medium
    - Hover state: text-gray-900 bg-gray-50
  - [ ] Make responsive: horizontal scrolling on mobile if tabs overflow
  - [ ] Add keyboard navigation support (arrow keys to switch tabs)

- [ ] **Task 5: Build Documents Tab with Folder Tree and Preview** (AC: 3)
  - [ ] Create `apps/web/src/components/case/tabs/DocumentsTab.tsx`
  - [ ] Implement three-column layout:
    - Left column (25%): Folder tree navigation
    - Middle column (40%): Document list with filters
    - Right column (35%): Document preview pane
  - [ ] Create `apps/web/src/components/case/DocumentFolderTree.tsx`:
    - Display hierarchical folder structure (mock folders: "Contracts", "Motions", "Correspondence", "Research")
    - Use recursive component for nested folders
    - Show folder icon (folder-closed when collapsed, folder-open when expanded)
    - Show document icon (file-text) for files
    - Expand/collapse folders on click
    - Highlight selected folder or document
  - [ ] Create `apps/web/src/components/case/DocumentList.tsx`:
    - Display documents in table format: Name, Type, Version, Status, Modified Date, Modified By
    - Show version badge (e.g., "v3") next to document name
    - Add status badge with colors matching DocumentStatus
    - Include search bar at top for filtering documents by name
    - Add "New Document" button with plus icon
    - Show document count: "Showing X of Y documents"
    - Make rows clickable to select document for preview
  - [ ] Create `apps/web/src/components/case/DocumentPreview.tsx`:
    - Show document title and metadata in header
    - Display preview message: "Document preview will be shown here" (no actual content rendering needed for prototype)
    - Show action buttons: "Open", "Download", "View History"
    - Include version history section at bottom:
      - List last 3-5 versions with version number, date, author, changes summary
      - "View All Versions" link
  - [ ] Style three-column layout with proper spacing and borders
  - [ ] Make responsive: stack columns vertically on tablet/mobile

- [ ] **Task 6: Build Tasks Tab with Kanban Board** (AC: 4)
  - [ ] Create `apps/web/src/components/case/tabs/TasksTab.tsx`
  - [ ] Implement kanban board with 4 columns: To Do, In Progress, Review, Complete
  - [ ] Create `apps/web/src/components/case/TaskKanbanBoard.tsx`:
    - Use CSS Grid for 4-column layout (grid-cols-4 gap-4)
    - Each column has header with title and task count badge
    - Column headers color-coded: To Do (gray), In Progress (blue), Review (yellow), Complete (green)
  - [ ] Create `apps/web/src/components/case/TaskCard.tsx`:
    - Display task title, description (truncated to 2 lines)
    - Show assignee avatar with initials
    - Display due date with calendar icon, color-coded by urgency
    - Show priority badge (High/Medium/Low) with appropriate colors
    - Add hover state with elevated shadow
    - Include "..." menu button for task actions
  - [ ] Add mock drag-and-drop visual indicators:
    - Show dotted border on hover to indicate draggable
    - Display "Drag to move" tooltip
    - Note in component: "Actual drag-and-drop will be implemented in backend stories"
  - [ ] Add "Add Task" button at top of each column
  - [ ] Include board view controls:
    - Filter dropdown: "All Tasks", "My Tasks", "High Priority"
    - Sort dropdown: "Due Date", "Priority", "Recently Updated"
    - View toggle: "Board View" (active) | "List View" (for future)

- [ ] **Task 7: Create Overview Tab** (AC: 1, 2)
  - [ ] Create `apps/web/src/components/case/tabs/OverviewTab.tsx`
  - [ ] Display case overview in grid layout:
    - Case Details card: Description, Opened Date, Case Value, Case Type
    - Team Members card: List of all team members with roles and contact info
    - Recent Activity card: Timeline of last 10 activities (document updates, task completions, etc.)
    - Key Deadlines card: List of upcoming deadlines sorted by date
    - Quick Stats card: Total documents, open tasks, billable hours this month
  - [ ] Use Card component from Story 1.1 for each section [Source: docs/stories/1.1.story.md]
  - [ ] Style with 2-column grid on desktop, single column on mobile
  - [ ] Add "Edit Details" button in Case Details card

- [ ] **Task 8: Create Placeholder Tabs for Communications, Time Entries, and Notes** (AC: 2)
  - [ ] Create `apps/web/src/components/case/tabs/CommunicationsTab.tsx`
    - Display placeholder message: "Communications view - Email threads and messages will appear here"
    - Show mockup layout: thread list on left, message view on right
    - Add "Compose Email" button
  - [ ] Create `apps/web/src/components/case/tabs/TimeEntriesTab.tsx`
    - Display placeholder message: "Time tracking entries for this case will appear here"
    - Show mockup table with columns: Date, User, Activity, Hours, Billable, Notes
    - Add "New Time Entry" button
  - [ ] Create `apps/web/src/components/case/tabs/NotesTab.tsx`
    - Display placeholder message: "Case notes and annotations will appear here"
    - Show mockup: notes list with preview cards
    - Add "New Note" button with plus icon
  - [ ] Style placeholder tabs consistently with working tabs
  - [ ] Ensure Romanian language support in placeholder text

- [ ] **Task 9: Build AI Insights Collapsible Panel** (AC: 5)
  - [ ] Create `apps/web/src/components/case/AIInsightsPanel.tsx`
  - [ ] Implement collapsible panel on right side of workspace:
    - Width: 300px when expanded, 48px when collapsed
    - Smooth transition animation using Tailwind transitions (transition-all duration-300)
    - Toggle button with chevron icon (left when expanded, right when collapsed)
  - [ ] Panel header when expanded:
    - Title: "AI Insights" with sparkles icon
    - Subtitle: "Suggestions for [Case Name]"
    - Close button to collapse panel
  - [ ] Display 4-6 mock AI suggestions with variety:
    - "Consider filing motion before [date] based on similar case precedents"
    - "Document [name] has similar clauses to [template] - review for consistency"
    - "Task [name] is 2 days overdue - reassign or update deadline?"
    - "3 related cases found with similar facts - view research memo"
    - "Upcoming deadline in 5 days - 2 tasks still in To Do column"
    - "Client has not been updated in 14 days - consider status email"
  - [ ] Each suggestion item includes:
    - Icon indicating suggestion type (document, deadline, task, precedent)
    - Suggestion text with key terms highlighted
    - Timestamp: "2 hours ago", "Yesterday", etc.
    - Action link: "View Details" or "Take Action"
    - Dismiss button (X icon)
  - [ ] Integrate with case-workspace.store.ts:
    - Read aiPanelCollapsed state
    - Call toggleAIPanel() on collapse/expand
  - [ ] Style with accent border (border-l-4 border-purple-500)
  - [ ] Add empty state: "No suggestions available - AI is analyzing your case"

- [ ] **Task 10: Create Quick Actions Bar with Natural Language Input** (AC: 6)
  - [ ] Create `apps/web/src/components/case/QuickActionsBar.tsx`
  - [ ] Position at bottom of workspace (fixed positioning, bottom-0, z-50)
  - [ ] Implement input interface:
    - Large text input with placeholder: "What would you like to do? (e.g., 'Create task for document review by Friday')"
    - Input spans full width with padding for icons
    - Show sparkles icon on left to indicate AI capability
    - Add microphone icon on right for voice input (visual only)
    - Submit button on far right with arrow icon
  - [ ] Add example suggestions below input (when empty):
    - "Add document", "Create task", "Schedule deadline", "Email client", "Log time entry"
    - Clicking suggestion populates input field
  - [ ] Show visual feedback on input:
    - Border color changes to blue on focus
    - Show character count: "0/500" in bottom right
    - Disable submit button if input empty
  - [ ] Add note banner: "Natural language processing - visual prototype only, no actual processing"
  - [ ] Integrate with case-workspace.store.ts:
    - Read quickActionsVisible state
    - Add toggle button to show/hide bar
  - [ ] Style with shadow-lg bg-white border-t border-gray-200
  - [ ] Make responsive: reduce padding and font size on mobile

- [ ] **Task 11: Build Main Case Workspace Page Component** (AC: All)
  - [ ] Create `apps/web/src/app/cases/[caseId]/page.tsx` (Next.js dynamic route)
  - [ ] Compose full workspace layout:
    - CaseHeader at top
    - WorkspaceTabs below header
    - Tab content area (render active tab component based on activeTab state)
    - AIInsightsPanel on right side (overlays content when expanded)
    - QuickActionsBar at bottom
  - [ ] Set up layout structure:
    - Use flexbox for vertical stacking
    - Fixed header and tabs (sticky positioning)
    - Scrollable content area for tab content
    - Fixed positioning for AI panel and quick actions bar
  - [ ] Integrate with case-workspace.store.ts:
    - Initialize workspace state on mount
    - Pass caseId to setSelectedCase action
  - [ ] Load mock case data on mount (from factory to be created in Task 12)
  - [ ] Add loading state with skeleton components while "loading" case data
  - [ ] Add error boundary for handling component errors
  - [ ] Set page title: "Case [CaseNumber] - [CaseTitle]"
  - [ ] Wrap in MainLayout from Story 1.3 for consistent navigation [Source: docs/stories/1.3.story.md]

- [ ] **Task 12: Create Mock Data Factories for Case Workspace** (AC: All)
  - [ ] Create `packages/shared/test-utils/src/factories/case.factory.ts`
  - [ ] Implement factory functions using @faker-js/faker:
    - `createMockCase()`: Generate Case with all required fields from data model [Source: architecture/data-models.md]
      - Use Romanian names for clients where appropriate
      - Generate realistic case numbers: "CASE-2024-XXX"
      - Create case descriptions in Romanian with proper diacritics
    - `createMockCaseTeamMember()`: Generate team member with userId, role, avatar
    - `createMockDocumentTree()`: Generate hierarchical folder structure with 3-4 levels
    - `createMockDocument()`: Generate Document with versions, realistic Romanian titles
    - `createMockDocumentVersion()`: Generate version with changes summary
    - `createMockAISuggestion()`: Generate contextual AI suggestion for case
  - [ ] Extend existing `createMockTask()` factory from Story 1.4 to support case context
  - [ ] Create helper function `createMockCaseWorkspace()` that returns complete mock data structure:
    - Returns object with: case, documents, tasks, teamMembers, aiSuggestions, recentActivity
    - **Data volumes for realistic testing:**
      - 3-5 team members per case
      - 12-18 documents per case with 2-4 versions each
      - 10-15 tasks distributed across kanban columns
      - 4-6 AI suggestions
      - 8-12 recent activity items
  - [ ] Export all factories from `packages/shared/test-utils/src/index.ts`
  - [ ] Ensure all text fields support Romanian diacritics (ă, â, î, ș, ț)

- [ ] **Task 13: Create Storybook Stories for All Case Workspace Components** (AC: All)
  - [ ] **Note:** Create stories iteratively alongside component implementation from Tasks 3-10 for better workflow
  - [ ] Create component stories:
    - `CaseHeader.stories.tsx`: variants for different case statuses and team sizes
    - `WorkspaceTabs.stories.tsx`: show all tabs, active states
    - `DocumentsTab.stories.tsx`: with mock folder tree, documents, preview
    - `DocumentFolderTree.stories.tsx`: expanded/collapsed states
    - `DocumentList.stories.tsx`: with filters, sorting, empty state
    - `DocumentPreview.stories.tsx`: with/without versions
    - `TasksTab.stories.tsx`: kanban board with tasks in all columns
    - `TaskKanbanBoard.stories.tsx`: different board states
    - `TaskCard.stories.tsx`: variants for priority, urgency, assignee states
    - `OverviewTab.stories.tsx`: complete overview with all cards
    - `CommunicationsTab.stories.tsx`: placeholder layout
    - `TimeEntriesTab.stories.tsx`: placeholder layout
    - `NotesTab.stories.tsx`: placeholder layout
    - `AIInsightsPanel.stories.tsx`: expanded/collapsed, with/without suggestions
    - `QuickActionsBar.stories.tsx`: empty, with input, with suggestions
  - [ ] Create page story: `CaseWorkspacePage.stories.tsx`
    - Story variants: "Default State", "With Active Documents Tab", "With Active Tasks Tab", "AI Panel Collapsed"
  - [ ] Use mock data from factories for all stories
  - [ ] Include Romanian text examples in all stories [Source: docs/stories/1.1.story.md]
  - [ ] Document interactive features in story descriptions
  - [ ] Add accessibility notes for each component

- [ ] **Task 14: Unit and Integration Testing** (AC: All)
  - [ ] Create unit tests for case-workspace store: `apps/web/src/stores/case-workspace.store.test.ts`
    - Test setActiveTab action switches tabs correctly
    - Test toggleAIPanel toggles panel visibility
    - Test toggleQuickActions toggles bar visibility
    - Test setSelectedCase updates selected case ID
    - Test localStorage persistence
  - [ ] Create component tests (using Jest + React Testing Library) [Source: architecture/testing-strategy.md]:
    - `CaseHeader.test.tsx`: renders case info, team members, deadline correctly
    - `WorkspaceTabs.test.tsx`: tab switching updates active state
    - `DocumentFolderTree.test.tsx`: folder expand/collapse behavior
    - `DocumentList.test.tsx`: filtering and sorting work correctly
    - `TaskKanbanBoard.test.tsx`: renders columns and tasks
    - `AIInsightsPanel.test.tsx`: collapse/expand animation works
    - `QuickActionsBar.test.tsx`: input validation and suggestion clicks
  - [ ] Create integration test: `apps/web/src/components/case/CaseWorkspaceIntegration.test.tsx`
    - Test tab switching updates content area
    - Test AI panel collapse/expand doesn't affect tab content
    - Test quick actions bar visibility toggle
    - Test mock data loads correctly on mount
  - [ ] Ensure all tests follow testing standards [Source: architecture/testing-strategy.md]:
    - Unit tests: 70% of testing effort
    - Integration tests: 20% of testing effort
    - Test files located next to component files with `.test.tsx` extension
  - [ ] Target code coverage: 80% minimum [Source: docs/stories/1.2.story.md]

- [ ] **Task 15: E2E Test for Case Workspace Navigation Flow** (AC: All)
  - [ ] Create `tests/e2e/case-workspace.spec.ts` using Playwright [Source: architecture/tech-stack.md]
  - [ ] Test complete workflow:
    - Navigate to case workspace page
    - Verify case header displays correct information
    - Click through all 6 tabs and verify content changes
    - Verify Documents tab shows folder tree, document list, and preview pane
    - Verify Tasks tab shows kanban board with 4 columns
    - Expand and collapse AI Insights panel
    - Type in quick actions bar and verify suggestions appear
    - Test responsive behavior on mobile viewport
  - [ ] Add accessibility testing with axe-core [Source: docs/stories/1.2.story.md]
  - [ ] Verify keyboard navigation works for tabs
  - [ ] Test Romanian diacritic rendering in all text elements
  - [ ] Run test in CI pipeline

- [ ] **Task 16: Update Navigation to Include Cases Link** (AC: All)
  - [ ] Update `apps/web/src/components/navigation/Sidebar.tsx` from Story 1.3 [Source: docs/stories/1.3.story.md]
  - [ ] Verify "Cases" navigation item exists and links to cases list page
  - [ ] Add route: `/cases/[caseId]` for individual case workspace
  - [ ] Ensure navigation highlights "Cases" section when viewing case workspace
  - [ ] Test role-based navigation still works with new case routes

## Dev Notes

### Previous Story Insights

[Source: docs/stories/1.4.story.md]

- Dashboard story established patterns for widget-based layouts and state management
- Zustand with persist middleware works well for saving user preferences to localStorage
- Mock data factories using @faker-js/faker provide realistic Romanian text with diacritics
- Storybook stories should include multiple variants (default, loading, empty state, with data)
- React Testing Library preferred for component tests
- Some component tests may be blocked by environment issues - E2E tests provide functional coverage as mitigation
- Integration tests verify cross-component interactions effectively

### Data Models

[Source: architecture/data-models.md]

**Case Interface:**

```typescript
export interface Case {
  id: string;
  caseNumber: string;
  title: string;
  clientId: string;
  status: 'Active' | 'OnHold' | 'Closed' | 'Archived';
  type: 'Litigation' | 'Contract' | 'Advisory' | 'Criminal' | 'Other';
  description: string;
  openedDate: Date;
  closedDate?: Date;
  value?: number;
  metadata?: Record<string, any>;
  // Relations
  teamMembers?: User[];
  client?: Client;
  documents?: Document[];
  tasks?: Task[];
}
```

**Document Interface:**

```typescript
export interface Document {
  id: string;
  caseId: string;
  title: string;
  type: 'Contract' | 'Motion' | 'Letter' | 'Memo' | 'Pleading' | 'Other';
  currentVersion: number;
  status: 'Draft' | 'Review' | 'Approved' | 'Filed';
  oneDriveId?: string;
  blobStorageUrl: string;
  aiGenerated: boolean;
  templateId?: string;
  createdBy: string;
  createdAt: Date;
  updatedAt: Date;
  versions?: DocumentVersion[];
}

export interface DocumentVersion {
  id: string;
  documentId: string;
  versionNumber: number;
  content: string;
  semanticChanges?: SemanticChange[];
  createdBy: string;
  createdAt: Date;
  changesSummary: string;
  riskLevel: 'Low' | 'Medium' | 'High';
}
```

**User Interface:**

```typescript
export interface User {
  id: string;
  email: string;
  firstName: string;
  lastName: string;
  role: 'Partner' | 'Associate' | 'Paralegal';
  firmId: string;
  azureAdId: string;
  preferences: UserPreferences;
  createdAt: Date;
  lastActive: Date;
}
```

### Component Architecture

[Source: architecture/unified-project-structure.md]

**Project Structure:**

```plaintext
apps/web/src/
  ├── components/
  │   └── case/                    # Case workspace components
  │       └── tabs/                # Tab-specific components
  ├── stores/                      # Zustand stores
  └── app/
      └── cases/
          └── [caseId]/            # Dynamic case route
packages/shared/
  ├── types/src/                   # Shared TypeScript types
  └── test-utils/src/factories/    # Mock data factories
tests/e2e/                         # E2E test specs
```

**File Locations for New Components:**

- Case workspace components: `apps/web/src/components/case/`
- Tab components: `apps/web/src/components/case/tabs/`
- Shared types: `packages/shared/types/src/`
- Mock factories: `packages/shared/test-utils/src/factories/`
- Page route: `apps/web/src/app/cases/[caseId]/page.tsx`
- Store: `apps/web/src/stores/case-workspace.store.ts`

### Tech Stack Requirements

[Source: architecture/tech-stack.md]

- **UI Components:** Radix UI Tabs primitive for tab navigation
- **State Management:** Zustand 4.5+ with persist middleware for localStorage
- **Styling:** Tailwind CSS 3.4+ utility classes
- **Date Handling:** date-fns 3.0+ for date formatting and comparison
- **Icons:** Use consistent icon library from Story 1.1
- **Testing:** Jest 29+ and React Testing Library 14+ for unit/component tests
- **E2E Testing:** Playwright 1.41+ for end-to-end workflows
- **Romanian Diacritics:** Ensure UTF-8 encoding and font support for ă, â, î, ș, ț

### Coding Standards

[Source: architecture/coding-standards.md]

- **Components:** PascalCase naming (e.g., `CaseHeader.tsx`)
- **Type Sharing:** All types defined in `packages/shared/types`
- **State Updates:** Never mutate state directly, use Zustand actions
- **Error Handling:** Add error boundaries for component error handling

### Project Structure Alignment

[Source: architecture/unified-project-structure.md]

- New case components should follow existing patterns in `apps/web/src/components/`
- Organize by feature: all case-related components under `case/` directory
- Tab components in subdirectory: `case/tabs/`
- Keep components focused and single-responsibility
- Extract reusable sub-components when complexity increases

### Reusable Components from Previous Stories

[Source: docs/stories/1.1.story.md, docs/stories/1.3.story.md, docs/stories/1.4.story.md]

- **From Story 1.1:**
  - Button (primary, secondary, ghost): `packages/ui/src/components/Button.tsx` or `apps/web/src/components/ui/Button.tsx`
  - Card: `packages/ui/src/components/Card.tsx`
  - Input, Badge, Tooltip, Avatar: Check `packages/ui/src/components/` directory
- **From Story 1.3:**
  - MainLayout (sidebar + top bar navigation): `apps/web/src/components/layout/MainLayout.tsx`
  - Role switching capability: Available in layout navigation
- **From Story 1.4:**
  - WidgetContainer pattern for collapsible panels (reference for AI Insights Panel design)
  - DashboardGrid for drag-drop patterns (reference for future kanban drag-drop)

### Testing Standards

[Source: architecture/testing-strategy.md, docs/stories/1.2.story.md]

**Test Organization:**

- **Unit Tests (70%):** Test individual components and stores in isolation
  - Location: Next to component files with `.test.tsx` extension
  - Framework: Jest + React Testing Library
  - Focus: Component rendering, props, state, user interactions

- **Integration Tests (20%):** Test component interactions and data flow
  - Location: In component directories as `*Integration.test.tsx`
  - Focus: Tab switching, store updates, cross-component communication

- **E2E Tests (10%):** Test complete user workflows
  - Location: `tests/e2e/`
  - Framework: Playwright
  - Focus: Critical paths, accessibility, responsive behavior

**Coverage Requirements:**

- Minimum 80% code coverage
- All user interactions must be tested
- Test Romanian diacritic rendering
- Include accessibility tests with axe-core

### Special Considerations

1. **Mock Data Only:** This is a prototype story - all data is mock, no backend integration
2. **Visual Interactions:** Drag-and-drop, natural language input are visual only - no real processing
3. **Performance:** With multiple tabs and panels, consider React.memo for expensive components
4. **Accessibility:** Ensure keyboard navigation works for all interactive elements
5. **Responsive Design:** All components must work on mobile, tablet, and desktop viewports
6. **Romanian Language:** All text must support Romanian diacritics correctly

### Known Constraints

- AI Insights panel suggestions are hardcoded mockups - no real AI processing
- Quick Actions bar does not process natural language - visual prototype only
- Document preview does not render actual document content - placeholder only
- Drag-and-drop in Tasks kanban board is visual indication only - not functional yet
- No real data persistence - everything uses localStorage or in-memory state

## Testing

### Unit Tests

[Source: architecture/testing-strategy.md]

- Test individual components in isolation using Jest and React Testing Library
- Files located next to component files with `.test.tsx` suffix
- Test rendering, props, state changes, and user interactions
- Mock external dependencies (stores, factories)
- Target: 70% of total testing effort

### Integration Tests

[Source: architecture/testing-strategy.md]

- Test component interactions and state management integration
- Verify tab switching updates store and renders correct content
- Test AI panel and quick actions bar integration with workspace
- Verify mock data loading and display across components
- Target: 20% of total testing effort

### E2E Tests

[Source: architecture/testing-strategy.md, docs/stories/1.2.story.md]

- Use Playwright to test complete case workspace workflow
- Test navigation, tab switching, panel interactions
- Verify responsive behavior on different viewports
- Include accessibility testing with axe-core
- Test Romanian diacritic rendering
- Run in CI pipeline on every PR
- Target: 10% of total testing effort

### Coverage Requirements

[Source: docs/stories/1.2.story.md]

- Minimum 80% code coverage required
- Coverage report generated by Jest
- CI pipeline enforces coverage threshold

## Change Log

| Date       | Version | Description                                                                                                                                                            | Author                |
| ---------- | ------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- |
| 2025-11-12 | 1.0     | Initial story draft created                                                                                                                                            | Bob (Scrum Master)    |
| 2025-11-12 | 1.1     | Validation completed - Fixed architecture references, added project structure tree, added component file paths, added mock data volumes, added Storybook workflow note | Sarah (Product Owner) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

_To be populated by dev agent during implementation_

### Completion Notes

_To be populated by dev agent during implementation_

### File List

- packages/shared/types/src/entities.ts (modified - added CaseType, CaseTeamMember, DocumentVersion)
- packages/shared/types/src/workspace.ts (created)
- packages/shared/types/src/index.ts (modified - added workspace export)
- apps/web/src/stores/case-workspace.store.ts (created)
- apps/web/src/components/case/CaseHeader.tsx (created)
- apps/web/src/components/case/CaseHeader.test.tsx (created)
- apps/web/src/components/case/CaseHeader.stories.tsx (created)
- apps/web/src/components/case/WorkspaceTabs.tsx (created)
- apps/web/src/components/case/WorkspaceTabs.test.tsx (created)
- apps/web/src/components/case/WorkspaceTabs.stories.tsx (created)
- apps/web/package.json (modified - added @radix-ui/react-avatar, @radix-ui/react-tabs)

## QA Results

_To be populated by QA agent after implementation_
