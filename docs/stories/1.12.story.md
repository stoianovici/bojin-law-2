# Story 1.12: Reports & Analytics Interface (Rapoarte)

## Status

Ready for development

## Story

**As a** law firm Partner or Manager,
**I want** comprehensive analytics and reporting across cases, time, finances, and team performance,
**so that** I can make data-driven decisions and monitor firm operations effectively.

## Acceptance Criteria

1. Report categories available: Cases, Time Tracking, Financial, Team Performance, Clients, Documents
2. Each report displays interactive charts/visualizations with drill-down capability
3. Date range filter applies to all reports (presets: This Week, This Month, This Quarter, This Year, Custom)
4. Role-based report visibility (Partner sees all, Associate sees personal metrics, Paralegal sees assigned work)
5. Export functionality mockup for PDF and Excel formats with download preview
6. Report builder interface allows custom report creation with field selection and grouping options

## Tasks / Subtasks

- [ ] **Task 1: Create Reports & Analytics Page Structure** (AC: All)
  - [ ] Create page file `apps/web/src/app/reports/page.tsx`
  - [ ] Implement two-column layout: Report Categories Sidebar (left), Report Content Area (right)
  - [ ] Add responsive layout: collapse sidebar to dropdown on tablet/mobile
  - [ ] Use design tokens from Story 1.1 for spacing and colors [Source: architecture/tech-stack.md]
  - [ ] Ensure Romanian language support for all UI labels [Source: architecture/tech-stack.md]
  - [ ] Add date range filter bar at top of content area
  - [ ] Position export buttons in top-right corner of content area

- [ ] **Task 2: Build Report Categories Sidebar** (AC: 1)
  - [ ] Create `apps/web/src/components/reports/ReportCategoriesSidebar.tsx`
  - [ ] Display report categories as collapsible sections:
    - **Dosare** (Cases): Cases by Status, Cases by Type, Cases by Value, Case Timeline
    - **Pontaj** (Time Tracking): Billable Hours, Utilization Rate, Time by Task Type, Time by Case
    - **Financiar** (Financial): Revenue Trends, Billing Summary, Collections Report, Outstanding Invoices
    - **Echipă** (Team): Team Productivity, Workload Distribution, Performance Metrics, Capacity Planning
    - **Clienți** (Clients): Active Clients, Client Revenue, Matter Distribution, Client Retention
    - **Documente** (Documents): Documents by Type, Document Status, Version History, Storage Usage
  - [ ] Use Radix UI Collapsible for category sections [Source: architecture/tech-stack.md]
  - [ ] Highlight selected report with primary color background
  - [ ] Show report count badge for each category
  - [ ] Add search input to filter reports by name
  - [ ] Display role-restricted reports with lock icon (visible but disabled for unauthorized roles)
  - [ ] Implement responsive behavior: collapse to dropdown select on mobile

- [ ] **Task 3: Build Date Range Filter Component** (AC: 3)
  - [ ] Create `apps/web/src/components/reports/DateRangeFilter.tsx`
  - [ ] Position at top of report content area
  - [ ] Implement date range selector with presets using Radix UI Select [Source: architecture/tech-stack.md]:
    - **Săptămâna Aceasta** (This Week)
    - **Luna Aceasta** (This Month)
    - **Trimestrul Acesta** (This Quarter)
    - **Anul Acesta** (This Year)
    - **Personalizat** (Custom) - opens date picker for start/end dates
  - [ ] Display selected date range prominently
  - [ ] Add "Compare to Previous Period" toggle switch
  - [ ] Apply date range filter to all visible charts/metrics
  - [ ] Show loading state when date range changes
  - [ ] Persist selected date range to Zustand store
  - [ ] Use Romanian date format (dd.MM.yyyy)

- [ ] **Task 4: Build Cases Reports Components** (AC: 2)
  - [ ] Create `apps/web/src/components/reports/cases/CasesByStatusReport.tsx`
    - Pie chart showing case distribution by status (Active, Closed, On Hold, Archived)
    - Total case count metric card
    - Drill-down: Click slice to see case list for that status
    - Use Recharts PieChart component [Source: architecture/tech-stack.md]
  - [ ] Create `apps/web/src/components/reports/cases/CasesByTypeReport.tsx`
    - Bar chart showing case count by type (Litigation, Contract, Advisory, Criminal, etc.)
    - Horizontal bars sorted by count descending
    - Color-coded by case type (consistent with Story 1.5)
    - Drill-down: Click bar to see case list for that type
    - Use Recharts BarChart component [Source: architecture/tech-stack.md]
  - [ ] Create `apps/web/src/components/reports/cases/CasesByValueReport.tsx`
    - Stacked bar chart showing case value distribution by type
    - Total case value metric card (Romanian currency: RON)
    - Average case value metric card
    - Drill-down: Click bar to see high-value cases
    - Use Recharts BarChart with stacked bars
  - [ ] Create `apps/web/src/components/reports/cases/CaseTimelineReport.tsx`
    - Line chart showing case open/close trends over time
    - Two lines: Cases Opened (green), Cases Closed (blue)
    - X-axis: Time (months/weeks based on date range)
    - Y-axis: Case count
    - Use Recharts LineChart component
  - [ ] All case reports support role-based filtering (Partner sees all, Associate sees assigned)

- [ ] **Task 5: Build Time Tracking Reports Components** (AC: 2)
  - [ ] Create `apps/web/src/components/reports/time/BillableHoursReport.tsx`
    - Area chart showing billable hours trend over time
    - Total billable hours metric card
    - Billable rate percentage metric card
    - Comparison to previous period (up/down indicator)
    - Use Recharts AreaChart component [Source: architecture/tech-stack.md]
  - [ ] Create `apps/web/src/components/reports/time/UtilizationRateReport.tsx`
    - Gauge chart showing utilization rate percentage (target: 75%)
    - Color-coded: Red (<60%), Yellow (60-75%), Green (>75%)
    - Individual utilization by team member (Partner view only)
    - Drill-down: Click team member to see detailed time entries
    - Use Recharts RadialBarChart for gauge
  - [ ] Create `apps/web/src/components/reports/time/TimeByTaskTypeReport.tsx`
    - Pie chart showing time distribution by task type
    - Top task types list with hours and percentage
    - Drill-down: Click slice to see time entries for that task type
    - Use Recharts PieChart component
  - [ ] Create `apps/web/src/components/reports/time/TimeByCaseReport.tsx`
    - Horizontal bar chart showing top 10 cases by time spent
    - Total hours per case with billable/non-billable breakdown
    - Drill-down: Click bar to navigate to case workspace
    - Use Recharts BarChart component

- [ ] **Task 6: Build Financial Reports Components** (AC: 2, 4)
  - [ ] Create `apps/web/src/components/reports/financial/RevenueTrendsReport.tsx`
    - Line chart showing revenue trends over time (monthly/quarterly)
    - Total revenue metric card (RON)
    - Revenue growth percentage vs previous period
    - Breakdown by revenue source (billable hours, retainers, expenses)
    - Use Recharts ComposedChart (line + area)
    - **Restricted to Partner role only**
  - [ ] Create `apps/web/src/components/reports/financial/BillingSummaryReport.tsx`
    - Summary cards: Billed Amount, Collected Amount, Outstanding Amount
    - Bar chart showing billing by case type
    - Drill-down: Click bar to see detailed invoices
    - Use Recharts BarChart component
    - **Restricted to Partner role only**
  - [ ] Create `apps/web/src/components/reports/financial/CollectionsReport.tsx`
    - Stacked bar chart: Collected vs Outstanding by month
    - Collection rate percentage metric
    - Aging analysis table (0-30 days, 31-60 days, 61-90 days, >90 days)
    - Use Recharts BarChart with stacked bars
    - **Restricted to Partner role only**
  - [ ] Create `apps/web/src/components/reports/financial/OutstandingInvoicesReport.tsx`
    - Table view of all outstanding invoices (Client, Amount, Due Date, Days Overdue)
    - Sortable by amount, due date, days overdue
    - Total outstanding amount metric card
    - Color-coded by overdue status (green: current, yellow: 1-30 days, red: >30 days)
    - **Restricted to Partner role only**

- [ ] **Task 7: Build Team Performance Reports Components** (AC: 2, 4)
  - [ ] Create `apps/web/src/components/reports/team/TeamProductivityReport.tsx`
    - Bar chart comparing team members by billable hours
    - Average billable hours metric
    - Top performer highlight with trophy icon
    - Drill-down: Click bar to see individual performance details
    - Use Recharts BarChart component
    - **Restricted to Partner role only**
  - [ ] Create `apps/web/src/components/reports/team/WorkloadDistributionReport.tsx`
    - Stacked bar chart showing active cases per team member
    - Color-coded by case priority (High, Medium, Low)
    - Overutilized/underutilized indicators (red/yellow/green)
    - Drill-down: Click bar to see case assignments
    - Use Recharts BarChart with stacked bars
    - **Restricted to Partner role only**
  - [ ] Create `apps/web/src/components/reports/team/PerformanceMetricsReport.tsx`
    - Radar chart showing performance across dimensions: Billable Hours, Case Wins, Client Satisfaction, Document Quality, Responsiveness
    - Individual performance comparison to firm average
    - Use Recharts RadarChart component
    - **Restricted to Partner role only**
  - [ ] Create `apps/web/src/components/reports/team/CapacityPlanningReport.tsx`
    - Gantt-style chart showing team availability over next 4 weeks
    - Available hours vs allocated hours comparison
    - Capacity alerts for overbooked team members
    - Use custom React components with Tailwind (no Recharts)
    - **Restricted to Partner role only**

- [ ] **Task 8: Build Client Reports Components** (AC: 2)
  - [ ] Create `apps/web/src/components/reports/clients/ActiveClientsReport.tsx`
    - Metric cards: Total Active Clients, New Clients (period), Churned Clients (period)
    - Line chart showing client growth trend over time
    - Drill-down: Click data point to see client list for that period
    - Use Recharts LineChart component
  - [ ] Create `apps/web/src/components/reports/clients/ClientRevenueReport.tsx`
    - Bar chart showing top 10 clients by revenue
    - Revenue concentration percentage (top 5 clients / total revenue)
    - Drill-down: Click bar to see client details
    - Use Recharts BarChart component
  - [ ] Create `apps/web/src/components/reports/clients/MatterDistributionReport.tsx`
    - Pie chart showing matter distribution by client
    - Average matters per client metric
    - Use Recharts PieChart component
  - [ ] Create `apps/web/src/components/reports/clients/ClientRetentionReport.tsx`
    - Retention rate metric card with trend indicator
    - Bar chart showing retention rate by client segment
    - Churn analysis table (Client, Last Matter Date, Reason)
    - Use Recharts BarChart component

- [ ] **Task 9: Build Document Reports Components** (AC: 2)
  - [ ] Create `apps/web/src/components/reports/documents/DocumentsByTypeReport.tsx`
    - Pie chart showing document distribution by type (Contract, Motion, Letter, etc.)
    - Total document count metric card
    - Drill-down: Click slice to see document list for that type
    - Use Recharts PieChart component
  - [ ] Create `apps/web/src/components/reports/documents/DocumentStatusReport.tsx`
    - Stacked bar chart showing document status by type (Draft, Review, Approved, Filed)
    - Drill-down: Click bar to see documents in that status
    - Use Recharts BarChart with stacked bars
  - [ ] Create `apps/web/src/components/reports/documents/VersionHistoryReport.tsx`
    - Line chart showing document version creation trends
    - Average versions per document metric
    - Most edited documents list (top 10)
    - Use Recharts LineChart component
  - [ ] Create `apps/web/src/components/reports/documents/StorageUsageReport.tsx`
    - Gauge chart showing storage usage (current / total capacity)
    - Storage by document type breakdown (bar chart)
    - Largest documents list (top 10 by file size)
    - Use Recharts RadialBarChart for gauge

- [ ] **Task 10: Build Export Functionality Component** (AC: 5)
  - [ ] Create `apps/web/src/components/reports/ExportButton.tsx`
  - [ ] Position in top-right corner of report content area
  - [ ] Implement export dropdown using Radix UI DropdownMenu [Source: architecture/tech-stack.md]:
    - **Exportă ca PDF** (Export as PDF) - shows PDF icon
    - **Exportă ca Excel** (Export as Excel) - shows Excel icon
  - [ ] Click export option opens preview modal using Radix UI Dialog [Source: architecture/tech-stack.md]
  - [ ] Preview modal displays:
    - Report title and date range
    - Chart/table preview (mockup image)
    - "Download" button (mockup, shows success toast)
    - "Cancel" button to close modal
  - [ ] Show success toast notification on "download": "Raportul a fost exportat cu succes"
  - [ ] Display loading spinner during export preview generation
  - [ ] Include Romanian labels for all export options

- [ ] **Task 11: Build Report Builder Interface** (AC: 6)
  - [ ] Create `apps/web/src/components/reports/ReportBuilder.tsx`
  - [ ] Add "Raport Personalizat" (Custom Report) button in report categories sidebar
  - [ ] Click opens full-screen report builder using Radix UI Dialog [Source: architecture/tech-stack.md]
  - [ ] Report builder includes:
    - **Step 1: Select Data Source** - Dropdown (Cases, Time Entries, Invoices, Clients, Documents)
    - **Step 2: Choose Fields** - Multi-select checkboxes (show all available fields for data source)
    - **Step 3: Add Filters** - Dynamic filter builder (field, operator, value)
    - **Step 4: Group By** - Dropdown to select grouping field (optional)
    - **Step 5: Visualization** - Select chart type (Table, Bar Chart, Line Chart, Pie Chart)
    - **Step 6: Preview** - Show preview of custom report with mock data
  - [ ] Include stepper navigation (1-6) at top
  - [ ] Add "Back", "Next", "Preview", "Save Report" buttons
  - [ ] Save custom report to Zustand store (persisted to localStorage)
  - [ ] Saved reports appear in "Rapoarte Personalizate" section in sidebar
  - [ ] Use Radix UI Select for dropdowns, Checkbox for field selection [Source: architecture/tech-stack.md]
  - [ ] Include Romanian labels for all builder steps and options

- [ ] **Task 12: Build Drill-Down Modal Component** (AC: 2)
  - [ ] Create `apps/web/src/components/reports/DrillDownModal.tsx`
  - [ ] Triggered when user clicks chart element (bar, pie slice, line point)
  - [ ] Display detailed data table for clicked element
  - [ ] Table columns depend on report type (e.g., Case Name, Status, Value for case reports)
  - [ ] Include pagination for large datasets (mock 10 rows per page)
  - [ ] Add "Export" button to export drill-down data
  - [ ] Use Radix UI Dialog for modal [Source: architecture/tech-stack.md]
  - [ ] Include Romanian labels for table headers and controls

- [ ] **Task 13: Implement State Management** (AC: All)
  - [ ] Create Zustand store `apps/web/src/stores/reports.store.ts` [Source: architecture/tech-stack.md]
  - [ ] Store state for:
    - Selected report category and report ID
    - Date range filter (start date, end date, preset)
    - Comparison to previous period toggle
    - Role-based report access permissions
    - Custom reports array (user-created reports)
    - Drill-down modal state (open/closed, data)
    - Export modal state (open/closed, format, preview)
  - [ ] Implement actions:
    - selectReport(categoryId: string, reportId: string)
    - setDateRange(range: DateRange)
    - setComparisonEnabled(enabled: boolean)
    - saveCustomReport(report: CustomReport)
    - deleteCustomReport(reportId: string)
    - openDrillDown(data: DrillDownData)
    - closeDrillDown()
    - openExportModal(format: 'pdf' | 'excel')
    - closeExportModal()
  - [ ] Add localStorage persistence for date range preferences and custom reports
  - [ ] Create TypeScript interfaces in `packages/shared/types/src/reports.ts` [Source: architecture/coding-standards.md]

- [ ] **Task 14: Create Mock Data Utilities** (AC: All)
  - [ ] Create `packages/shared/test-utils/src/factories/reports.factory.ts`
  - [ ] Define Reports data model interfaces in `packages/shared/types/src/reports.ts`:

    ```typescript
    export type ReportCategory = 'cases' | 'time' | 'financial' | 'team' | 'clients' | 'documents';

    export interface ReportMetadata {
      id: string;
      categoryId: ReportCategory;
      name: string;
      nameRo: string; // Romanian name
      description: string;
      allowedRoles: UserRole[]; // Who can access this report
      chartType: ChartType;
      requiresDateRange: boolean;
    }

    export type ChartType = 'pie' | 'bar' | 'line' | 'area' | 'radar' | 'gauge' | 'table';

    export interface DateRange {
      start: Date;
      end: Date;
      preset: DateRangePreset | null;
    }

    export type DateRangePreset = 'thisWeek' | 'thisMonth' | 'thisQuarter' | 'thisYear';

    export interface ReportData {
      reportId: string;
      dateRange: DateRange;
      data: ChartDataPoint[];
      summary?: ReportSummary;
      comparisonData?: ComparisonData;
    }

    export interface ChartDataPoint {
      label: string;
      value: number;
      color?: string;
      metadata?: Record<string, any>; // For drill-down
    }

    export interface ReportSummary {
      totalValue: number;
      averageValue: number;
      changeFromPrevious?: number; // percentage
      trendDirection?: 'up' | 'down' | 'stable';
    }

    export interface ComparisonData {
      previousPeriod: ChartDataPoint[];
      percentChange: number;
    }

    export interface CustomReport {
      id: string;
      name: string;
      dataSource: ReportDataSource;
      selectedFields: string[];
      filters: ReportFilter[];
      groupBy?: string;
      chartType: ChartType;
      createdAt: Date;
      createdBy: string;
    }

    export type ReportDataSource = 'cases' | 'timeEntries' | 'invoices' | 'clients' | 'documents';

    export interface ReportFilter {
      field: string;
      operator: FilterOperator;
      value: string | number | Date;
    }

    export type FilterOperator =
      | 'equals'
      | 'notEquals'
      | 'greaterThan'
      | 'lessThan'
      | 'contains'
      | 'between';

    export interface DrillDownData {
      reportId: string;
      dataPoint: ChartDataPoint;
      detailRows: Record<string, any>[];
      columns: ColumnDefinition[];
    }

    export interface ColumnDefinition {
      key: string;
      label: string;
      labelRo: string;
      type: 'text' | 'number' | 'date' | 'currency';
    }
    ```

  - [ ] Implement factory functions:
    - `createMockReportMetadata()` - generates all available reports with metadata
    - `createMockReportData(reportId, dateRange)` - generates chart data for specific report
    - `createMockCasesReportData()` - generates mock data for all case reports
    - `createMockTimeReportData()` - generates mock data for all time reports
    - `createMockFinancialReportData()` - generates mock data for financial reports
    - `createMockTeamReportData()` - generates mock data for team reports
    - `createMockClientReportData()` - generates mock data for client reports
    - `createMockDocumentReportData()` - generates mock data for document reports
    - `createMockCustomReport()` - generates custom report definition
    - `createMockDrillDownData()` - generates drill-down detail rows
  - [ ] Ensure realistic Romanian labels and data
  - [ ] Generate data variations based on date range
  - [ ] Include comparison to previous period data
  - [ ] Export factories from `packages/shared/test-utils/src/index.ts`

- [ ] **Task 15: Create Storybook Stories** (AC: All)
  - [ ] Create `apps/web/src/components/reports/ReportCategoriesSidebar.stories.tsx`
  - [ ] Create `apps/web/src/components/reports/DateRangeFilter.stories.tsx`
  - [ ] Create story files for each report type (cases, time, financial, team, clients, documents)
  - [ ] Create `apps/web/src/components/reports/ExportButton.stories.tsx`
  - [ ] Create `apps/web/src/components/reports/ReportBuilder.stories.tsx`
  - [ ] Create `apps/web/src/components/reports/DrillDownModal.stories.tsx`
  - [ ] Document component props and usage examples
  - [ ] Include states: default, loading, empty data, with data, comparison enabled
  - [ ] Test Romanian diacritics rendering in all stories
  - [ ] Demonstrate all chart types and drill-down interactions

- [ ] **Task 16: Write Unit Tests** (AC: All)
  - [ ] Create `ReportCategoriesSidebar.test.tsx` using Jest + React Testing Library [Source: architecture/testing-strategy.md]
    - Test report categories rendering
    - Test report selection updates content area
    - Test search filter
    - Test role-based report visibility
  - [ ] Create `DateRangeFilter.test.tsx`
    - Test preset selection
    - Test custom date range picker
    - Test comparison toggle
    - Test date range persistence
  - [ ] Create unit tests for each report component:
    - Test chart rendering with mock data
    - Test drill-down click handlers
    - Test empty state rendering
    - Test comparison data display
  - [ ] Create `ExportButton.test.tsx`
    - Test export dropdown rendering
    - Test export modal open/close
    - Test success toast on export
  - [ ] Create `ReportBuilder.test.tsx`
    - Test stepper navigation
    - Test field selection
    - Test filter builder
    - Test preview generation
    - Test save custom report
  - [ ] Create `DrillDownModal.test.tsx`
    - Test modal open with drill-down data
    - Test table rendering
    - Test pagination
    - Test export drill-down data
  - [ ] Create `reports.store.test.ts`
    - Test state updates for all actions
    - Test localStorage persistence
    - Test role-based report access filtering
  - [ ] Achieve minimum 70% unit test coverage [Source: architecture/testing-strategy.md]

- [ ] **Task 17: Create Accessibility Tests** (AC: All)
  - [ ] Create `apps/web/src/components/reports/Reports.a11y.test.tsx`
  - [ ] Run axe-core accessibility tests on all report components
  - [ ] Verify WCAG AA compliance for all components
  - [ ] Test keyboard navigation:
    - Tab through report categories and date range filter
    - Enter to select report
    - Arrow keys for chart legend navigation
    - Escape to close modals
  - [ ] Verify screen reader compatibility with proper ARIA labels:
    - Chart titles and data labels
    - Report categories with descriptions
    - Filter controls with labels
    - Export buttons with format indication
  - [ ] Test focus management (focus trap in modals)
  - [ ] Verify color contrast for all chart colors
  - [ ] Test chart accessibility (SVG with aria-labels, data tables as fallback)
  - [ ] Validate Romanian diacritics render correctly in all components

- [ ] **Task 18: Write E2E Tests** (AC: All)
  - [ ] Create `tests/e2e/reports/reports.spec.ts` using Playwright [Source: architecture/testing-strategy.md]
  - [ ] Test navigation to reports page
  - [ ] Test report category navigation:
    - Click category to expand reports list
    - Select report from list
    - Verify chart renders in content area
  - [ ] Test date range filter:
    - Select preset (This Month)
    - Verify chart data updates
    - Enable comparison toggle
    - Verify comparison data appears
  - [ ] Test drill-down interaction:
    - Click chart element (bar/slice/point)
    - Verify drill-down modal opens
    - Verify detail data table displays
    - Close modal
  - [ ] Test export functionality:
    - Click export button
    - Select PDF format
    - Verify export preview modal opens
    - Click download (verify success toast)
  - [ ] Test report builder:
    - Click "Custom Report" button
    - Complete all builder steps
    - Preview custom report
    - Save custom report
    - Verify custom report appears in sidebar
  - [ ] Test role-based access:
    - Switch to Associate role (using RoleSwitcher from Story 1.3)
    - Verify financial reports are disabled/hidden
    - Switch to Partner role
    - Verify all reports are accessible
  - [ ] Test responsive layout on different viewport sizes
  - [ ] Verify Romanian content renders correctly throughout user journey

- [ ] **Task 19: Add Navigation Integration** (AC: All)
  - [ ] Update `apps/web/src/components/layout/Sidebar.tsx` to ensure "Reports" menu item exists (should already exist from Story 1.3)
  - [ ] Create route `/reports` for reports page
  - [ ] Ensure active navigation highlighting works for reports routes
  - [ ] Test navigation flow: Dashboard → Reports (verify smooth transition)

- [ ] **Task 20: Create QA Gate Checklist** (AC: All)
  - [ ] Create `docs/qa/gates/1.12-reports-analytics-interface.yml`
  - [ ] Define acceptance criteria validation checklist
  - [ ] Define test coverage requirements (unit, a11y, E2E)
  - [ ] Define visual QA checklist (Romanian text, chart colors, responsive)
  - [ ] Define performance baseline (page load < 3s, chart rendering < 1s)
  - [ ] Define role-based access validation checklist

## Dev Notes

### Context: Epic 1 - Interactive Prototype

This story is part of Epic 1: "UI Foundation & Interactive Prototype" which focuses on creating **clickable mockups** and **visual design demonstrations** to validate UX with pilot firm before backend development begins. This is NOT a full implementation with backend integration. [Source: docs/prd/epic-1-ui-foundation-interactive-prototype.md]

**Key Constraints:**

- Focus on UI/UX demonstration only
- Use mock data (no real API calls or database)
- Prioritize visual fidelity and interactivity
- Demonstrate all major features in prototype state
- Charts must be interactive (hover, click, drill-down)
- Role-based access demonstrated with UI restrictions

### Previous Story Insights

From Story 1.8 (Communication Hub) and Story 1.11 (Time Tracking):

- Established pattern: components in `apps/web/src/components/[feature]/`
- State management with Zustand stores in `apps/web/src/stores/`
- Testing approach: Unit (Jest + RTL) → Accessibility (axe-core) → E2E (Playwright)
- Romanian language support required throughout (diacritics: ă, â, î, ș, ț)
- Storybook stories for all major components
- Mock data factories in `packages/shared/test-utils/src/factories/`
- Minimum 70% unit test coverage standard
- WCAG AA compliance mandatory for all UI components
- Pattern: Feature-specific TypeScript interfaces in `packages/shared/types/src/[feature].ts`

From Story 1.4 (Dashboard Mockups):

- Recharts 2.5+ approved for data visualization
- Responsive charts with ResponsiveContainer
- Color-coded visualizations with consistent design tokens
- Interactive charts with tooltips and click handlers

### Data Models

**Reports & Analytics Interfaces** [Source: To be defined in packages/shared/types/src/reports.ts]

See Task 14 for complete TypeScript interface definitions including:

- `ReportMetadata` - Report configuration and permissions
- `ReportData` - Chart data and summary metrics
- `CustomReport` - User-created custom reports
- `DrillDownData` - Drill-down detail data
- `DateRange` and `DateRangePreset` - Date filtering
- `ChartDataPoint` and `ReportSummary` - Chart data structures

**Note:** For this prototype story, define new Reports interfaces in `packages/shared/types/src/reports.ts`. Full backend implementation with real-time data aggregation, scheduled reports, and report subscriptions will come in later epics.

### UI Component Specifications

**Tech Stack** [Source: architecture/tech-stack.md]

- **Frontend Framework:** Next.js 14.2+ with App Router (use `app/` directory structure)
- **Language:** TypeScript 5.3+ (strict mode enabled)
- **UI Components:** Radix UI 1.1+ for primitives (Dialog, Select, DropdownMenu, Checkbox, etc.)
- **Styling:** Tailwind CSS 3.4+ with design tokens from Story 1.1
- **State Management:** Zustand 4.5+ for client state
- **Charts:** Recharts 2.5+ for data visualization
- **Testing:** Jest 29+ with React Testing Library 14+ for unit tests
- **E2E Testing:** Playwright 1.41+ for end-to-end tests
- **Component Docs:** Storybook (already configured in Story 1.1)

**Recharts Components to Use:**

- `PieChart` - For distribution reports (cases by status, time by task type, etc.)
- `BarChart` - For comparison reports (cases by type, team productivity, etc.)
- `LineChart` - For trend reports (case timeline, revenue trends, etc.)
- `AreaChart` - For cumulative reports (billable hours over time, etc.)
- `RadarChart` - For multi-dimensional comparisons (team performance metrics)
- `RadialBarChart` - For gauge charts (utilization rate, storage usage)
- `ComposedChart` - For complex multi-series charts (revenue breakdown)
- `ResponsiveContainer` - For responsive chart sizing
- `Tooltip` - For interactive hover information
- `Legend` - For chart legends with click handlers

**Radix UI Components to Use:**

- `@radix-ui/react-select` - For report category selector, date range presets
- `@radix-ui/react-dialog` - For export modal, report builder, drill-down modal
- `@radix-ui/react-dropdown-menu` - For export format selector
- `@radix-ui/react-collapsible` - For report category sections in sidebar
- `@radix-ui/react-checkbox` - For report builder field selection
- `@radix-ui/react-switch` - For comparison toggle
- All Radix components provide WCAG AA accessibility by default

### File Locations

**Component Structure** [Source: architecture/unified-project-structure.md + architecture/coding-standards.md]

```
apps/web/src/
├── app/
│   └── reports/
│       └── page.tsx                           # Main reports page (Next.js route)
├── components/
│   └── reports/                               # NEW: Reports components
│       ├── ReportCategoriesSidebar.tsx
│       ├── ReportCategoriesSidebar.stories.tsx
│       ├── ReportCategoriesSidebar.test.tsx
│       ├── DateRangeFilter.tsx
│       ├── DateRangeFilter.stories.tsx
│       ├── DateRangeFilter.test.tsx
│       ├── ExportButton.tsx
│       ├── ExportButton.stories.tsx
│       ├── ExportButton.test.tsx
│       ├── ReportBuilder.tsx
│       ├── ReportBuilder.stories.tsx
│       ├── ReportBuilder.test.tsx
│       ├── DrillDownModal.tsx
│       ├── DrillDownModal.stories.tsx
│       ├── DrillDownModal.test.tsx
│       ├── cases/                            # Case report components
│       │   ├── CasesByStatusReport.tsx
│       │   ├── CasesByTypeReport.tsx
│       │   ├── CasesByValueReport.tsx
│       │   └── CaseTimelineReport.tsx
│       ├── time/                             # Time report components
│       │   ├── BillableHoursReport.tsx
│       │   ├── UtilizationRateReport.tsx
│       │   ├── TimeByTaskTypeReport.tsx
│       │   └── TimeByCaseReport.tsx
│       ├── financial/                        # Financial report components
│       │   ├── RevenueTrendsReport.tsx
│       │   ├── BillingSummaryReport.tsx
│       │   ├── CollectionsReport.tsx
│       │   └── OutstandingInvoicesReport.tsx
│       ├── team/                             # Team report components
│       │   ├── TeamProductivityReport.tsx
│       │   ├── WorkloadDistributionReport.tsx
│       │   ├── PerformanceMetricsReport.tsx
│       │   └── CapacityPlanningReport.tsx
│       ├── clients/                          # Client report components
│       │   ├── ActiveClientsReport.tsx
│       │   ├── ClientRevenueReport.tsx
│       │   ├── MatterDistributionReport.tsx
│       │   └── ClientRetentionReport.tsx
│       ├── documents/                        # Document report components
│       │   ├── DocumentsByTypeReport.tsx
│       │   ├── DocumentStatusReport.tsx
│       │   ├── VersionHistoryReport.tsx
│       │   └── StorageUsageReport.tsx
│       └── Reports.a11y.test.tsx
└── stores/
    ├── reports.store.ts                      # NEW: Zustand store for reports
    └── reports.store.test.ts

packages/shared/types/src/
├── reports.ts                                # NEW: TypeScript interfaces for reports
└── index.ts                                  # UPDATE: Export new types

packages/shared/test-utils/src/factories/
├── reports.factory.ts                        # NEW: Mock data generators
├── reports.factory.test.ts
└── index.ts                                  # UPDATE: Export new factories

tests/e2e/reports/
└── reports.spec.ts                           # NEW: E2E test suite

docs/qa/gates/
└── 1.12-reports-analytics-interface.yml      # NEW: QA gate checklist
```

**Naming Conventions** [Source: architecture/coding-standards.md]

- Components: PascalCase (e.g., `CasesByStatusReport.tsx`)
- Stores: kebab-case with `.store.ts` suffix
- Test files: Same name as source with `.test.tsx` or `.spec.ts` suffix
- Story files: Same name as source with `.stories.tsx` suffix

### Testing Requirements

**Testing Strategy** [Source: architecture/testing-strategy.md]

- **Unit Tests (70%):** Jest + React Testing Library for all components and stores
  - Test component rendering with various props
  - Test chart rendering with Recharts
  - Test user interactions (report selection, date range, drill-down clicks)
  - Test role-based report access filtering
  - Test export modal and report builder workflows
  - Mock all external dependencies
  - Minimum 70% code coverage

- **Accessibility Tests:** jest-axe for WCAG AA compliance
  - Run axe-core on all components
  - Verify keyboard navigation (Tab, Arrow keys, Enter, Escape)
  - Check ARIA labels and roles (charts with data tables, report categories, filter controls)
  - Test focus management (modal focus traps)
  - Validate color contrast for all chart colors
  - Validate Romanian diacritics render correctly
  - Ensure charts have accessible alternatives (data tables or aria-labels)

- **E2E Tests (10%):** Playwright for critical user journeys
  - Test complete reports workflow (navigate, filter, drill-down, export)
  - Test report builder custom report creation
  - Test role-based access restrictions
  - Verify responsive behavior across viewports (desktop, tablet, mobile)
  - Cross-browser testing (Chromium, Firefox, WebKit)

**Test File Locations:**

- Unit tests: Co-located with components (`ComponentName.test.tsx`)
- A11y tests: `Reports.a11y.test.tsx` in reports folder
- E2E tests: `tests/e2e/reports/reports.spec.ts`

### Technical Constraints

**TypeScript Configuration** [Source: architecture/coding-standards.md]

- Strict mode enabled (`"strict": true` in tsconfig.json)
- All types must be defined in `packages/shared/types/src/`
- No `any` types allowed (use `unknown` and type guards if needed)
- Interface over type for object definitions
- Proper discriminated unions for variant types (ReportCategory, ChartType, etc.)

**State Management** [Source: architecture/coding-standards.md]

- Never mutate state directly - use Zustand's set() function
- Implement actions as methods in store definition
- Use selectors for derived state (filtered reports based on role)
- Persist date range preferences and custom reports to localStorage using Zustand persist middleware

**Chart Implementation Best Practices:**

- Always use ResponsiveContainer to ensure charts scale properly
- Set explicit width/height for ResponsiveContainer (100% / 300-400px)
- Use consistent color palette from design tokens
- Add tooltips to all charts for interactive data display
- Implement onClick handlers for drill-down functionality
- Use margin prop to ensure labels don't get cut off
- Test chart rendering with empty data (show "No data available" message)
- Ensure chart legends are accessible (keyboard navigable)

**Role-Based Access Implementation:**

- Store user role in navigation store (from Story 1.3)
- Filter available reports in ReportCategoriesSidebar based on role
- Show locked icon for restricted reports (visual indicator only)
- Disable click on restricted reports
- Partner role: Access to all reports
- Associate role: Access to cases, time, clients, documents (no financial, no team)
- Paralegal role: Access to personal time, assigned cases, documents (no firm-wide reports)

**Performance Considerations:**

- For this prototype, performance optimization is NOT required
- Focus on clean, readable code over optimization
- Real reports performance (large datasets, real-time aggregation, caching) will be addressed in later epics
- Use React.memo() for chart components to prevent unnecessary re-renders during filter changes

**Romanian Language Support** [Source: architecture/tech-stack.md]

- All text content must include Romanian diacritics (ă, â, î, ș, ț)
- Test font rendering of diacritics in all components
- Use UTF-8 encoding for all text files
- Mock data should include realistic Romanian labels
- Date formatting: dd.MM.yyyy (Romanian standard)
- Currency formatting: RON (Romanian Leu)
- Romanian report category names:
  - Cases → Dosare
  - Time Tracking → Pontaj
  - Financial → Financiar
  - Team → Echipă
  - Clients → Clienți
  - Documents → Documente

### Integration Notes

**Navigation Integration:**

This story adds reports & analytics to the application. The Sidebar component should already have a "Reports" menu item from Story 1.3. Verify:

- Menu item: "Rapoarte" (Reports) with chart/analytics icon
- Route: `/reports`
- Active state highlighting when on reports routes

**Cross-Story Data Integration:**

This story visualizes data from other stories:

- Cases data from Story 1.5 (Case Workspace)
- Time tracking data from Story 1.11 (Time Tracking Interface)
- Document data from Story 1.6 (Document Editor)
- Team/user data from Story 1.3 (Navigation & Role Switching)

Ensure mock data factories generate consistent data across stories (same case IDs, user IDs, etc.)

**Reusable Components:**

Leverage existing components from Story 1.1:

- Button component (primary, secondary, ghost variants)
- Card component for metric cards
- Modal component wrapper (Radix Dialog configured)
- Badge component for status indicators
- Tooltip component for chart data points
- Dropdown component (Radix DropdownMenu configured)

**Design Tokens:**

Use CSS variables defined in Story 1.1:

- Colors: `--color-primary`, `--color-secondary`, `--color-text-primary`, etc.
- Chart colors: Use consistent palette for case types, task types, status values
- Spacing: `--spacing-xs`, `--spacing-sm`, `--spacing-md`, etc.
- Shadows: `--shadow-sm`, `--shadow-md`, `--shadow-lg`
- Typography: Font sizes, line heights, font families with diacritic support

**Chart Color Palette:**

Define consistent colors for chart elements:

- Primary: Blue (`#3B82F6`)
- Success: Green (`#10B981`)
- Warning: Yellow (`#F59E0B`)
- Danger: Red (`#EF4444`)
- Purple: (`#8B5CF6`)
- Gray: (`#6B7280`)

Use color coding consistently across reports (e.g., billable = green, non-billable = gray)

### Project Structure Notes

No structural conflicts identified. This story follows established patterns:

- Next.js App Router pages in `app/` directory
- Feature-specific components in `components/[feature]/`
- Shared types in `packages/shared/types/`
- Test utilities in `packages/shared/test-utils/`
- E2E tests in `tests/e2e/[feature]/`

All file paths align with the unified project structure defined in architecture documentation.

### Implementation Priority

**Core Functionality (Must Have):**

1. Report categories sidebar with all 6 categories
2. Date range filter with presets
3. At least 2 reports per category (12 total minimum)
4. Interactive charts with tooltips
5. Export functionality mockup (PDF/Excel preview)
6. Role-based report access restrictions

**Secondary Features (Should Have):**

7. Drill-down modal for detailed data
8. Comparison to previous period
9. Report builder for custom reports
10. Summary metric cards for each report
11. Mock data showing realistic trends and patterns

**Polish (Nice to Have):**

12. Smooth chart animations and transitions
13. Advanced custom report filtering
14. Saved custom reports in sidebar
15. Keyboard shortcuts for common actions (Export: Cmd+E, etc.)
16. Chart legend filtering (click legend item to hide/show series)

### Testing

**Test File Location** [Source: architecture/testing-strategy.md]

- Unit tests: Co-located with components in `apps/web/src/components/reports/`
- A11y tests: `Reports.a11y.test.tsx` in reports folder
- E2E tests: `tests/e2e/reports/reports.spec.ts`
- Store tests: `apps/web/src/stores/reports.store.test.ts`

**Minimum Coverage:** 70% unit test coverage

**Critical Test Scenarios:**

1. Report selection and chart rendering
2. Date range filter application
3. Drill-down modal interaction
4. Export modal workflow
5. Report builder custom report creation
6. Role-based report access restrictions
7. Romanian text rendering throughout
8. Accessibility (keyboard navigation, screen reader support, chart accessibility)

### Success Criteria

Story is complete when:

- [ ] All 6 acceptance criteria are met
- [ ] All report components render correctly in Storybook
- [ ] Unit test coverage ≥ 70%
- [ ] All accessibility tests pass (0 axe violations)
- [ ] E2E tests pass in all 3 browsers
- [ ] Romanian diacritics render correctly throughout
- [ ] All 6 report categories implemented with at least 2 reports each
- [ ] Charts are interactive (hover tooltips, drill-down clicks)
- [ ] Role-based access working (Partner sees all, Associate/Paralegal restricted)
- [ ] Export functionality demonstrates PDF/Excel preview
- [ ] Report builder demonstrates custom report creation
- [ ] Code follows TypeScript strict mode (no type errors)
- [ ] PR approved and merged to main branch

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-11-15 | 1.0     | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record

_This section will be populated by the development agent during implementation._

### Agent Model Used

_[To be filled by dev agent]_

### Debug Log References

_[To be filled by dev agent]_

### Completion Notes

_[To be filled by dev agent]_

### File List

_[To be filled by dev agent]_

## QA Results

_This section will be populated by the QA agent during review._
