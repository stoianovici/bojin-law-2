# Story 1.15: Content Views Enrichment

**Epic**: 1 - UI Foundation & Interactive Prototype
**Story**: 1.15
**Status**: ðŸš€ Ready for Implementation
**Dependencies**: 1.5, 1.6, 1.7
**Created**: 2025-11-18
**Last Updated**: 2025-11-18

---

## Story

**As a** law firm user
**I want** richer content previews and better navigation in Cases, Documents, and Tasks views
**So that** I can quickly find and understand information without unnecessary clicking

---

## Context

Three key content views need UX improvements to help users work more efficiently:

1. **Cases Overview**: Currently shows minimal information, requiring users to click into each case to understand its status and details
2. **Documents View**: Large number of documents with no sorting/filtering makes it hard to find specific files
3. **Tasks Calendar**: Has two competing prototypes with a selector, creating confusion

These views are frequently accessed and improving them will significantly boost daily productivity.

---

## Acceptance Criteria

### AC1: Richer Cases Overview

**Given** a user navigates to the Cases view
**When** the case list/grid loads
**Then** each case card MUST display the following information without requiring a click:

**Required Fields**:
- Case title/name
- Client name
- Case type (e.g., Civil, Criminal, Corporate)
- Current status (e.g., Active, Pending, Closed)
- Assigned attorney(s)
- Last activity date
- Next deadline (if any)
- Case priority indicator (high/medium/low)

**Visual Design**:
- Use color coding for status (green=active, yellow=pending, gray=closed)
- Highlight urgent deadlines (within 7 days) in red/orange
- Show attorney avatars for quick visual recognition
- Provide hover state with additional quick stats (# of documents, # of tasks)

**Interaction**:
- Clicking anywhere on card opens full case details
- Preserve current routing behavior
- Add quick actions menu (3-dot menu): "Add Task", "Upload Document", "Mark Complete"

### AC2: Document Browsing & Sorting

**Given** a user navigates to the Documents view
**When** the document list loads
**Then** the user MUST have the following capabilities:

**Sorting Options** (via dropdown or column headers):
- Date uploaded (newest/oldest)
- Document name (A-Z, Z-A)
- File type (PDF, DOCX, etc.)
- File size (largest/smallest)
- Related case (alphabetically)
- Last modified date

**Filtering Options** (via sidebar or top bar):
- By case (multi-select dropdown)
- By document type (Contract, Brief, Correspondence, etc.)
- By upload date range (date picker)
- By attorney who uploaded
- By file type (PDF, DOCX, XLSX, etc.)

**Search**:
- Search box for document name/content search
- Real-time filtering as user types
- Clear all filters button

**Display Enhancements**:
- Show document preview thumbnail (if available)
- Display file size and page count
- Show associated case name
- Indicate if document has been reviewed/signed
- Display last modified timestamp

**UX Features**:
- Remember user's last sort preference (localStorage)
- Show result count: "Showing 45 of 230 documents"
- Infinite scroll or pagination (recommend pagination for performance)
- Bulk actions: Select multiple â†’ Download as ZIP, Move to Case, etc.

### AC3: Simplified Task Calendar View

**Given** a user navigates to the Tasks view and selects Calendar
**When** the calendar view loads
**Then** only "Prototip v2" calendar implementation MUST be visible
**And** the prototype selector component MUST be removed entirely
**And** "Prototip v2" becomes the default and only calendar view

**Requirements**:
- Remove any UI elements related to prototype selection
- Clean up code to remove unused "Prototip v1" implementation
- Ensure all calendar features work as expected in v2
- Update any documentation or help text referencing old selector
- Verify routing still works correctly

---

## Technical Implementation Notes

### AC1: Cases Overview - Files to Modify

```
apps/web/src/components/cases/
â”œâ”€â”€ CasesView.tsx                  # Main cases list view
â”œâ”€â”€ CaseCard.tsx                   # Individual case card component
â”œâ”€â”€ CaseCardSkeleton.tsx           # Loading state
â””â”€â”€ types/
    â””â”€â”€ case.types.ts              # Add new fields to Case interface

apps/web/src/lib/
â””â”€â”€ api/
    â””â”€â”€ cases.api.ts               # Ensure API returns all needed fields
```

**Data Model Updates**:
```typescript
interface CaseOverview {
  id: string;
  title: string;
  clientName: string;
  caseType: 'Civil' | 'Criminal' | 'Corporate' | 'Family' | 'Real Estate';
  status: 'Active' | 'Pending' | 'On Hold' | 'Closed';
  assignedAttorneys: Attorney[];
  lastActivityDate: Date;
  nextDeadline?: Date;
  priority: 'High' | 'Medium' | 'Low';
  // Hover stats
  documentCount?: number;
  taskCount?: number;
}
```

**Design Tokens** (add to design system):
```css
--status-active: #10b981;    /* Green */
--status-pending: #f59e0b;   /* Amber */
--status-on-hold: #6b7280;   /* Gray */
--status-closed: #9ca3af;    /* Light Gray */
--priority-high: #ef4444;    /* Red */
--priority-medium: #f59e0b;  /* Amber */
--priority-low: #3b82f6;     /* Blue */
--deadline-urgent: #dc2626;  /* Dark Red */
```

### AC2: Documents View - Files to Modify

```
apps/web/src/components/documents/
â”œâ”€â”€ DocumentsView.tsx              # Main view with filters
â”œâ”€â”€ DocumentList.tsx               # Document grid/list
â”œâ”€â”€ DocumentCard.tsx               # Individual document card
â”œâ”€â”€ DocumentFilters.tsx            # NEW: Filter sidebar
â”œâ”€â”€ DocumentSortMenu.tsx           # NEW: Sort dropdown
â””â”€â”€ DocumentSearchBar.tsx          # NEW: Search component

apps/web/src/stores/
â””â”€â”€ documents.store.ts             # Add filter/sort state
```

**State Management**:
```typescript
interface DocumentsState {
  documents: Document[];
  filters: {
    cases: string[];
    types: string[];
    dateRange: { start: Date; end: Date } | null;
    uploadedBy: string[];
    fileTypes: string[];
    searchQuery: string;
  };
  sortBy: 'date' | 'name' | 'type' | 'size' | 'case';
  sortOrder: 'asc' | 'desc';
  pagination: {
    page: number;
    perPage: number;
    total: number;
  };
}
```

**Implementation Strategy**:
1. Backend API must support filtering/sorting (or implement client-side if dataset is small <1000 docs)
2. Use React Query for caching and optimistic updates
3. Debounce search input (300ms delay)
4. Store filter preferences in localStorage
5. URL params for shareable filtered views (`/documents?case=123&sort=date-desc`)

### AC3: Task Calendar Simplification - Files to Modify

```
apps/web/src/components/tasks/
â”œâ”€â”€ TaskCalendarView.tsx           # Remove selector, keep only v2
â”œâ”€â”€ PrototypeSelector.tsx          # DELETE this component
â””â”€â”€ calendar/
    â”œâ”€â”€ CalendarV2.tsx             # Rename to Calendar.tsx
    â””â”€â”€ CalendarV1.tsx             # DELETE this component
```

**Steps**:
1. Remove `PrototypeSelector` component and all imports
2. Rename `CalendarV2` to `Calendar`
3. Update routing to point directly to Calendar component
4. Remove any state/props related to prototype selection
5. Clean up unused code and dependencies
6. Update tests to only test Calendar (v2)

---

## Design Mockups Needed

Before implementation, design team should provide:

- **Cases Overview**: Desktop and mobile layouts for enriched case cards
- **Documents View**: Filter sidebar layout, sort dropdown placement
- **Responsive behavior**: How filters collapse on mobile

(Can proceed with implementation using existing design system if mockups unavailable, with design review before merge)

---

## Testing Requirements

### Unit Tests

**Cases**:
```typescript
describe('CaseCard', () => {
  it('should display all required case information', () => {});
  it('should highlight urgent deadlines', () => {});
  it('should show correct status color', () => {});
  it('should render attorney avatars', () => {});
  it('should show hover state with quick stats', () => {});
});
```

**Documents**:
```typescript
describe('DocumentFilters', () => {
  it('should filter by case', () => {});
  it('should filter by date range', () => {});
  it('should clear all filters', () => {});
  it('should persist filters to localStorage', () => {});
});

describe('DocumentSortMenu', () => {
  it('should sort by date', () => {});
  it('should toggle sort order', () => {});
  it('should remember sort preference', () => {});
});
```

**Tasks**:
```typescript
describe('TaskCalendarView', () => {
  it('should render only Calendar v2', () => {});
  it('should not render prototype selector', () => {});
  it('should display all calendar features', () => {});
});
```

### Integration Tests

- Full user flow: Filter documents â†’ Sort â†’ Select â†’ Download
- Full user flow: View cases â†’ Hover for stats â†’ Click quick action
- Verify URL params update with filters
- Verify localStorage persistence

### Manual QA Checklist

**Cases**:
- [ ] All 8 required fields display on case cards
- [ ] Status colors are correct
- [ ] Urgent deadlines highlighted
- [ ] Attorney avatars render correctly
- [ ] Hover state shows document/task counts
- [ ] Quick actions menu works
- [ ] Mobile responsive layout works

**Documents**:
- [ ] All sort options work correctly
- [ ] All filter options work correctly
- [ ] Search filters results in real-time
- [ ] Result count is accurate
- [ ] Filters persist after page refresh
- [ ] Clear filters button works
- [ ] Pagination works correctly
- [ ] Performance: No lag with 500+ documents

**Tasks**:
- [ ] Calendar v2 renders correctly
- [ ] No prototype selector visible
- [ ] All calendar features functional
- [ ] No console errors about missing v1
- [ ] Routing works correctly

---

## User Impact

**Severity**: High (affects daily workflow)
**User Value**: Very High (significant productivity improvement)
**Effort**: Large (16-24 hours)

### Before

- Cases: Must click into each case to see basic info
- Documents: Hard to find specific documents in large lists
- Tasks: Confusing prototype selector

### After

- Cases: See all relevant info at a glance
- Documents: Powerful filtering/sorting to find anything quickly
- Tasks: Clean, single calendar implementation

---

## Performance Considerations

### Cases Overview

- Lazy load attorney avatars
- Virtualize list if >100 cases (use `react-window`)
- Cache case overview data (5 min TTL)

### Documents View

- **Critical**: Pagination is essential for 500+ documents
- Implement infinite scroll OR traditional pagination
- Debounce search input (300ms)
- Server-side filtering for large datasets
- Consider indexing for fast search (Algolia, ElasticSearch, or simple DB index)

### Metrics to Monitor

- Time to First Contentful Paint (FCP): < 1.5s
- Time to Interactive (TTI): < 3s
- Filter/Sort response time: < 200ms
- Search debounce effectiveness: 50% reduction in API calls

---

## Accessibility Requirements

**Cases**:
- Status colors must have sufficient contrast (WCAG AA)
- Provide text labels in addition to color coding
- Quick actions menu keyboard accessible
- Screen reader announces case status and priority

**Documents**:
- Filter controls keyboard accessible
- ARIA labels for all filter inputs
- Search box has clear label
- Sort dropdown accessible via keyboard
- Result count announced to screen readers

**Tasks**:
- Calendar v2 fully keyboard navigable
- No accessibility regressions from removing selector

---

## Definition of Done

- [ ] Cases overview shows all 8 required fields (AC1)
- [ ] Case cards have correct color coding and highlighting
- [ ] Quick actions menu functional
- [ ] Documents view has all sorting options (AC2)
- [ ] Documents view has all filtering options
- [ ] Document search works with debouncing
- [ ] Filter preferences persist (localStorage)
- [ ] Tasks calendar shows only v2, selector removed (AC3)
- [ ] All unit tests implemented and passing (>80% coverage)
- [ ] Integration tests passing
- [ ] Manual QA checklist completed
- [ ] Accessibility audit passed (WCAG 2.1 AA)
- [ ] Performance benchmarks met
- [ ] Responsive design verified on all breakpoints
- [ ] Code review approved
- [ ] Deployed to staging and tested
- [ ] User acceptance testing with pilot firm
- [ ] Product owner approval obtained

---

## Related Stories

- **Story 1.5**: Case Workspace Prototype (original case view)
- **Story 1.6**: Document Editor Interface (document system)
- **Story 1.7**: Task Management Views (original calendar implementation)
- **Story 2.6**: Case Management Data Model (backend data structure)
- **Story 2.9**: Document Storage with OneDrive (document backend)

---

## Future Enhancements

Consider for future stories:

**Cases**:
- Saved search/filter presets
- Bulk case operations (assign, close, etc.)
- Custom fields per case type
- Case timeline visualization

**Documents**:
- Document tags/categories
- AI-powered document categorization
- OCR search within PDFs
- Document comparison tool
- Version history view

**Tasks**:
- Multiple calendar views (day/week/month)
- Calendar sharing/export
- Recurring task templates

---

## Rollback Plan

If issues arise after deployment:

1. **Immediate**: Feature flags for each sub-feature
   - `feature.cases.enriched_view`
   - `feature.documents.filtering`
   - `feature.tasks.calendar_v2_only`

2. **Within 4 hours**: Git revert if feature flags insufficient

3. **Communication**: In-app notification to users about rollback

**Risk Level**: Medium-High
- Affects three major features used daily
- Data model changes for cases
- Performance risk with document filtering

**Mitigation**:
- Gradual rollout with feature flags
- Load testing with realistic data volumes
- Pilot firm testing before general release
- Monitoring dashboards for performance metrics

---

## Data Migration

**Cases**:
- If adding new fields to case model, ensure database migration script
- Backfill existing cases with default values for new fields
- Test migration on staging with production data snapshot

**Documents**:
- No data migration needed (only view changes)
- Verify API returns all needed fields for filtering

**Tasks**:
- No data migration (only removing UI component)

---

## Stakeholder Communication

**Pilot Firm**:
- Demo enriched cases view for feedback
- Gather input on which document filters are most valuable
- Confirm calendar v2 meets all needs before removing selector

**Development Team**:
- Backend team: Coordinate API changes for cases/documents
- Design team: Finalize mockups for cases and documents
- QA team: Extra attention to performance with large datasets

---

## Success Metrics

Track post-launch (via analytics):

**Cases**:
- Reduction in clicks to view case details (target: 30% reduction)
- Time to find specific case (target: < 10 seconds)
- Quick actions usage rate

**Documents**:
- Filter adoption rate (target: 60% of users)
- Time to find specific document (target: < 15 seconds)
- Search usage vs. manual browsing

**Tasks**:
- User confusion reports (target: 0 support tickets about selector)
- Calendar feature usage (ensure v2 covers all use cases)

---

## Notes

- This is the most complex of the three UI fix stories
- Consider splitting into 3 separate stories if timeline is tight:
  - 1.15.1: Cases Overview Enhancement
  - 1.15.2: Documents Filtering & Sorting
  - 1.15.3: Task Calendar Simplification
- Highest user value of all UI improvement stories
- Recommend prioritizing documents filtering (most requested by users)

---

## Dev Agent Record

### Tasks

#### Task 1: AC3 - Simplified Task Calendar View
- [x] Review current task calendar implementation and identify prototype selector component
- [x] Remove prototype selector UI and related state management
- [x] Keep only CalendarV2 implementation and verify all features work
- [x] Update routing and component imports
- [x] Write/update unit tests for simplified calendar view
- [x] Validate task calendar functions correctly without selector

#### Task 2: AC1 - Richer Cases Overview
- [x] Review current cases page implementation
- [x] Create/update Case type interface with all required fields
- [x] Implement enriched CaseCard component with 8 required fields
- [x] Add status color coding and deadline highlighting
- [x] Implement attorney avatars display
- [x] Add hover state with quick stats (document/task counts)
- [x] Add quick actions menu (3-dot menu)
- [x] Write unit tests for CaseCard component
- [x] Validate cases overview displays all information correctly

#### Task 3: AC2 - Document Browsing & Sorting
- [x] Review current documents page implementation
- [x] Create document filter state management
- [x] Implement document sorting options (date, name, type, size, case)
- [x] Implement document filtering (by case, type, date range, attorney, file type)
- [x] Add search functionality with debouncing
- [x] Implement filter persistence to localStorage
- [x] Add "Clear all filters" button and result count display
- [x] Implement pagination or infinite scroll
- [ ] Write unit tests for filters and sorting
- [x] Validate document browsing works with all filter combinations

### Agent Model Used
- claude-sonnet-4-5-20250929

### Implementation Summary

(To be filled upon completion)

### Debug Log

(To be updated during implementation)

### Completion Notes

(To be filled upon completion)

### File List

**Modified Files:**
- `apps/web/src/app/tasks/page.tsx` - Removed prototype selector, uses only MultiWeekCalendarView
- `apps/web/src/components/task/TaskManagement.a11y.test.tsx` - Updated to test MultiWeekCalendarView instead of CalendarView
- `apps/web/src/app/cases/page.tsx` - Transformed from table layout to card grid with enriched case data
- `apps/web/src/app/documents/page.tsx` - Complete rebuild with 30 mock documents, filtering, sorting, search, pagination
- `packages/shared/types/src/entities.ts` - Added CaseOverview, Attorney, CasePriority, DocumentOverview, FileType types; updated CaseStatus and CaseType enums

**New Files:**
- `apps/web/src/components/case/CaseCard.tsx` - Enriched case card component with all 8 required fields, color coding, attorney avatars, hover stats, and quick actions menu
- `apps/web/src/components/case/CaseCard.test.tsx` - Comprehensive unit tests for CaseCard (40 tests covering all AC1 requirements)
- `apps/web/src/components/documents/DocumentFilters.tsx` - Filter sidebar with case, document type, file type, attorney, and date range filters
- `apps/web/src/components/documents/DocumentSortMenu.tsx` - Sort dropdown with 11 sorting options (date, name, size, type, case, modified date)
- `apps/web/src/components/documents/DocumentSearchBar.tsx` - Search input with 300ms debouncing
- `apps/web/src/stores/documents.store.ts` - Zustand store for document filtering, sorting, pagination, and localStorage persistence

**Deleted Files:**
- `apps/web/src/components/task/CalendarView.tsx` - Old calendar v1 implementation removed
- `apps/web/src/components/task/CalendarView.test.tsx` - Tests for old calendar removed
- `apps/web/src/components/task/CalendarView.stories.tsx` - Storybook file for old calendar removed

### Change Log

**2025-11-18 - Story Started**
- Added Dev Agent Record section
- Created task breakdown for three acceptance criteria

**2025-11-18 - AC3 Complete: Simplified Task Calendar View**
- Removed prototype selector toggle from tasks page
- Removed `useNewCalendar` state variable
- Removed CalendarView (v1) import and usage
- Updated TaskManagement.a11y.test.tsx to test MultiWeekCalendarView only
- Deleted CalendarView.tsx, CalendarView.test.tsx, CalendarView.stories.tsx
- Tasks page now shows only MultiWeekCalendarView (Prototip v2)
- All calendar features functional, app compiles successfully

**2025-11-18 - AC1 Mostly Complete: Richer Cases Overview**
- Added CaseOverview interface with all 8 required fields to types package
- Added Attorney interface and CasePriority type
- Updated CaseStatus to include 'Pending' and CaseType to include Civil, Criminal, Corporate, Family, RealEstate
- Created CaseCard component with:
  - All 8 required fields displayed (title, client, type, status, attorneys, last activity, deadline, priority)
  - Status color coding (green for Active, yellow for Pending, gray for OnHold/Closed)
  - Urgent deadline highlighting (red with âš ï¸ for deadlines within 7 days)
  - Attorney avatars with initials
  - Hover state showing document and task counts
  - Quick actions menu (3-dot) with Add Task, Upload Document, Mark Complete options
- Transformed cases page from table layout to responsive card grid (1/2/3 columns)
- Created enriched mock data with 6 diverse cases covering all case types and priorities
- App compiles successfully

**2025-11-18 - AC2 Complete: Document Browsing & Sorting**
- Created DocumentOverview interface with FileType enum in types package
- Built comprehensive Zustand store with filtering, sorting, pagination, and localStorage persistence
- Implemented DocumentFilters sidebar component with all required filter options:
  - Case filter (multi-select from 6 cases)
  - Document type filter (Contract, Motion, Letter, Memo, Pleading, Other)
  - File type filter (PDF, DOCX, XLSX, TXT, Other)
  - Uploaded by filter (multi-select attorneys)
  - Date range filter with from/to date pickers
  - Clear all filters button
- Implemented DocumentSortMenu with 11 sort options covering all AC2 requirements
- Implemented DocumentSearchBar with 300ms debounce for real-time search
- Created 30 realistic mock documents across 6 cases with varied types, sizes, dates
- Implemented pagination (20 docs/page) with Previous/Next navigation
- Result count display: "Showing X of Y documents"
- Filter state persists to localStorage and loads on page mount
- Documents page fully functional with all filtering, sorting, search, and pagination working
- App compiles successfully, all features verified working in dev server

**TODO: Remaining Work**
- AC2: Write unit tests for document filtering and sorting components
- Run full regression test suite
- Execute story definition of done checklist
